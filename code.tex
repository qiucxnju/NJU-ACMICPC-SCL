\section{比赛配置}
\subsection{代码库校验和}
\createlinenumber{1}{01b4}
\createlinenumber{2}{44f9}
\createlinenumber{3}{4de6}
\createlinenumber{4}{c502}
\createlinenumber{5}{427e}
\createlinenumber{6}{b41f}
\createlinenumber{7}{d74e}
\createlinenumber{8}{427e}
\createlinenumber{9}{f7db}
\createlinenumber{10}{f335}
\begin{lstlisting}[language={}]
# 代码库校验用于检查代码库录入是否正确，忽略每行的空白字符和注释(//)
# 使用方法: python checksum.py < 1001.cpp
# 输出: 每一行代码及其校验和(md5)
import re, sys, hashlib

def digest_line(s):
	return hashlib.md5(re.sub(r'\s|//.*', '', s)).hexdigest()[-4:]

for line in sys.stdin.read().strip().split("\n"):
	print digest_line(line), line
\end{lstlisting}
\subsection{vimrc}
\createlinenumber{11}{3ff1}
\createlinenumber{12}{7db5}
\createlinenumber{13}{7232}
\createlinenumber{14}{427e}
\createlinenumber{15}{427e}
\createlinenumber{16}{427e}
\createlinenumber{17}{6cb2}
\createlinenumber{18}{7d5c}
\createlinenumber{19}{bda7}
\createlinenumber{20}{1903}
\createlinenumber{21}{7f8d}
\createlinenumber{22}{2b1d}
\createlinenumber{23}{0437}
\createlinenumber{24}{400b}
\createlinenumber{25}{d7af}
\createlinenumber{26}{f298}
\createlinenumber{27}{1a4a}
\createlinenumber{28}{73c9}
\createlinenumber{29}{b506}
\begin{lstlisting}[language={}]
color evening
set number
set cindent



function HomeBind(offset)
  let cursor=getpos('.')
  let s0=getline(line('.'))
  let s1=substitute(s0, "^\\s\\+", "", "")
  let x=len(s0)-len(s1)+1
  if col('.') == x-a:offset
    let x=1
  endif
  call setpos('.', [cursor[0], cursor[1], x, cursor[3]])
endfunction
imap <silent> <Home> <Esc>:call HomeBind(1)<cr>i
nmap <silent> <Home> :call HomeBind(0)<cr>
vmap <silent> <Home> <Esc>:call HomeBind(1)<cr>
\end{lstlisting}
\subsection{代码库校验和}
\createlinenumber{30}{01b4}
\createlinenumber{31}{44f9}
\createlinenumber{32}{4de6}
\createlinenumber{33}{c502}
\createlinenumber{34}{427e}
\createlinenumber{35}{b41f}
\createlinenumber{36}{d74e}
\createlinenumber{37}{427e}
\createlinenumber{38}{f7db}
\createlinenumber{39}{f335}
\begin{lstlisting}[language=Python]
# 代码库校验用于检查代码库录入是否正确，忽略每行的空白字符和注释(//)
# 使用方法: python checksum.py < 1001.cpp
# 输出: 每一行代码及其校验和(md5)
import re, sys, hashlib

def digest_line(s):
	return hashlib.md5(re.sub(r'\s|//.*', '', s)).hexdigest()[-4:]

for line in sys.stdin.read().strip().split("\n"):
	print digest_line(line), line
\end{lstlisting}
\subsection{vim配置文件}
\createlinenumber{40}{44ed}
\createlinenumber{41}{914c}
\createlinenumber{42}{7db5}
\createlinenumber{43}{57b2}
\createlinenumber{44}{9832}
\createlinenumber{45}{e416}
\createlinenumber{46}{7232}
\createlinenumber{47}{740c}
\createlinenumber{48}{5913}
\begin{lstlisting}[language={}]
# vimrc 配置文件
set nocompatible
set number
set ruler
set showcmd
set autoindent
set cindent
set smartindent
set shiftwidth=4
\end{lstlisting}
\subsection{外挂}
\createlinenumber{49}{427e}
\createlinenumber{50}{08e0}
\createlinenumber{51}{772b}
\createlinenumber{52}{68df}
\createlinenumber{53}{bbf4}
\createlinenumber{54}{4d52}
\createlinenumber{55}{22d3}
\createlinenumber{56}{7f26}
\createlinenumber{57}{5bf1}
\createlinenumber{58}{fe62}
\createlinenumber{59}{427e}
\createlinenumber{60}{427e}
\createlinenumber{61}{6540}
\createlinenumber{62}{eb51}
\createlinenumber{63}{45da}
\createlinenumber{64}{c2a7}
\createlinenumber{65}{f000}
\createlinenumber{66}{2760}
\createlinenumber{67}{7181}
\createlinenumber{68}{95cf}
\createlinenumber{69}{427e}
\createlinenumber{70}{299c}
\createlinenumber{71}{4506}
\createlinenumber{72}{486b}
\createlinenumber{73}{0756}
\createlinenumber{74}{95cf}
\createlinenumber{75}{427e}
\createlinenumber{76}{427e}
\createlinenumber{77}{85cb}
\begin{lstlisting}[language={}]
// 调栈空间
const int N_MAX = 10000000;  
static int stack[N_MAX * 5], bak;  
asm __volatile__  
  (  
    "movl %%esp, %0;"  
    "movl %1, %%esp;":   
    "=g"(bak):  
    "g"(stack + N_MAX * 5 - 1):  
  );
  
// IO 外挂
#define BUFSIZE 20000000
char buf[BUFSIZE], *pt = buf;
#define scan(t) \
{ \
  t = 0; \
  while (!((*pt) >= '0' && (*pt) <= '9')) pt ++; \
  while (((*pt) >= '0' && (*pt) <= '9')) t = t * 10 + (*(pt ++)) - '0'; \
}
 
 int main()
{
 fread(buf, 1, BUFSIZE, stdin);
scan(N);
}

// C++ 编译器(VS) 调栈空间
#pragma comment(linker,"/STACK:102400000,102400000")
\end{lstlisting}

\section{二维计算几何}
\subsection{定义}
\createlinenumber{78}{652e}
\createlinenumber{79}{c1b0}
\createlinenumber{80}{0102}
\createlinenumber{81}{12d8}
\createlinenumber{82}{dca2}
\createlinenumber{83}{418f}
\createlinenumber{84}{8d0a}
\createlinenumber{85}{13f1}
\createlinenumber{86}{427e}
\createlinenumber{87}{427e}
\createlinenumber{88}{427e}
\createlinenumber{89}{9704}
\createlinenumber{90}{082e}
\createlinenumber{91}{98c9}
\createlinenumber{92}{d0aa}
\createlinenumber{93}{52a2}
\createlinenumber{94}{df98}
\createlinenumber{95}{e87b}
\createlinenumber{96}{d22b}
\createlinenumber{97}{95cf}
\createlinenumber{98}{4f13}
\createlinenumber{99}{dab2}
\createlinenumber{100}{95cf}
\createlinenumber{101}{a7a6}
\createlinenumber{102}{73b2}
\createlinenumber{103}{66d1}
\createlinenumber{104}{95cf}
\createlinenumber{105}{7b0b}
\createlinenumber{106}{f32c}
\createlinenumber{107}{d53d}
\createlinenumber{108}{5365}
\createlinenumber{109}{5ffd}
\createlinenumber{110}{95cf}
\createlinenumber{111}{e254}
\createlinenumber{112}{f32c}
\createlinenumber{113}{7683}
\createlinenumber{114}{70a0}
\createlinenumber{115}{5ffd}
\createlinenumber{116}{95cf}
\createlinenumber{117}{14f6}
\createlinenumber{118}{f32c}
\createlinenumber{119}{225c}
\createlinenumber{120}{414d}
\createlinenumber{121}{5ffd}
\createlinenumber{122}{95cf}
\createlinenumber{123}{d466}
\createlinenumber{124}{f32c}
\createlinenumber{125}{7aa6}
\createlinenumber{126}{9a5c}
\createlinenumber{127}{5ffd}
\createlinenumber{128}{95cf}
\createlinenumber{129}{12ba}
\createlinenumber{130}{e89b}
\createlinenumber{131}{95cf}
\createlinenumber{132}{daed}
\createlinenumber{133}{329b}
\createlinenumber{134}{f71b}
\createlinenumber{135}{05c6}
\createlinenumber{136}{df9c}
\createlinenumber{137}{d324}
\createlinenumber{138}{95cf}
\createlinenumber{139}{eb7f}
\createlinenumber{140}{84df}
\createlinenumber{141}{95cf}
\createlinenumber{142}{427e}
\createlinenumber{143}{427e}
\createlinenumber{144}{bda3}
\createlinenumber{145}{98c9}
\createlinenumber{146}{a334}
\createlinenumber{147}{5ae1}
\createlinenumber{148}{0fa8}
\createlinenumber{149}{ce41}
\createlinenumber{150}{95cf}
\createlinenumber{151}{cfb1}
\createlinenumber{152}{8e85}
\createlinenumber{153}{37ec}
\createlinenumber{154}{3b83}
\createlinenumber{155}{95cf}
\createlinenumber{156}{1d99}
\createlinenumber{157}{f061}
\createlinenumber{158}{95cf}
\createlinenumber{159}{4c7b}
\createlinenumber{160}{329b}
\createlinenumber{161}{cdd9}
\createlinenumber{162}{1d6a}
\createlinenumber{163}{d324}
\createlinenumber{164}{95cf}
\createlinenumber{165}{a5b5}
\createlinenumber{166}{427e}
\createlinenumber{167}{2f47}
\createlinenumber{168}{0c09}
\createlinenumber{169}{67a8}
\createlinenumber{170}{c0ad}
\createlinenumber{171}{614e}
\createlinenumber{172}{c23d}
\createlinenumber{173}{d0c6}
\createlinenumber{174}{95cf}
\createlinenumber{175}{a9b1}
\createlinenumber{176}{329b}
\createlinenumber{177}{b802}
\createlinenumber{178}{d469}
\createlinenumber{179}{d324}
\createlinenumber{180}{95cf}
\createlinenumber{181}{e519}
\begin{lstlisting}[language={}]
#define eps 1e-8
#define fabs(x) ((x) > 0? (x): -(x))
#define zero(x) (fabs(x) < eps)
#define _sign(x) ((x)>eps?1:((x)<-eps?2:0))
#define sqr(x) ((x)*(x))
#define MAXN 1000
#define offset 10000
const double pi=acos(-1);


// 点的定义 
struct point{
  int index;
  double ang;
  double x, y;
  point(){x = 0;y = 0;}
  point(double sx, double sy){
    x = sx;
    y = sy;
  }
  void read(){
    scanf("%lf %lf ", &x, &y);
  }
  bool operator <(const point &b)const{
    if (b.x == x) return y < b.y;
    return x < b.x;
  }
  point operator - (const point &b)const {
    point a;
    a.x = x - b.x;
    a.y = y - b.y;
    return a;
  }
  point operator + (const point &b)const{
    point a;
    a.x = x + b.x;
    a.y = y + b.y;
    return a;
  }
  point operator / (const double &c)const{
    point a;
    a.x = x / c;
    a.y = y / c;
    return a;
  }
  point operator * (const double &c)const{
    point a;
    a.x = x * c;
    a.y = y * c; 
    return a;
  }
  bool operator == (const point &p) const {
    return zero(x - p.x)&&zero(y - p.y);
  }
  friend ostream& operator << (ostream &out, const point &a);
};
typedef const point CP;
ostream& operator << (ostream &out, const point &a){
  out<<a.x<<' '<<a.y;
  return out;
}
bool cmp(const point &p1, const point &p2){
  return p1.ang < p2.ang;
}

// 线定义, 使用< 进行极角排序之前需要对所有线段调用getang 函数 
struct line{
  double ang;
  point a, b;line(){};
  line(const point &p1, const point &p2){
    a = p1;
    b = p2;
  }
  bool operator < (const line &y)const{
    if (zero(ang - y.ang))
      return (xmult(a, y.b, y.a) < 0);
    return ang < y.ang;
  }
  void getang(){
    ang = atan2(b.y - a.y, b.x - a.x);
  }
  friend ostream& operator << (ostream &out, const line &a);
};
ostream& operator << (ostream &out, const line &a){
  out<<a.a<<' '<<a.b<<' '<<a.ang;
  return out;
}
typedef const line CL;
// 圆定义 
struct circle{
  double r;
  point c;
  circle(){};
  circle(const point &p, double x){
    c = p;
    x = r;
  }
  friend ostream& operator << (ostream &out, const circle &a);
};
ostream& operator << (ostream &out, const circle &a){
  out<<a.c<<' '<<a.r;
  return out;
}
typedef const circle CC;
\end{lstlisting}
\subsection{定义~}
\createlinenumber{182}{652e}
\createlinenumber{183}{c1b0}
\createlinenumber{184}{0102}
\createlinenumber{185}{12d8}
\createlinenumber{186}{418f}
\createlinenumber{187}{8d0a}
\createlinenumber{188}{dca2}
\createlinenumber{189}{13f1}
\createlinenumber{190}{427e}
\createlinenumber{191}{427e}
\createlinenumber{192}{427e}
\createlinenumber{193}{9704}
\createlinenumber{194}{082e}
\createlinenumber{195}{98c9}
\createlinenumber{196}{d0aa}
\createlinenumber{197}{52a2}
\createlinenumber{198}{df98}
\createlinenumber{199}{e87b}
\createlinenumber{200}{d22b}
\createlinenumber{201}{95cf}
\createlinenumber{202}{a7a6}
\createlinenumber{203}{73b2}
\createlinenumber{204}{66d1}
\createlinenumber{205}{95cf}
\createlinenumber{206}{7b0b}
\createlinenumber{207}{f32c}
\createlinenumber{208}{d53d}
\createlinenumber{209}{5365}
\createlinenumber{210}{5ffd}
\createlinenumber{211}{95cf}
\createlinenumber{212}{e254}
\createlinenumber{213}{f32c}
\createlinenumber{214}{7683}
\createlinenumber{215}{70a0}
\createlinenumber{216}{5ffd}
\createlinenumber{217}{95cf}
\createlinenumber{218}{14f6}
\createlinenumber{219}{f32c}
\createlinenumber{220}{225c}
\createlinenumber{221}{414d}
\createlinenumber{222}{5ffd}
\createlinenumber{223}{95cf}
\createlinenumber{224}{d466}
\createlinenumber{225}{f32c}
\createlinenumber{226}{7aa6}
\createlinenumber{227}{9a5c}
\createlinenumber{228}{5ffd}
\createlinenumber{229}{95cf}
\createlinenumber{230}{12ba}
\createlinenumber{231}{e89b}
\createlinenumber{232}{95cf}
\createlinenumber{233}{daed}
\createlinenumber{234}{329b}
\createlinenumber{235}{05c6}
\createlinenumber{236}{df9c}
\createlinenumber{237}{d324}
\createlinenumber{238}{95cf}
\createlinenumber{239}{eb7f}
\createlinenumber{240}{84df}
\createlinenumber{241}{95cf}
\createlinenumber{242}{427e}
\createlinenumber{243}{427e}
\createlinenumber{244}{bda3}
\createlinenumber{245}{98c9}
\createlinenumber{246}{a334}
\createlinenumber{247}{5ae1}
\createlinenumber{248}{0fa8}
\createlinenumber{249}{ce41}
\createlinenumber{250}{95cf}
\createlinenumber{251}{cfb1}
\createlinenumber{252}{8e85}
\createlinenumber{253}{37ec}
\createlinenumber{254}{3b83}
\createlinenumber{255}{95cf}
\createlinenumber{256}{1d99}
\createlinenumber{257}{f061}
\createlinenumber{258}{95cf}
\createlinenumber{259}{4c7b}
\createlinenumber{260}{329b}
\createlinenumber{261}{cdd9}
\createlinenumber{262}{1d6a}
\createlinenumber{263}{d324}
\createlinenumber{264}{95cf}
\createlinenumber{265}{427e}
\createlinenumber{266}{427e}
\createlinenumber{267}{2f47}
\createlinenumber{268}{0c09}
\createlinenumber{269}{67a8}
\createlinenumber{270}{c0ad}
\createlinenumber{271}{614e}
\createlinenumber{272}{c23d}
\createlinenumber{273}{d0c6}
\createlinenumber{274}{95cf}
\createlinenumber{275}{a9b1}
\createlinenumber{276}{329b}
\createlinenumber{277}{b802}
\createlinenumber{278}{d469}
\createlinenumber{279}{d324}
\createlinenumber{280}{95cf}
\begin{lstlisting}[language={}]
#define eps 1e-8
#define fabs(x) ((x) > 0? (x): -(x))
#define zero(x) (fabs(x) < eps)
#define _sign(x) ((x)>eps?1:((x)<-eps?2:0))
#define MAXN 1000
#define offset 10000
#define sqr(x) ((x)*(x))
const double pi=acos(-1);


// 点的定义 
struct point{
  int index;
  double ang;
  double x, y;
  point(){x = 0;y = 0;}
  point(double sx, double sy){
    x = sx;
    y = sy;
  }
  bool operator <(const point &b)const{
    if (b.x == x) return y < b.y;
    return x < b.x;
  }
  point operator - (const point &b)const {
    point a;
    a.x = x - b.x;
    a.y = y - b.y;
    return a;
  }
  point operator + (const point &b)const{
    point a;
    a.x = x + b.x;
    a.y = y + b.y;
    return a;
  }
  point operator / (const double &c)const{
    point a;
    a.x = x / c;
    a.y = y / c;
    return a;
  }
  point operator * (const double &c)const{
    point a;
    a.x = x * c;
    a.y = y * c; 
    return a;
  }
  bool operator == (const point &p) const {
    return zero(x - p.x)&&zero(y - p.y);
  }
  friend ostream& operator << (ostream &out, const point &a);
};
ostream& operator << (ostream &out, const point &a){
  out<<a.x<<' '<<a.y;
  return out;
}
bool cmp(const point &p1, const point &p2){
  return p1.ang < p2.ang;
}

// 线定义, 使用< 进行极角排序之前需要对所有线段调用getang 函数 
struct line{
  double ang;
  point a, b;line(){};
  line(const point &p1, const point &p2){
    a = p1;
    b = p2;
  }
  bool operator < (const line &y)const{
    if (zero(ang - y.ang))
      return (xmult(a, y.b, y.a) < 0);
    return ang < y.ang;
  }
  void getang(){
    ang = atan2(b.y - a.y, b.x - a.x);
  }
  friend ostream& operator << (ostream &out, const line &a);
};
ostream& operator << (ostream &out, const line &a){
  out<<a.a<<' '<<a.b<<' '<<a.ang;
  return out;
}

// 圆定义 
struct circle{
  double r;
  point c;
  circle(){};
  circle(const point &p, double x){
    c = p;
    x = r;
  }
  friend ostream& operator << (ostream &out, const circle &a);
};
ostream& operator << (ostream &out, const circle &a){
  out<<a.c<<' '<<a.r;
  return out;
}
\end{lstlisting}
\subsection{点与线}
\createlinenumber{281}{427e}
\createlinenumber{282}{9060}
\createlinenumber{283}{a01c}
\createlinenumber{284}{95cf}
\createlinenumber{285}{26f9}
\createlinenumber{286}{c71e}
\createlinenumber{287}{95cf}
\createlinenumber{288}{0209}
\createlinenumber{289}{12a3}
\createlinenumber{290}{95cf}
\createlinenumber{291}{427e}
\createlinenumber{292}{427e}
\createlinenumber{293}{dbb2}
\createlinenumber{294}{6b50}
\createlinenumber{295}{95cf}
\createlinenumber{296}{8c06}
\createlinenumber{297}{4103}
\createlinenumber{298}{95cf}
\createlinenumber{299}{cb7a}
\createlinenumber{300}{d871}
\createlinenumber{301}{95cf}
\createlinenumber{302}{427e}
\createlinenumber{303}{427e}
\createlinenumber{304}{bd72}
\createlinenumber{305}{7c36}
\createlinenumber{306}{95cf}
\createlinenumber{307}{427e}
\createlinenumber{308}{427e}
\createlinenumber{309}{21ca}
\createlinenumber{310}{b08a}
\createlinenumber{311}{95cf}
\createlinenumber{312}{8046}
\createlinenumber{313}{9f44}
\createlinenumber{314}{95cf}
\createlinenumber{315}{1627}
\createlinenumber{316}{3eaf}
\createlinenumber{317}{95cf}
\createlinenumber{318}{a880}
\createlinenumber{319}{5819}
\createlinenumber{320}{95cf}
\createlinenumber{321}{427e}
\createlinenumber{322}{427e}
\createlinenumber{323}{68d7}
\createlinenumber{324}{20b6}
\createlinenumber{325}{95cf}
\createlinenumber{326}{a6a7}
\createlinenumber{327}{fc4c}
\createlinenumber{328}{95cf}
\createlinenumber{329}{427e}
\createlinenumber{330}{427e}
\createlinenumber{331}{23f7}
\createlinenumber{332}{d7f1}
\createlinenumber{333}{95cf}
\createlinenumber{334}{a66d}
\createlinenumber{335}{9f13}
\createlinenumber{336}{95cf}
\createlinenumber{337}{86fb}
\createlinenumber{338}{5e8a}
\createlinenumber{339}{95cf}
\createlinenumber{340}{427e}
\createlinenumber{341}{427e}
\createlinenumber{342}{84f5}
\createlinenumber{343}{289e}
\createlinenumber{344}{95cf}
\createlinenumber{345}{a73f}
\createlinenumber{346}{82af}
\createlinenumber{347}{95cf}
\createlinenumber{348}{0181}
\createlinenumber{349}{58c5}
\createlinenumber{350}{95cf}
\createlinenumber{351}{427e}
\createlinenumber{352}{427e}
\createlinenumber{353}{ea31}
\createlinenumber{354}{d345}
\createlinenumber{355}{95cf}
\createlinenumber{356}{8a3c}
\createlinenumber{357}{14cc}
\createlinenumber{358}{95cf}
\createlinenumber{359}{427e}
\createlinenumber{360}{427e}
\createlinenumber{361}{b5f2}
\createlinenumber{362}{95bc}
\createlinenumber{363}{95cf}
\createlinenumber{364}{d050}
\createlinenumber{365}{de06}
\createlinenumber{366}{95cf}
\createlinenumber{367}{427e}
\createlinenumber{368}{427e}
\createlinenumber{369}{efdb}
\createlinenumber{370}{92d6}
\createlinenumber{371}{95cf}
\createlinenumber{372}{3419}
\createlinenumber{373}{4806}
\createlinenumber{374}{95cf}
\createlinenumber{375}{427e}
\createlinenumber{376}{427e}
\createlinenumber{377}{7e98}
\createlinenumber{378}{980d}
\createlinenumber{379}{95cf}
\createlinenumber{380}{518c}
\createlinenumber{381}{6143}
\createlinenumber{382}{95cf}
\createlinenumber{383}{427e}
\createlinenumber{384}{427e}
\createlinenumber{385}{779d}
\createlinenumber{386}{e887}
\createlinenumber{387}{d666}
\createlinenumber{388}{efeb}
\createlinenumber{389}{95cf}
\createlinenumber{390}{2882}
\createlinenumber{391}{8fcb}
\createlinenumber{392}{4b79}
\createlinenumber{393}{cc40}
\createlinenumber{394}{95cf}
\createlinenumber{395}{427e}
\createlinenumber{396}{427e}
\createlinenumber{397}{cc64}
\createlinenumber{398}{bedb}
\createlinenumber{399}{95cf}
\createlinenumber{400}{5c8b}
\createlinenumber{401}{70ea}
\createlinenumber{402}{95cf}
\createlinenumber{403}{427e}
\createlinenumber{404}{427e}
\createlinenumber{405}{427e}
\createlinenumber{406}{afec}
\createlinenumber{407}{39f9}
\createlinenumber{408}{273a}
\createlinenumber{409}{9cb3}
\createlinenumber{410}{1143}
\createlinenumber{411}{12e9}
\createlinenumber{412}{ee0f}
\createlinenumber{413}{95cf}
\createlinenumber{414}{fbb7}
\createlinenumber{415}{f0a0}
\createlinenumber{416}{a7db}
\createlinenumber{417}{16f0}
\createlinenumber{418}{a1f8}
\createlinenumber{419}{fa1b}
\createlinenumber{420}{ee0f}
\createlinenumber{421}{95cf}
\createlinenumber{422}{427e}
\createlinenumber{423}{1cc5}
\createlinenumber{424}{671e}
\createlinenumber{425}{d118}
\createlinenumber{426}{a2fc}
\createlinenumber{427}{c99e}
\createlinenumber{428}{03b7}
\createlinenumber{429}{effa}
\createlinenumber{430}{dca4}
\createlinenumber{431}{95cf}
\createlinenumber{432}{8e2e}
\createlinenumber{433}{08d6}
\createlinenumber{434}{effa}
\createlinenumber{435}{3b6b}
\createlinenumber{436}{95cf}
\createlinenumber{437}{95cf}
\createlinenumber{438}{ee0f}
\createlinenumber{439}{95cf}
\createlinenumber{440}{427e}
\createlinenumber{441}{427e}
\createlinenumber{442}{27b7}
\createlinenumber{443}{1960}
\createlinenumber{444}{c7d0}
\createlinenumber{445}{2f7b}
\createlinenumber{446}{95cf}
\createlinenumber{447}{b7a1}
\createlinenumber{448}{1960}
\createlinenumber{449}{e925}
\createlinenumber{450}{60f2}
\createlinenumber{451}{95cf}
\createlinenumber{452}{427e}
\createlinenumber{453}{427e}
\createlinenumber{454}{a82a}
\createlinenumber{455}{9546}
\createlinenumber{456}{95cf}
\createlinenumber{457}{e8c8}
\createlinenumber{458}{ccfa}
\createlinenumber{459}{95cf}
\createlinenumber{460}{83c9}
\createlinenumber{461}{d1a4}
\createlinenumber{462}{95cf}
\createlinenumber{463}{427e}
\createlinenumber{464}{427e}
\createlinenumber{465}{59a9}
\createlinenumber{466}{1960}
\createlinenumber{467}{c7d0}
\createlinenumber{468}{c788}
\createlinenumber{469}{4763}
\createlinenumber{470}{2f7b}
\createlinenumber{471}{95cf}
\createlinenumber{472}{0e5b}
\createlinenumber{473}{1960}
\createlinenumber{474}{e925}
\createlinenumber{475}{b478}
\createlinenumber{476}{9083}
\createlinenumber{477}{60f2}
\createlinenumber{478}{95cf}
\createlinenumber{479}{427e}
\createlinenumber{480}{427e}
\createlinenumber{481}{d9a8}
\createlinenumber{482}{1960}
\createlinenumber{483}{c7d0}
\createlinenumber{484}{c788}
\createlinenumber{485}{9b41}
\createlinenumber{486}{9546}
\createlinenumber{487}{95cf}
\createlinenumber{488}{0b5b}
\createlinenumber{489}{1960}
\createlinenumber{490}{e925}
\createlinenumber{491}{b478}
\createlinenumber{492}{234b}
\createlinenumber{493}{ccfa}
\createlinenumber{494}{95cf}
\createlinenumber{495}{427e}
\createlinenumber{496}{427e}
\createlinenumber{497}{d24d}
\createlinenumber{498}{37e7}
\createlinenumber{499}{95cf}
\createlinenumber{500}{d0fd}
\createlinenumber{501}{c92c}
\createlinenumber{502}{95cf}
\createlinenumber{503}{427e}
\createlinenumber{504}{427e}
\createlinenumber{505}{546e}
\createlinenumber{506}{15e2}
\createlinenumber{507}{cee4}
\createlinenumber{508}{2350}
\createlinenumber{509}{6a5a}
\createlinenumber{510}{2bf2}
\createlinenumber{511}{0ad4}
\createlinenumber{512}{ee0f}
\createlinenumber{513}{95cf}
\createlinenumber{514}{427e}
\createlinenumber{515}{427e}
\createlinenumber{516}{f6d4}
\createlinenumber{517}{22ef}
\createlinenumber{518}{495d}
\createlinenumber{519}{84f1}
\createlinenumber{520}{7a0c}
\createlinenumber{521}{427e}
\createlinenumber{522}{95cf}
\createlinenumber{523}{427e}
\createlinenumber{524}{427e}
\createlinenumber{525}{3f0e}
\createlinenumber{526}{3e07}
\createlinenumber{527}{1f1c}
\createlinenumber{528}{ed21}
\createlinenumber{529}{085d}
\createlinenumber{530}{e586}
\createlinenumber{531}{95cf}
\createlinenumber{532}{427e}
\createlinenumber{533}{427e}
\createlinenumber{534}{452a}
\createlinenumber{535}{94c9}
\createlinenumber{536}{53df}
\createlinenumber{537}{95cf}
\createlinenumber{538}{8cb3}
\createlinenumber{539}{ce1f}
\createlinenumber{540}{95cf}
\createlinenumber{541}{427e}
\createlinenumber{542}{aab2}
\createlinenumber{543}{427e}
\createlinenumber{544}{76a4}
\createlinenumber{545}{c807}
\createlinenumber{546}{95cf}
\begin{lstlisting}[language={}]
// 计算cross product (P1-P0)x(P2-P0)
double xmult(CP &p1,CP &p2,CP &p0){
  return (p1.x-p0.x)*(p2.y-p0.y)-(p2.x-p0.x)*(p1.y-p0.y);
}
double xmult(double x1,double y1,double x2,double y2,double x0,double y0){
  return (x1-x0)*(y2-y0)-(x2-x0)*(y1-y0);
}
double xmult(CP &v1, CP &v2){
  return v1.x * v2.y - v2.x * v1.y;
}

// 计算dot product (P1-P0).(P2-P0)
double dmult(CP &p1,CP &p2,CP &p0){
  return (p1.x-p0.x)*(p2.x-p0.x)+(p1.y-p0.y)*(p2.y-p0.y);
}
double dmult(double x1,double y1,double x2,double y2,double x0,double y0){
  return (x1-x0)*(x2-x0)+(y1-y0)*(y2-y0);
}
double dmult(CP &v1, CP &v2){
  return v1.x * v2.x + v1.y * v2.y;
}

// 计算向量v 的长度
double len(CP &v){
  return sqrt((v.x * v.x) + (v.y * v.y));
}

// 两点距离
double dis(CP &p1,CP &p2){
  return sqrt((p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y));
}
double dis(double x1,double y1,double x2,double y2){
  return sqrt((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2));
}
double dis2(CP &p1,CP &p2){
  return (p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y);
}
double dis2(double x1,double y1,double x2,double y2){
  return (x1-x2)*(x1-x2)+(y1-y2)*(y1-y2);
}

// 判三点共线
int dots_inline(CP &p1,CP &p2,CP &p3){
  return zero(xmult(p1,p2,p3));
}
int dots_inline(double x1,double y1,double x2,double y2,double x3,double y3){
  return zero(xmult(x1,y1,x2,y2,x3,y3));
}

// 判点是否在线段上, 包括端点
int dot_online_in(CP &p,CL &l){
  return zero(xmult(p,l.a,l.b))&&(l.a.x-p.x)*(l.b.x-p.x)<eps&&(l.a.y-p.y)*(l.b.y-p.y)<eps;
}
int dot_online_in(CP &p,CP &l1,CP &l2){
  return zero(xmult(p,l1,l2))&&(l1.x-p.x)*(l2.x-p.x)<eps&&(l1.y-p.y)*(l2.y-p.y)<eps;
}
int dot_online_in(double x,double y,double x1,double y1,double x2,double y2){
  return zero(xmult(x,y,x1,y1,x2,y2))&&(x1-x)*(x2-x)<eps&&(y1-y)*(y2-y)<eps;
}

// 判点是否在线段上,不包括端点
int dot_online_ex(CP &p,CL &l){
  return dot_online_in(p,l)&&(!zero(p.x-l.a.x)||!zero(p.y-l.a.y))&&(!zero(p.x-l.b.x)||!zero(p.y-l.b.y));
}
int dot_online_ex(CP &p,CP &l1,CP &l2){
  return dot_online_in(p,l1,l2)&&(!zero(p.x-l1.x)||!zero(p.y-l1.y))&&(!zero(p.x-l2.x)||!zero(p.y-l2.y));
}
int dot_online_ex(double x,double y,double x1,double y1,double x2,double y2){
  return dot_online_in(x,y,x1,y1,x2,y2)&&(!zero(x-x1)||!zero(y-y1))&&(!zero(x-x2)||!zero(y-y2));
}

// 判两点在线段同侧, 点在线段上返回0 
int same_side(CP &p1,CP &p2,CL &l){
  return xmult(l.a,p1,l.b)*xmult(l.a,p2,l.b)>eps;
}
int same_side(CP &p1,CP &p2,CP &l1,CP &l2){
  return xmult(l1,p1,l2)*xmult(l1,p2,l2)>eps;
}

// 判两点在线段异侧, 点在线段上返回0 
int opposite_side(CP &p1,CP &p2,CL &l){
  return xmult(l.a,p1,l.b)*xmult(l.a,p2,l.b)<-eps;
}
int opposite_side(CP &p1,CP &p2,CP &l1,CP &l2){
  return xmult(l1,p1,l2)*xmult(l1,p2,l2)<-eps;
}

// 判两直线平行
int parallel(CL &u,CL &v){
  return zero((u.a.x-u.b.x)*(v.a.y-v.b.y)-(v.a.x-v.b.x)*(u.a.y-u.b.y));
}
int parallel(CP &u1,CP &u2,CP &v1,CP &v2){
  return zero((u1.x-u2.x)*(v1.y-v2.y)-(v1.x-v2.x)*(u1.y-u2.y));
}

// 判两直线垂直
int perpendicular(CL &u,CL &v){
  return zero((u.a.x-u.b.x)*(v.a.x-v.b.x)+(u.a.y-u.b.y)*(v.a.y-v.b.y));
}
int perpendicular(CP &u1,CP &u2,CP &v1,CP &v2){
  return zero((u1.x-u2.x)*(v1.x-v2.x)+(u1.y-u2.y)*(v1.y-v2.y));
}

// 判两线段相交, 包括端点和部分重合
int intersect_in(CL &u,CL &v){
  if (!dots_inline(u.a,u.b,v.a)||!dots_inline(u.a,u.b,v.b))
    return !same_side(u.a,u.b,v)&&!same_side(v.a,v.b,u);
  return dot_online_in(u.a,v)||dot_online_in(u.b,v)||dot_online_in(v.a,u)||dot_online_in(v.b,u);
}
int intersect_in(CP &u1,CP &u2,CP &v1,CP &v2){
  if (!dots_inline(u1,u2,v1)||!dots_inline(u1,u2,v2))
    return !same_side(u1,u2,v1,v2)&&!same_side(v1,v2,u1,u2);
  return dot_online_in(u1,v1,v2)||dot_online_in(u2,v1,v2)||dot_online_in(v1,u1,u2)||dot_online_in(v2,u1,u2);
}

// 判两线段相交, 不包括端点和部分重合
int intersect_ex(CL &u,CL &v){
  return opposite_side(u.a,u.b,v)&&opposite_side(v.a,v.b,u);
}
int intersect_ex(CP &u1,CP &u2,CP &v1,CP &v2){
  return opposite_side(u1,u2,v1,v2)&&opposite_side(v1,v2,u1,u2);
}

// 计算两直线交点, 注意事先判断直线是否平行! 
// 线段交点请另外判线段相交, 同时还是要判断是否平行
point intersection(CL &u,CL &v){
  point ret=u.a;
  double t=((u.a.x-v.a.x)*(v.a.y-v.b.y)-(u.a.y-v.a.y)*(v.a.x-v.b.x))
      /((u.a.x-u.b.x)*(v.a.y-v.b.y)-(u.a.y-u.b.y)*(v.a.x-v.b.x));
  ret.x+=(u.b.x-u.a.x)*t;
  ret.y+=(u.b.y-u.a.y)*t;
  return ret;
}
point intersection(CP &u1,CP &u2,CP &v1,CP &v2){
  point ret=u1;
  double t=((u1.x-v1.x)*(v1.y-v2.y)-(u1.y-v1.y)*(v1.x-v2.x))
      /((u1.x-u2.x)*(v1.y-v2.y)-(u1.y-u2.y)*(v1.x-v2.x));
  ret.x+=(u2.x-u1.x)*t;
  ret.y+=(u2.y-u1.y)*t;
  return ret;
}
// 求给定线段的中垂线 
line pbline(CL &l){
  line ret;ret.a = (l.a + l.b) / 2;
  double a = l.b.x - l.a.x, b = l.b.y - l.a.y;
  double c = (l.a.y - l.b.y) * ret.a.y + (l.a.x - l.b.x) * ret.a.x;
  if (!zero(a)){
    ret.b.y = 0;ret.b.x = -c / a;
    if (zero(dis(ret.a, ret.b))){
      ret.b.y = 1e10;ret.b.x = - (c - b * ret.b.y) / a;
    }
  }else{
    ret.b.x = 0.0;ret.b.y = -c / b;
    if (zero(dis(ret.a, ret.b))){
      ret.b.x = 1e10;ret.b.y = -(c - a * ret.b.x) / b;
    }
  }
  return ret;
}

// 点到直线上的最近点
point ptoline(CP &p,CL &l){
  point t=p;
  t.x+=l.a.y-l.b.y,t.y+=l.b.x-l.a.x;
  return intersection(p,t,l.a,l.b);
}
point ptoline(CP &p,CP &l1,CP &l2){
  point t=p;
  t.x+=l1.y-l2.y,t.y+=l2.x-l1.x;
  return intersection(p,t,l1,l2);
}

// 点到直线距离
double disptoline(CP &p,CL &l){
  return fabs(xmult(p,l.a,l.b))/dis(l.a,l.b);
}
double disptoline(CP &p,CP &l1,CP &l2){
  return fabs(xmult(p,l1,l2))/dis(l1,l2);
}
double disptoline(double x,double y,double x1,double y1,double x2,double y2){
  return fabs(xmult(x,y,x1,y1,x2,y2))/dis(x1,y1,x2,y2);
}

// 点到线段上的最近点
point ptoseg(CP &p,CL &l){
  point t=p;
  t.x+=l.a.y-l.b.y,t.y+=l.b.x-l.a.x;
  if (xmult(l.a,t,p)*xmult(l.b,t,p)>eps)
    return dis(p,l.a)<dis(p,l.b)?l.a:l.b;
  return intersection(p,t,l.a,l.b);
}
point ptoseg(CP &p,CP &l1,CP &l2){
  point t=p;
  t.x+=l1.y-l2.y,t.y+=l2.x-l1.x;
  if (xmult(l1,t,p)*xmult(l2,t,p)>eps)
    return dis(p,l1)<dis(p,l2)?l1:l2;
  return intersection(p,t,l1,l2);
}

// 点到线段距离
double disptoseg(CP &p,CL &l){
  point t=p;
  t.x+=l.a.y-l.b.y,t.y+=l.b.x-l.a.x;
  if (xmult(l.a,t,p)*xmult(l.b,t,p)>eps)
    return dis(p,l.a)<dis(p,l.b)?dis(p,l.a):dis(p,l.b);
  return fabs(xmult(p,l.a,l.b))/dis(l.a,l.b);
}
double disptoseg(CP &p,CP &l1,CP &l2){
  point t=p;
  t.x+=l1.y-l2.y,t.y+=l2.x-l1.x;
  if (xmult(l1,t,p)*xmult(l2,t,p)>eps)
    return dis(p,l1)<dis(p,l2)?dis(p,l1):dis(p,l2);
  return fabs(xmult(p,l1,l2))/dis(l1,l2);
}

// 线段到线段距离, 事先判断相交情况 
double dissegtoseg(CL &l1, CL &l2){
  return min(min(disptoseg(l1.a, l2), disptoseg(l1.b, l2)), min(disptoseg(l2.a, l1), disptoseg(l2.b, l1)));
}
double dissegtoseg(CP &l1a, CP &l1b, CP &l2a, CP &l2b){
  return min(min(disptoseg(l1a, l2a, l2b), disptoseg(l1b, l2a, l2b)), min(disptoseg(l2a, l1a, l1b), disptoseg(l2b, l1a, l1b)));
}

// 矢量V 以P 为顶点逆时针旋转angle 并放大scale 倍
point rotate(point v,point p,double angle,double scale){
  point ret=p;
  v.x-=p.x,v.y-=p.y;
  p.x=scale*cos(angle);
  p.y=scale*sin(angle);
  ret.x+=v.x*p.x-v.y*p.y;
  ret.y+=v.x*p.y+v.y*p.x;
  return ret;
}

// p 在新坐标系O(I,e1,e2) 中的坐标
point rotate(CP &p, CP &I, CP &e1, CP &e2){
  point p2;
  p2.x = I.x + e1.x * p.x + e1.y * p.y;
  p2.y = I.y + e2.x * p.x + e2.y * p.y;
  return p2;
  
}

//p 点绕原点按逆时针旋转angle 
point rotate(CP &p, double angle){
  point e1, e2, I;
  e1.x = cos(angle);e1.y = -sin(angle);
  e2.x = -e1.y;e2.y = e1.x;
  I.x = 0;I.y = 0;
  return rotate(p, I, e1, e2);
}

// 返回值[0, 4), 正比向量v1 到向量v2 的顺时针旋转角度 
double angle(CP &v1, CP &v2){
  double cosa = dmult(v1, v2) / len(v1) / len(v2);cosa = 1 - cosa;
  if (xmult(v1, v2) < 0) cosa = 4 - cosa;return cosa;
}
double angle(CP &v1, CP &a, CP &b){
  return angle(v1, b - a);
}
// 向量a-c 到b-c 的顺时针度数 
double angle(CP &a, CP &b, CP &c){
  //return angle(a - b, b - c);
  double cosa = dmult(a, b, c) / dis(a, c) / dis(b, c);cosa = 1 - cosa;
  if (xmult(a, b, c) < 0) cosa = 4 - cosa;return cosa;
}
\end{lstlisting}
\subsection{三角形}
\createlinenumber{547}{427e}
\createlinenumber{548}{878f}
\createlinenumber{549}{7173}
\createlinenumber{550}{2ecf}
\createlinenumber{551}{5a23}
\createlinenumber{552}{ee31}
\createlinenumber{553}{77b1}
\createlinenumber{554}{5396}
\createlinenumber{555}{8492}
\createlinenumber{556}{abe9}
\createlinenumber{557}{63ff}
\createlinenumber{558}{ed5d}
\createlinenumber{559}{95cf}
\createlinenumber{560}{427e}
\createlinenumber{561}{427e}
\createlinenumber{562}{6bd8}
\createlinenumber{563}{7173}
\createlinenumber{564}{1a7c}
\createlinenumber{565}{2aec}
\createlinenumber{566}{cd0a}
\createlinenumber{567}{4211}
\createlinenumber{568}{af8c}
\createlinenumber{569}{b80b}
\createlinenumber{570}{93b1}
\createlinenumber{571}{da57}
\createlinenumber{572}{0a23}
\createlinenumber{573}{3d04}
\createlinenumber{574}{b99c}
\createlinenumber{575}{ed5d}
\createlinenumber{576}{95cf}
\createlinenumber{577}{427e}
\createlinenumber{578}{427e}
\createlinenumber{579}{8ae2}
\createlinenumber{580}{7173}
\createlinenumber{581}{1ecd}
\createlinenumber{582}{ee31}
\createlinenumber{583}{77b1}
\createlinenumber{584}{93b1}
\createlinenumber{585}{abe9}
\createlinenumber{586}{63ff}
\createlinenumber{587}{ed5d}
\createlinenumber{588}{95cf}
\createlinenumber{589}{427e}
\createlinenumber{590}{427e}
\createlinenumber{591}{427e}
\createlinenumber{592}{427e}
\createlinenumber{593}{81bd}
\createlinenumber{594}{7173}
\createlinenumber{595}{2ecf}
\createlinenumber{596}{5a23}
\createlinenumber{597}{fad0}
\createlinenumber{598}{5396}
\createlinenumber{599}{8492}
\createlinenumber{600}{f28e}
\createlinenumber{601}{ed5d}
\createlinenumber{602}{95cf}
\createlinenumber{603}{427e}
\createlinenumber{604}{427e}
\createlinenumber{605}{427e}
\createlinenumber{606}{b0a9}
\createlinenumber{607}{03f5}
\createlinenumber{608}{c4d2}
\createlinenumber{609}{c8ed}
\createlinenumber{610}{1eb8}
\createlinenumber{611}{9137}
\createlinenumber{612}{7bf1}
\createlinenumber{613}{0fcc}
\createlinenumber{614}{13ea}
\createlinenumber{615}{9366}
\createlinenumber{616}{6701}
\createlinenumber{617}{61f3}
\createlinenumber{618}{7b0c}
\createlinenumber{619}{c013}
\createlinenumber{620}{95cf}
\createlinenumber{621}{81b0}
\createlinenumber{622}{95cf}
\begin{lstlisting}[language={}]
// 外心
point circumcenter(CP &a,CP &b,CP &c){
  line u,v;
  u.a.x=(a.x+b.x)/2;
  u.a.y=(a.y+b.y)/2;
  u.b.x=u.a.x-a.y+b.y;
  u.b.y=u.a.y+a.x-b.x;
  v.a.x=(a.x+c.x)/2;
  v.a.y=(a.y+c.y)/2;
  v.b.x=v.a.x-a.y+c.y;
  v.b.y=v.a.y+a.x-c.x;
  return intersection(u,v);
}

// 内心
point incenter(CP &a,CP &b,CP &c){
  line u,v;
  double m,n;
  u.a=a;
  m=atan2(b.y-a.y,b.x-a.x);
  n=atan2(c.y-a.y,c.x-a.x);
  u.b.x=u.a.x+cos((m+n)/2);
  u.b.y=u.a.y+sin((m+n)/2);
  v.a=b;
  m=atan2(a.y-b.y,a.x-b.x);
  n=atan2(c.y-b.y,c.x-b.x);
  v.b.x=v.a.x+cos((m+n)/2);
  v.b.y=v.a.y+sin((m+n)/2);
  return intersection(u,v);
}

// 垂心
point perpencenter(CP &a,CP &b,CP &c){
  line u,v;
  u.a=c;
  u.b.x=u.a.x-a.y+b.y;
  u.b.y=u.a.y+a.x-b.x;
  v.a=b;
  v.b.x=v.a.x-a.y+c.y;
  v.b.y=v.a.y+a.x-c.x;
  return intersection(u,v);
}

// 重心
// 到三角形三顶点距离的平方和最小的点
// 三角形内到三边距离之积最大的点
point barycenter(CP &a,CP &b,CP &c){
  line u,v;
  u.a.x=(a.x+b.x)/2;
  u.a.y=(a.y+b.y)/2;
  u.b=c;
  v.a.x=(a.x+c.x)/2;
  v.a.y=(a.y+c.y)/2;
  v.b=b;
  return intersection(u,v);
}

// 费马点
// 到三角形三顶点距离之和最小的点
point fermentpoint(CP &a,CP &b,CP &c){
  point u,v;
  double step=fabs(a.x)+fabs(a.y)+fabs(b.x)+fabs(b.y)+fabs(c.x)+fabs(c.y);
  int i,j,k;
  u.x=(a.x+b.x+c.x)/3;
  u.y=(a.y+b.y+c.y)/3;
  while (step>1e-10)
    for (k=0;k<10;step/=2,k++)
      for (i=-1;i<=1;i++)
        for (j=-1;j<=1;j++){
          v.x=u.x+step*i;
          v.y=u.y+step*j;
          if (dis(u,a)+dis(u,b)+dis(u,c)>dis(v,a)+dis(v,b)+dis(v,c))
            u=v;
        }
  return u;
}
\end{lstlisting}
\subsection{多边形}
\createlinenumber{623}{427e}
\createlinenumber{624}{7a16}
\createlinenumber{625}{53c4}
\createlinenumber{626}{cb40}
\createlinenumber{627}{1a26}
\createlinenumber{628}{e8ad}
\createlinenumber{629}{95cf}
\createlinenumber{630}{427e}
\createlinenumber{631}{427e}
\createlinenumber{632}{eba7}
\createlinenumber{633}{53c4}
\createlinenumber{634}{ae7f}
\createlinenumber{635}{1a26}
\createlinenumber{636}{e92f}
\createlinenumber{637}{95cf}
\createlinenumber{638}{427e}
\createlinenumber{639}{427e}
\createlinenumber{640}{ea98}
\createlinenumber{641}{53c4}
\createlinenumber{642}{cb40}
\createlinenumber{643}{8fa5}
\createlinenumber{644}{e8ad}
\createlinenumber{645}{95cf}
\createlinenumber{646}{427e}
\createlinenumber{647}{427e}
\createlinenumber{648}{9e0e}
\createlinenumber{649}{53c4}
\createlinenumber{650}{ae7f}
\createlinenumber{651}{8fa5}
\createlinenumber{652}{e92f}
\createlinenumber{653}{95cf}
\createlinenumber{654}{427e}
\createlinenumber{655}{427e}
\createlinenumber{656}{427e}
\createlinenumber{657}{78bd}
\createlinenumber{658}{af1a}
\createlinenumber{659}{1adf}
\createlinenumber{660}{22c1}
\createlinenumber{661}{ea47}
\createlinenumber{662}{960c}
\createlinenumber{663}{163a}
\createlinenumber{664}{19b2}
\createlinenumber{665}{6173}
\createlinenumber{666}{f875}
\createlinenumber{667}{45d2}
\createlinenumber{668}{9103}
\createlinenumber{669}{95cf}
\createlinenumber{670}{427e}
\createlinenumber{671}{427e}
\createlinenumber{672}{2e50}
\createlinenumber{673}{b779}
\createlinenumber{674}{ff68}
\createlinenumber{675}{535b}
\createlinenumber{676}{7021}
\createlinenumber{677}{2dbf}
\createlinenumber{678}{6a8f}
\createlinenumber{679}{7021}
\createlinenumber{680}{d6e2}
\createlinenumber{681}{29be}
\createlinenumber{682}{cbea}
\createlinenumber{683}{3d75}
\createlinenumber{684}{1abb}
\createlinenumber{685}{8b2e}
\createlinenumber{686}{a83a}
\createlinenumber{687}{e784}
\createlinenumber{688}{2874}
\createlinenumber{689}{abed}
\createlinenumber{690}{4b25}
\createlinenumber{691}{7021}
\createlinenumber{692}{95cf}
\createlinenumber{693}{7459}
\createlinenumber{694}{95cf}
\createlinenumber{695}{427e}
\createlinenumber{696}{427e}
\createlinenumber{697}{3a12}
\createlinenumber{698}{54ec}
\createlinenumber{699}{3444}
\createlinenumber{700}{a0f7}
\createlinenumber{701}{5b97}
\createlinenumber{702}{440f}
\createlinenumber{703}{4241}
\createlinenumber{704}{c812}
\createlinenumber{705}{0f3e}
\createlinenumber{706}{531e}
\createlinenumber{707}{1ea2}
\createlinenumber{708}{95cf}
\createlinenumber{709}{63aa}
\createlinenumber{710}{a16e}
\createlinenumber{711}{ee0f}
\createlinenumber{712}{95cf}
\createlinenumber{713}{427e}
\createlinenumber{714}{427e}
\createlinenumber{715}{427e}
\createlinenumber{716}{3a0f}
\createlinenumber{717}{7368}
\createlinenumber{718}{9894}
\createlinenumber{719}{ee09}
\createlinenumber{720}{2f5d}
\createlinenumber{721}{33c3}
\createlinenumber{722}{226e}
\createlinenumber{723}{4119}
\createlinenumber{724}{95cf}
\createlinenumber{725}{dea9}
\createlinenumber{726}{08e5}
\createlinenumber{727}{0d6a}
\createlinenumber{728}{f09f}
\createlinenumber{729}{61b6}
\createlinenumber{730}{4046}
\createlinenumber{731}{91c9}
\createlinenumber{732}{95cf}
\createlinenumber{733}{427e}
\createlinenumber{734}{427e}
\createlinenumber{735}{427e}
\createlinenumber{736}{e405}
\createlinenumber{737}{9c56}
\createlinenumber{738}{c116}
\createlinenumber{739}{bed9}
\createlinenumber{740}{a934}
\createlinenumber{741}{ef17}
\createlinenumber{742}{b31e}
\createlinenumber{743}{8674}
\createlinenumber{744}{95cf}
\createlinenumber{745}{605e}
\createlinenumber{746}{95cf}
\createlinenumber{747}{427e}
\createlinenumber{748}{427e}
\createlinenumber{749}{427e}
\createlinenumber{750}{427e}
\createlinenumber{751}{18a9}
\createlinenumber{752}{91c3}
\createlinenumber{753}{a453}
\createlinenumber{754}{f6ad}
\createlinenumber{755}{56e0}
\createlinenumber{756}{95cf}
\createlinenumber{757}{427e}
\createlinenumber{758}{427e}
\createlinenumber{759}{427e}
\createlinenumber{760}{162c}
\createlinenumber{761}{ab11}
\createlinenumber{762}{ff30}
\createlinenumber{763}{95cf}
\createlinenumber{764}{438e}
\createlinenumber{765}{95cf}
\createlinenumber{766}{427e}
\createlinenumber{767}{427e}
\createlinenumber{768}{9c74}
\createlinenumber{769}{571d}
\createlinenumber{770}{9c16}
\createlinenumber{771}{4506}
\createlinenumber{772}{f1dc}
\createlinenumber{773}{78df}
\createlinenumber{774}{605a}
\createlinenumber{775}{95cf}
\createlinenumber{776}{4206}
\createlinenumber{777}{95cf}
\createlinenumber{778}{427e}
\createlinenumber{779}{427e}
\createlinenumber{780}{2bc8}
\createlinenumber{781}{987e}
\createlinenumber{782}{9c16}
\createlinenumber{783}{4506}
\createlinenumber{784}{f1dc}
\createlinenumber{785}{78df}
\createlinenumber{786}{adf5}
\createlinenumber{787}{95cf}
\createlinenumber{788}{4206}
\createlinenumber{789}{95cf}
\createlinenumber{790}{ff80}
\createlinenumber{791}{c166}
\createlinenumber{792}{6c2f}
\createlinenumber{793}{3cec}
\createlinenumber{794}{5394}
\createlinenumber{795}{746a}
\createlinenumber{796}{95cf}
\createlinenumber{797}{66fb}
\createlinenumber{798}{95cf}
\createlinenumber{799}{427e}
\createlinenumber{800}{427e}
\createlinenumber{801}{27ad}
\createlinenumber{802}{4ab2}
\createlinenumber{803}{5db6}
\createlinenumber{804}{85c3}
\createlinenumber{805}{6f87}
\createlinenumber{806}{e725}
\createlinenumber{807}{ca57}
\createlinenumber{808}{6c2f}
\createlinenumber{809}{ff12}
\createlinenumber{810}{474d}
\createlinenumber{811}{427e}
\createlinenumber{812}{2c1f}
\createlinenumber{813}{c706}
\createlinenumber{814}{8d05}
\createlinenumber{815}{215f}
\createlinenumber{816}{09a7}
\createlinenumber{817}{1c6e}
\createlinenumber{818}{c583}
\createlinenumber{819}{8e2e}
\createlinenumber{820}{50f3}
\createlinenumber{821}{c583}
\createlinenumber{822}{8d05}
\createlinenumber{823}{95cf}
\createlinenumber{824}{95cf}
\createlinenumber{825}{4206}
\createlinenumber{826}{95cf}
\createlinenumber{827}{427e}
\createlinenumber{828}{427e}
\createlinenumber{829}{25a1}
\createlinenumber{830}{e5cd}
\createlinenumber{831}{85c3}
\createlinenumber{832}{dd26}
\createlinenumber{833}{374e}
\createlinenumber{834}{5603}
\createlinenumber{835}{aaca}
\createlinenumber{836}{3329}
\createlinenumber{837}{1aaa}
\createlinenumber{838}{231a}
\createlinenumber{839}{dbc2}
\createlinenumber{840}{3695}
\createlinenumber{841}{b333}
\createlinenumber{842}{f9ae}
\createlinenumber{843}{cb8b}
\createlinenumber{844}{a62b}
\createlinenumber{845}{95cf}
\createlinenumber{846}{95cf}
\createlinenumber{847}{52c1}
\createlinenumber{848}{427e}
\createlinenumber{849}{bd55}
\createlinenumber{850}{2927}
\createlinenumber{851}{d563}
\createlinenumber{852}{8ac5}
\createlinenumber{853}{1667}
\createlinenumber{854}{8984}
\createlinenumber{855}{154a}
\createlinenumber{856}{db17}
\createlinenumber{857}{aaed}
\createlinenumber{858}{bff1}
\createlinenumber{859}{71e0}
\createlinenumber{860}{95cf}
\createlinenumber{861}{69cc}
\createlinenumber{862}{95cf}
\createlinenumber{863}{5be3}
\createlinenumber{864}{db17}
\createlinenumber{865}{aaed}
\createlinenumber{866}{bff1}
\createlinenumber{867}{352a}
\createlinenumber{868}{95cf}
\createlinenumber{869}{95cf}
\createlinenumber{870}{1891}
\createlinenumber{871}{95cf}
\createlinenumber{872}{427e}
\createlinenumber{873}{427e}
\createlinenumber{874}{917a}
\createlinenumber{875}{45ae}
\createlinenumber{876}{95cf}
\createlinenumber{877}{427e}
\createlinenumber{878}{427e}
\createlinenumber{879}{e484}
\createlinenumber{880}{a0f7}
\createlinenumber{881}{85c3}
\createlinenumber{882}{4d87}
\createlinenumber{883}{efa0}
\createlinenumber{884}{dcba}
\createlinenumber{885}{bc29}
\createlinenumber{886}{fa79}
\createlinenumber{887}{aa88}
\createlinenumber{888}{7852}
\createlinenumber{889}{dad4}
\createlinenumber{890}{a007}
\createlinenumber{891}{f9fe}
\createlinenumber{892}{7021}
\createlinenumber{893}{ba77}
\createlinenumber{894}{f959}
\createlinenumber{895}{c049}
\createlinenumber{896}{5425}
\createlinenumber{897}{c56b}
\createlinenumber{898}{973c}
\createlinenumber{899}{95cf}
\createlinenumber{900}{f6dc}
\createlinenumber{901}{f959}
\createlinenumber{902}{1b45}
\createlinenumber{903}{5425}
\createlinenumber{904}{580b}
\createlinenumber{905}{91c9}
\createlinenumber{906}{9c73}
\createlinenumber{907}{dfe9}
\createlinenumber{908}{a1f8}
\createlinenumber{909}{f5bc}
\createlinenumber{910}{c757}
\createlinenumber{911}{95cf}
\createlinenumber{912}{427e}
\createlinenumber{913}{427e}
\createlinenumber{914}{cc70}
\createlinenumber{915}{91cb}
\createlinenumber{916}{43a2}
\createlinenumber{917}{6307}
\createlinenumber{918}{95cf}
\createlinenumber{919}{a709}
\createlinenumber{920}{6e7d}
\createlinenumber{921}{396d}
\createlinenumber{922}{b2ba}
\createlinenumber{923}{6d56}
\createlinenumber{924}{6584}
\createlinenumber{925}{fc86}
\createlinenumber{926}{427e}
\createlinenumber{927}{725f}
\createlinenumber{928}{427e}
\createlinenumber{929}{501c}
\createlinenumber{930}{1eaf}
\createlinenumber{931}{95cf}
\createlinenumber{932}{427e}
\createlinenumber{933}{427e}
\createlinenumber{934}{427e}
\createlinenumber{935}{427e}
\createlinenumber{936}{427e}
\createlinenumber{937}{427e}
\createlinenumber{938}{427e}
\createlinenumber{939}{046c}
\createlinenumber{940}{b7cd}
\createlinenumber{941}{dee3}
\createlinenumber{942}{7ec2}
\createlinenumber{943}{79fb}
\createlinenumber{944}{cecf}
\createlinenumber{945}{02e5}
\createlinenumber{946}{95cf}
\createlinenumber{947}{8562}
\createlinenumber{948}{c757}
\createlinenumber{949}{95cf}
\createlinenumber{950}{427e}
\createlinenumber{951}{427e}
\createlinenumber{952}{0ab4}
\createlinenumber{953}{57f5}
\createlinenumber{954}{57f9}
\createlinenumber{955}{6bd4}
\createlinenumber{956}{99c4}
\createlinenumber{957}{efc1}
\createlinenumber{958}{10cd}
\createlinenumber{959}{d9eb}
\createlinenumber{960}{57f9}
\createlinenumber{961}{2a97}
\createlinenumber{962}{33d7}
\createlinenumber{963}{9d48}
\createlinenumber{964}{95cf}
\createlinenumber{965}{427e}
\createlinenumber{966}{427e}
\createlinenumber{967}{427e}
\createlinenumber{968}{0c20}
\createlinenumber{969}{4e58}
\createlinenumber{970}{c9aa}
\createlinenumber{971}{8ac5}
\createlinenumber{972}{6c2f}
\createlinenumber{973}{bd2f}
\createlinenumber{974}{ab75}
\createlinenumber{975}{95cf}
\createlinenumber{976}{6c2f}
\createlinenumber{977}{8cf8}
\createlinenumber{978}{fada}
\createlinenumber{979}{a36f}
\createlinenumber{980}{6446}
\createlinenumber{981}{fe41}
\createlinenumber{982}{8d74}
\createlinenumber{983}{3524}
\createlinenumber{984}{95cf}
\createlinenumber{985}{95cf}
\createlinenumber{986}{38b6}
\createlinenumber{987}{2817}
\createlinenumber{988}{5df5}
\createlinenumber{989}{17c3}
\createlinenumber{990}{2892}
\createlinenumber{991}{8cf8}
\createlinenumber{992}{fada}
\createlinenumber{993}{a36f}
\createlinenumber{994}{6446}
\createlinenumber{995}{fe41}
\createlinenumber{996}{8d74}
\createlinenumber{997}{3524}
\createlinenumber{998}{95cf}
\createlinenumber{999}{95cf}
\createlinenumber{1000}{087b}
\createlinenumber{1001}{01a2}
\createlinenumber{1002}{3361}
\createlinenumber{1003}{95cf}
\begin{lstlisting}[language={}]
// 判定凸多边形, 顶点按顺时针或逆时针给出, 允许相邻边共线
int is_convex(int n,point* p){
  int i,s[3]={1,1,1};
  for (i=0;i<n&&s[1]|s[2];i++)
    s[_sign(xmult(p[(i+1)%n],p[(i+2)%n],p[i]))]=0;
  return s[1]|s[2];
}

// 判定凸多边形, 顶点按顺时针或逆时针给出, 不允许相邻边共线
int is_convex_v2(int n,point* p){
  int i,s[3]={1,1,1};
  for (i=0;i<n&&s[0]&&s[1]|s[2];i++)
    s[_sign(xmult(p[(i+1)%n],p[(i+2)%n],p[i]))]=0;
  return s[0]&&s[1]|s[2];
}                                   

// 判点在凸多边形内或多边形边上, 顶点按顺时针或逆时针给出
int inside_convex(CP &q,int n,point* p){
  int i,s[3]={1,1,1};
  for (i=0;i<n&&s[1]|s[2];i++)
    s[_sign(xmult(p[(i+1)%n],q,p[i]))]=0;
  return s[1]|s[2];
}

// 判点在凸多边形内, 顶点按顺时针或逆时针给出, 在多边形边上返回0
int inside_convex_v2(CP &q,int n,point* p){
  int i,s[3]={1,1,1};
  for (i=0;i<n&&s[0]&&s[1]|s[2];i++)
    s[_sign(xmult(p[(i+1)%n],q,p[i]))]=0;
  return s[0]&&s[1]|s[2];
}

// 判点在任意多边形内,顶点按顺时针或逆时针给出
// on_edge 表示点在多边形边上时的返回值,offset 为多边形坐标上限
int inside_polygon(CP &q,int n,point* p,int on_edge=1){
  point q2;
  int i=0,count;
  while (i<n)
    for (count=i=0,q2.x=rand()+offset,q2.y=rand()+offset;i<n;i++)
      if (zero(xmult(q,p[i],p[(i+1)%n]))&&(p[i].x-q.x)*(p[(i+1)%n].x-q.x)<eps&&(p[i].y-q.y)*(p[(i+1)%n].y-q.y)<eps)
        return on_edge;
      else if (zero(xmult(q,q2,p[i])))
        break;
      else if (xmult(q,p[i],q2)*xmult(q,p[(i+1)%n],q2)<-eps&&xmult(p[i],q,p[(i+1)%n])*xmult(p[i],q2,p[(i+1)%n])<-eps)
        count++;
  return count&1;
}

// 判线段在任意多边形内, 顶点按顺时针或逆时针给出, 与边界相交返回1
int inside_polygon(CP &l1,CP &l2,int n,point* p){
  point t[MAXN],tt;
  int i,j,k=0;
  if (!inside_polygon(l1,n,p)||!inside_polygon(l2,n,p))
    return 0;
  for (i=0;i<n;i++)
    if (opposite_side(l1,l2,p[i],p[(i+1)%n])&&opposite_side(p[i],p[(i+1)%n],l1,l2))
      return 0;
    else if (dot_online_in(l1,p[i],p[(i+1)%n]))
      t[k++]=l1;
    else if (dot_online_in(l2,p[i],p[(i+1)%n]))
      t[k++]=l2;
    else if (dot_online_in(p[i],l1,l2))
      t[k++]=p[i];
  for (i=0;i<k;i++)
    for (j=i+1;j<k;j++){
      tt.x=(t[i].x+t[j].x)/2;
      tt.y=(t[i].y+t[j].y)/2;
      if (!inside_polygon(tt,n,p))
        return 0;     
    }
  return 1;
}

// 多边形重心
point barycenter(int n,point* p){
  point ret,t;
  double t1=0,t2;
  int i;
  ret.x=ret.y=0;
  for (i=1;i<n-1;i++)
    if (fabs(t2=xmult(p[0],p[i],p[i+1]))>eps){
      t=barycenter(p[0],p[i],p[i+1]);
      ret.x+=t.x*t2;
      ret.y+=t.y*t2;
      t1+=t2;
    }
  if (fabs(t1)>eps)
    ret.x/=t1,ret.y/=t1;
  return ret;
}

// 将多边形沿l1,l2 确定的直线切割在side 侧切割
// 保证l1,l2,side 不共线
void polygon_cut(int& n,point* p,CP &l1,CP &l2,CP &side){
  point pp[100];
  int m=0,i;
  for (i=0;i<n;i++){
    if (same_side(p[i],side,l1,l2))
      pp[m++]=p[i];
    if (!same_side(p[i],p[(i+1)%n],l1,l2)&&!(zero(xmult(p[i],l1,l2))&&zero(xmult(p[(i+1)%n],l1,l2))))
      pp[m++]=intersection(p[i],p[(i+1)%n],l1,l2);
  }
  for (n=i=0;i<m;i++)
    if (!i||!zero(pp[i].x-pp[i-1].x)||!zero(pp[i].y-pp[i-1].y))
      p[n++]=pp[i];
  if (zero(p[n-1].x-p[0].x)&&zero(p[n-1].y-p[0].y))
    n--;
  if (n<3)
    n=0;
}

// 求平行于v 的所有射线中， 穿过的凸包中最左边的点的坐标
// 凸包点按顺时针给出 
point vector_throw_convex(int n, point *convex, CP &v){
  int s = 0;double as = angle(v, convex[s], convex[(s + 1) % n]); 
  int t = n - 1;double at = angle(v, convex[t], convex[(t + 1) % n]);
  while (s < t){
    if (as >= at){s = t;break;}int mid = (s + t + 1) / 2;
    double amid = angle(v, convex[mid], convex[(mid + 1) % n]);
    if (amid <= as){s = mid;as = amid;}
    else{t = mid - 1;at = angle(v, convex[t], convex[(t + 1) % n]);}
  }
  return convex[(s + 1) % n];
}


// 求直线l1 是否穿过凸包, 凸包按顺时针给出， 返回是否穿过
// p 储存凸包内l1 共线的某点 
bool line_throw_convex(int n, point *convex, CL &l, point &p){
  point p1 = vector_throw_convex(n, convex, l.a - l.b);
  point p2 = vector_throw_convex(n, convex, l.b - l.a);
  line l2(p1, p2);p = intersection(l, l2);
  if (dot_online_in(p, l2)) return true;return false;
}

// 求射线是否穿过凸包, 凸包按顺时针给出， 返回是否穿过
// p 储存凸包内l1 共线的某点 
bool ray_throw_convex(int n, point *convex, CL &l, point &p){
  if (line_throw_convex(n, convex, l, p)){
    if (dmult(p, l.b, l.a) >= -eps) return true;return false;
  }
  return false;
}

// 求凸包直径, 输入要求顺时针输入凸包， 没有共线的点 
double convex_diameter(int n, point *con){
  int q=1;double ans=0;
  for(int p=0;p<n;++p)
  {
    while(xmult(con[(p+1)%n],con[(q+1)%n],con[p])<xmult(con[(p+1)%n],con[q],con[p]))
      q=(q+1)%n;
    ans=max(ans,max(dis(con[p],con[q]),dis(con[(p+1)%n],con[(q+1)%n])));      
  }
  return ans; 
} 

// 求凸包最小截面， 输入要求顺时针输入凸包
double convex_min_section(int n, point *con){
  int q=1;double ans=1000000000;
  for(int p=0;p<n;++p)
  {
    while(xmult(con[(p+1)%n],con[(q+1)%n],con[p])<xmult(con[(p+1)%n],con[q],con[p]))
      q=(q+1)%n;
    ans=min(ans,disptoline(con[q], con[p], con[p + 1]));      
  }
  return ans; 
} 
double convex_min_section2(int n, point *con){
  double l1 = 1000000000;
  for (int i = 0; i < n; ++i){
    point a = con[i] - con[(i + 1) % n];
    point b = vector_throw_convex(n, con, a);
    l1 = min(l1, disptoline(b, con[i], con[i + 1]));
  }
  return l1;
}

// 求两个不包含的凸包的最短距离, 逆时针输入背包 
double convex_min_dis(int n, point *a, int m, point *b){
  int p1 = 0, p2 = 0;
  double ans = 1<<30;
  for (int i = 0; i < n; ++i)
    if (a[i].y < a[p1].y) p1 = i;
  for (int i = 0; i < m; ++i)
    if (b[i].y > b[p2].y) p2 = i;
  for (int i = 0; i < n; ++i){
    double t = xmult(b[(p2 + 1) % m], a[p1], a[(p1 + 1) % n]);
    t -= xmult(b[p2], a[p1], a[(p1 + 1) % n]);
    //cout<<p1<<' '<<p2<<' '<<t<<endl;
    if (_sign(t) == 1){
      ans = min(ans, disptoseg(a[p1], b[p2], b[(p2 + 1) % m]));
      p2 = (p2 + 1) % m;
      --i;
    }else if (_sign(t) == 2){
      ans = min(ans, disptoseg(b[p2], a[p1], a[(p1 + 1) % n]));
      p1 = (p1 + 1) % n;
    }else{
      ans = min(ans, dissegtoseg(a[p1], a[(p1 + 1) % n], b[p2], b[(p2 + 1) % m]));
      p1 = (p1 + 1) % n;
      p2 = (p2 + 1) % m;
    }
  }
  return ans;
}

// 求多边形中最长的线段， 的长度， 线段储存在l 中
double inside_polygon_max(int n,point* p, line &l){
  double len = 0;
  for (int i = 0; i < n; ++i) 
    for (int j = i + 1; j < n; ++j){
      vector<point> points;
      points.clear();
      points.push_back(p[i]);
      points.push_back(p[j]);
      for (int a = 0; a < n; ++a)
        for (int b = a + 1; b < n; ++b){
          if (a == i) continue;
          if (parallel(p[i], p[j], p[a], p[b]))
            continue;
          point p1 = intersection(p[i], p[j], p[a], p[b]);
          if (dmult(p[a], p[b], p1) <= 0){
            points.push_back(p1);
          }
        }
      sort(points.begin(), points.end());

      int s = 0;
      for (int k = 0; k < points.size() - 1; ++k){
        if (zero(dis(points[k], points[k + 1]))) continue;
        point p1;
        p1 = (points[k] + points[k + 1]) / 2;
        if (inside_polygon(p1, n, p)) continue;
        double d = dis(points[s], points[k + 1]);
        if (len < d){
          len = d;
          l.a = points[s];
          l.b = points[k + 1];
        }
        s = k + 1;
      }
      double d = dis(points[s], points[points.size() - 1]);
      if (len < d){
        len = d;
        l.a = points[s];
        l.b = points[points.size() - 1];
      }
    }
  return len;
}

// 判断点知否在半平面内, 平面位于向量左侧 
bool phplaneout(CL &l, CP &p){
  return xmult(p, l.b, l.a) > eps;
}

// 求半平面交, 平面位于向量左侧
int halfpanelcross(int n, line *lines, point *p){
  int i;
  for (int i = 0; i < n; ++i)
    lines[i].getang();
  sort(lines, lines + n);
  int m = 1;
  for (int i = 1; i < n; ++i)
    if (!zero(lines[i].ang - lines[i - 1].ang))
      lines[m++] = lines[i];
  n = m;
  int bot = 0, top = 1;
  for (int i = 2; i < n; ++i){
    if ((parallel(lines[top], lines[top - 1])||parallel(lines[bot], lines[bot + 1])))
      return 0;
    while ((bot < top)&&(xmult(intersection(lines[top], lines[top - 1]), lines[i].b, lines[i].a) > eps))
      --top;
    while ((bot < top)&&(xmult(intersection(lines[bot], lines[bot + 1]), lines[i].b, lines[i].a) > eps))
      ++bot;
    ++top;
    lines[top] = lines[i];
  }
  while ((bot < top)&&(xmult(intersection(lines[top], lines[top - 1]), lines[bot].b, lines[bot].a) > eps))
    --top;  
  while ((bot < top)&&(xmult(intersection(lines[bot], lines[bot + 1]), lines[top].b, lines[top].a) > eps))
    ++bot;
  if (top <= bot + 1) return 0;
  n = 0;
  for (int i = bot; i < top; ++i)
    p[n++] = intersection(lines[i], lines[i + 1]);
  if (bot < top + 1)
    p[n++] = intersection(lines[bot], lines[top]);
  return n;
}

// graham算法顺时针构造包含所有共线点的凸包,O(nlogn)
point p1,p2;
int graham_cp(const void* a,const void* b){
  double ret=xmult(*((point*)a),*((point*)b),p1);
  return zero(ret)?(xmult(*((point*)a),*((point*)b),p2)>0?1:-1):(ret>0?1:-1);
}
void _graham(int n,point* p,int& s,point* ch){
  int i,k=0;
  for (p1=p2=p[0],i=1;i<n;p2.x+=p[i].x,p2.y+=p[i].y,i++)
    if (p1.y-p[i].y>eps||(zero(p1.y-p[i].y)&&p1.x>p[i].x))
      p1=p[k=i];
  p2.x/=n,p2.y/=n;
  p[k]=p[0],p[0]=p1;
  //cout<<n<<endl;
  qsort(p+1,n-1,sizeof(point),graham_cp);
  //cout<<n<<endl;
  for (ch[0]=p[0],ch[1]=p[1],ch[2]=p[2],s=i=3;i<n;ch[s++]=p[i++])
    for (;s>2&&xmult(ch[s-2],p[i],ch[s-1])<-eps;s--);
}

// 构造凸包接口函数, 传入原始点集大小n, 点集p(p 原有顺序被打乱!)
// 返回凸包大小, 凸包的点在convex 中
// 参数maxsize 为1 包含共线点, 为0 不包含共线点, 缺省为1
// 参数clockwise 为1 顺时针构造, 为0 逆时针构造, 缺省为1
// 在输入仅有若干共线点时算法不稳定, 可能有此类情况请另行处理!
// 不能去掉点集中重合的点
int graham(int n,point* p,point* convex,int maxsize=1,int dir=1){
  point* temp=new point[n];
  int s,i;
  _graham(n,p,s,temp);
  for (convex[0]=temp[0],n=1,i=(dir?1:(s-1));dir?(i<s):i;i+=(dir?1:-1)){
    if (maxsize||!zero(xmult(temp[i-1],temp[i],temp[(i+1)%s])))
      convex[n++]=temp[i];
    }
  delete []temp;
  return n;
}

//求入射边u关于边v的折射角，不考虑全反射，折射率为r
line refraction(CL &u, CL &v, CP &p, double r){
  line v2;
  v2.a = p;
  v2.b.x = v.b.y - v.a.y + p.x;
  v2.b.y = v.a.x - v.b.x + p.y;
  if (dmult(v2.b - v2.a, u.b - u.a) < 0) swap(v2.a, v2.b);
  double alpha = xmult(v2.b - v2.a, u.b - u.a) / len(v2.b - v2.a) / len(u.b - u.a);
  alpha = asin(alpha / r) + atan2(v2.b.y - v2.a.y, v2.b.x - v2.a.x);
  v2.a = p;
  v2.b.x = 10 * cos(alpha) + v2.a.x;
  v2.b.y = 10 * sin(alpha) + v2.a.y;
  return v2;
}

//求入射边v关于凸包折射两次的情况，出射角保存在v中，折射率为r
//如果不相交，返回false， 不考虑镜面反射和入射到凸包角上的情况
bool refreaction(int n, point p[], line &v, double r){
  int index = -1;
  line l[n];
  point p1;
  for (int i = 0; i < n; ++i){
    l[i].a = p[i];
    l[i].b = p[(i + 1) % n];
  }
  for (int i = 0; i < n; ++i){
    if (parallel(v, l[i])) continue;
    point p2 = intersection(v, l[i]);
    if (dmult(l[i].a, l[i].b, p2) >= 0) continue;
    if (dmult(p2, v.b, v.a) <= 0) continue;
    if ((index == -1)||(dis2(p2, v.a) < dis2(p1, v.a))){
      index = i;
      p1 = p2;
    }
  }
  if (index == -1) return 0;
  swap(l[0], l[index]);
  v = refraction(v, l[0], p1, r);
  index = -1;
  for (int i = 1; i < n; ++i){
    if (parallel(v, l[i])) continue;
    point p2 = intersection(v, l[i]);
    if (dmult(l[i].a, l[i].b, p2) >= 0) continue;
    if (dmult(p2, v.b, v.a) <= 0) continue;
    if ((index == -1)||(dis2(p2, v.a) < dis2(p1, v.a))){
      index = i;
      p1 = p2;
    }
  }
  swap(l[1], l[index]);
  v = refraction(v, l[1], p1, 1 / r);
  return true;
}
\end{lstlisting}
\subsection{面积}
\createlinenumber{1004}{427e}
\createlinenumber{1005}{ab5f}
\createlinenumber{1006}{f8a3}
\createlinenumber{1007}{95cf}
\createlinenumber{1008}{243e}
\createlinenumber{1009}{1953}
\createlinenumber{1010}{95cf}
\createlinenumber{1011}{427e}
\createlinenumber{1012}{427e}
\createlinenumber{1013}{7fb2}
\createlinenumber{1014}{f36a}
\createlinenumber{1015}{7a86}
\createlinenumber{1016}{95cf}
\createlinenumber{1017}{427e}
\createlinenumber{1018}{427e}
\createlinenumber{1019}{427e}
\createlinenumber{1020}{2ed4}
\createlinenumber{1021}{0934}
\createlinenumber{1022}{a0f7}
\createlinenumber{1023}{2dbf}
\createlinenumber{1024}{e3ae}
\createlinenumber{1025}{1109}
\createlinenumber{1026}{95cf}
\begin{lstlisting}[language={}]
// 计算三角形面积, 输入三顶点
double area_triangle(CP &p1,CP &p2,CP &p3){
  return fabs(xmult(p1,p2,p3))/2;
}
double area_triangle(double x1,double y1,double x2,double y2,double x3,double y3){
  return fabs(xmult(x1,y1,x2,y2,x3,y3))/2;
}

// 计算三角形面积, 输入三边长
double area_triangle(double a,double b,double c){
  double s=(a+b+c)/2;
  return sqrt(s*(s-a)*(s-b)*(s-c));
}

// 计算多边形面积, 顶点按顺时针或逆时针给出
// 顺时针的时候， 面积为负， 逆时针的时候面积为正 
double area_polygon(int n,point* p){
  double s1=0,s2=0;
  int i;
  for (i=0;i<n;i++)
    s1+=p[(i+1)%n].y*p[i].x,s2+=p[(i+1)%n].y*p[(i+2)%n].x;
  return (s1-s2)/2;
}
\end{lstlisting}
\subsection{球面}
\createlinenumber{1027}{427e}
\createlinenumber{1028}{427e}
\createlinenumber{1029}{8176}
\createlinenumber{1030}{533a}
\createlinenumber{1031}{88a6}
\createlinenumber{1032}{a612}
\createlinenumber{1033}{d991}
\createlinenumber{1034}{ea50}
\createlinenumber{1035}{6a31}
\createlinenumber{1036}{dc31}
\createlinenumber{1037}{95cf}
\createlinenumber{1038}{427e}
\createlinenumber{1039}{427e}
\createlinenumber{1040}{3a23}
\createlinenumber{1041}{533a}
\createlinenumber{1042}{88a6}
\createlinenumber{1043}{a612}
\createlinenumber{1044}{d991}
\createlinenumber{1045}{ea50}
\createlinenumber{1046}{6a31}
\createlinenumber{1047}{24df}
\createlinenumber{1048}{95cf}
\createlinenumber{1049}{427e}
\createlinenumber{1050}{427e}
\createlinenumber{1051}{1bec}
\createlinenumber{1052}{5db0}
\createlinenumber{1053}{95cf}
\begin{lstlisting}[language={}]
// 计算圆心角lat 表示纬度,-90<=w<=90,lng 表示经度
// 返回两点所在大圆劣弧对应圆心角,0<=angle<=pi
double angle(double lng1,double lat1,double lng2,double lat2){
  double dlng=fabs(lng1-lng2)*pi/180;
  while (dlng>=pi+pi)
    dlng-=pi+pi;
  if (dlng>pi)
    dlng=pi+pi-dlng;
  lat1*=pi/180,lat2*=pi/180;
  return acos(cos(lat1)*cos(lat2)*cos(dlng)+sin(lat1)*sin(lat2));
}

// 计算距离,r 为球半径
double line_dist(double r,double lng1,double lat1,double lng2,double lat2){
  double dlng=fabs(lng1-lng2)*pi/180;
  while (dlng>=pi+pi)
    dlng-=pi+pi;
  if (dlng>pi)
    dlng=pi+pi-dlng;
  lat1*=pi/180,lat2*=pi/180;
  return r*sqrt(2-2*(cos(lat1)*cos(lat2)*cos(dlng)+sin(lat1)*sin(lat2)));
}

// 计算球面距离,r 为球半径
inline double sphere_dist(double r,double lng1,double lat1,double lng2,double lat2){
  return r*angle(lng1,lat1,lng2,lat2);
}
\end{lstlisting}
\subsection{圆}
\createlinenumber{1054}{427e}
\createlinenumber{1055}{128f}
\createlinenumber{1056}{c721}
\createlinenumber{1057}{95cf}
\createlinenumber{1058}{641a}
\createlinenumber{1059}{e25b}
\createlinenumber{1060}{95cf}
\createlinenumber{1061}{427e}
\createlinenumber{1062}{427e}
\createlinenumber{1063}{a4a8}
\createlinenumber{1064}{7ace}
\createlinenumber{1065}{481d}
\createlinenumber{1066}{6bfd}
\createlinenumber{1067}{b703}
\createlinenumber{1068}{524a}
\createlinenumber{1069}{9773}
\createlinenumber{1070}{7706}
\createlinenumber{1071}{95cf}
\createlinenumber{1072}{e3cf}
\createlinenumber{1073}{63c9}
\createlinenumber{1074}{3bc7}
\createlinenumber{1075}{6bfd}
\createlinenumber{1076}{b703}
\createlinenumber{1077}{524a}
\createlinenumber{1078}{9773}
\createlinenumber{1079}{78b0}
\createlinenumber{1080}{95cf}
\createlinenumber{1081}{427e}
\createlinenumber{1082}{e4fa}
\createlinenumber{1083}{9676}
\createlinenumber{1084}{95cf}
\createlinenumber{1085}{da9a}
\createlinenumber{1086}{14e2}
\createlinenumber{1087}{95cf}
\createlinenumber{1088}{427e}
\createlinenumber{1089}{427e}
\createlinenumber{1090}{f391}
\createlinenumber{1091}{03f5}
\createlinenumber{1092}{82e2}
\createlinenumber{1093}{e149}
\createlinenumber{1094}{6b5b}
\createlinenumber{1095}{e0a3}
\createlinenumber{1096}{8ae0}
\createlinenumber{1097}{81cd}
\createlinenumber{1098}{ceec}
\createlinenumber{1099}{95cf}
\createlinenumber{1100}{521e}
\createlinenumber{1101}{03f5}
\createlinenumber{1102}{3905}
\createlinenumber{1103}{e149}
\createlinenumber{1104}{525f}
\createlinenumber{1105}{0882}
\createlinenumber{1106}{2d9f}
\createlinenumber{1107}{fc50}
\createlinenumber{1108}{ceec}
\createlinenumber{1109}{95cf}
\createlinenumber{1110}{427e}
\createlinenumber{1111}{427e}
\createlinenumber{1112}{427e}
\createlinenumber{1113}{c8d1}
\createlinenumber{1114}{e36e}
\createlinenumber{1115}{3337}
\createlinenumber{1116}{e339}
\createlinenumber{1117}{4399}
\createlinenumber{1118}{1b68}
\createlinenumber{1119}{d753}
\createlinenumber{1120}{f468}
\createlinenumber{1121}{7618}
\createlinenumber{1122}{d8a7}
\createlinenumber{1123}{24fc}
\createlinenumber{1124}{95cf}
\createlinenumber{1125}{c26e}
\createlinenumber{1126}{92cd}
\createlinenumber{1127}{3337}
\createlinenumber{1128}{e339}
\createlinenumber{1129}{4399}
\createlinenumber{1130}{c608}
\createlinenumber{1131}{3855}
\createlinenumber{1132}{f468}
\createlinenumber{1133}{7618}
\createlinenumber{1134}{d8a7}
\createlinenumber{1135}{24fc}
\createlinenumber{1136}{95cf}
\createlinenumber{1137}{427e}
\createlinenumber{1138}{427e}
\createlinenumber{1139}{0999}
\createlinenumber{1140}{03f5}
\createlinenumber{1141}{3337}
\createlinenumber{1142}{b814}
\createlinenumber{1143}{fcc3}
\createlinenumber{1144}{3c66}
\createlinenumber{1145}{20b2}
\createlinenumber{1146}{c44e}
\createlinenumber{1147}{bb81}
\createlinenumber{1148}{95cf}
\createlinenumber{1149}{8068}
\createlinenumber{1150}{03f5}
\createlinenumber{1151}{3337}
\createlinenumber{1152}{ad39}
\createlinenumber{1153}{8414}
\createlinenumber{1154}{b2d6}
\createlinenumber{1155}{4218}
\createlinenumber{1156}{4b8b}
\createlinenumber{1157}{30f9}
\createlinenumber{1158}{95cf}
\createlinenumber{1159}{427e}
\createlinenumber{1160}{427e}
\createlinenumber{1161}{9451}
\createlinenumber{1162}{d1de}
\createlinenumber{1163}{438e}
\createlinenumber{1164}{85c3}
\createlinenumber{1165}{b348}
\createlinenumber{1166}{438e}
\createlinenumber{1167}{3361}
\createlinenumber{1168}{95cf}
\createlinenumber{1169}{0dc3}
\createlinenumber{1170}{a224}
\createlinenumber{1171}{438e}
\createlinenumber{1172}{85c3}
\createlinenumber{1173}{a14b}
\createlinenumber{1174}{438e}
\createlinenumber{1175}{3361}
\createlinenumber{1176}{95cf}
\createlinenumber{1177}{427e}
\createlinenumber{1178}{427e}
\createlinenumber{1179}{5c07}
\createlinenumber{1180}{85c3}
\createlinenumber{1181}{1b91}
\createlinenumber{1182}{438e}
\createlinenumber{1183}{3361}
\createlinenumber{1184}{95cf}
\createlinenumber{1185}{6a80}
\createlinenumber{1186}{85c3}
\createlinenumber{1187}{5c9f}
\createlinenumber{1188}{438e}
\createlinenumber{1189}{3361}
\createlinenumber{1190}{95cf}
\createlinenumber{1191}{427e}
\createlinenumber{1192}{427e}
\createlinenumber{1193}{218e}
\createlinenumber{1194}{00e3}
\createlinenumber{1195}{0e20}
\createlinenumber{1196}{736d}
\createlinenumber{1197}{0150}
\createlinenumber{1198}{fc8b}
\createlinenumber{1199}{8b80}
\createlinenumber{1200}{0c1e}
\createlinenumber{1201}{95cf}
\createlinenumber{1202}{6800}
\createlinenumber{1203}{ad5f}
\createlinenumber{1204}{5c2a}
\createlinenumber{1205}{5922}
\createlinenumber{1206}{e086}
\createlinenumber{1207}{a8d8}
\createlinenumber{1208}{b6f5}
\createlinenumber{1209}{aa9f}
\createlinenumber{1210}{95cf}
\createlinenumber{1211}{427e}
\createlinenumber{1212}{427e}
\createlinenumber{1213}{0d4d}
\createlinenumber{1214}{b709}
\createlinenumber{1215}{cc70}
\createlinenumber{1216}{d070}
\createlinenumber{1217}{6042}
\createlinenumber{1218}{6bb3}
\createlinenumber{1219}{4a4c}
\createlinenumber{1220}{ea2d}
\createlinenumber{1221}{95cf}
\createlinenumber{1222}{427e}
\createlinenumber{1223}{427e}
\createlinenumber{1224}{5ad0}
\createlinenumber{1225}{db38}
\createlinenumber{1226}{9617}
\createlinenumber{1227}{25ea}
\createlinenumber{1228}{95cf}
\createlinenumber{1229}{427e}
\createlinenumber{1230}{427e}
\createlinenumber{1231}{6ff9}
\createlinenumber{1232}{d028}
\createlinenumber{1233}{cdd7}
\createlinenumber{1234}{95cf}
\createlinenumber{1235}{427e}
\createlinenumber{1236}{427e}
\createlinenumber{1237}{8504}
\createlinenumber{1238}{427e}
\createlinenumber{1239}{7707}
\createlinenumber{1240}{a7ed}
\createlinenumber{1241}{c330}
\createlinenumber{1242}{0541}
\createlinenumber{1243}{02a8}
\createlinenumber{1244}{fa16}
\createlinenumber{1245}{8222}
\createlinenumber{1246}{119b}
\createlinenumber{1247}{87a4}
\createlinenumber{1248}{95cf}
\createlinenumber{1249}{427e}
\createlinenumber{1250}{e0ae}
\createlinenumber{1251}{427e}
\createlinenumber{1252}{425e}
\createlinenumber{1253}{1ae8}
\createlinenumber{1254}{6c2f}
\createlinenumber{1255}{427e}
\createlinenumber{1256}{427e}
\createlinenumber{1257}{899e}
\createlinenumber{1258}{427e}
\createlinenumber{1259}{03c5}
\createlinenumber{1260}{85d9}
\createlinenumber{1261}{fe45}
\createlinenumber{1262}{f1bb}
\createlinenumber{1263}{a042}
\createlinenumber{1264}{9161}
\createlinenumber{1265}{95cf}
\createlinenumber{1266}{95cf}
\createlinenumber{1267}{95cf}
\createlinenumber{1268}{427e}
\createlinenumber{1269}{427e}
\createlinenumber{1270}{71a8}
\createlinenumber{1271}{ab81}
\createlinenumber{1272}{9fff}
\createlinenumber{1273}{95cf}
\createlinenumber{1274}{427e}
\createlinenumber{1275}{427e}
\createlinenumber{1276}{4c91}
\createlinenumber{1277}{8059}
\createlinenumber{1278}{3230}
\createlinenumber{1279}{1be0}
\createlinenumber{1280}{c3b3}
\createlinenumber{1281}{6c66}
\createlinenumber{1282}{64ce}
\createlinenumber{1283}{f56c}
\createlinenumber{1284}{1e19}
\createlinenumber{1285}{98ff}
\createlinenumber{1286}{fbb4}
\createlinenumber{1287}{a4ed}
\createlinenumber{1288}{4917}
\createlinenumber{1289}{7d00}
\createlinenumber{1290}{a289}
\createlinenumber{1291}{95cf}
\createlinenumber{1292}{c890}
\createlinenumber{1293}{95cf}
\createlinenumber{1294}{bcd6}
\createlinenumber{1295}{98ff}
\createlinenumber{1296}{4917}
\createlinenumber{1297}{912e}
\createlinenumber{1298}{f0b8}
\createlinenumber{1299}{c890}
\createlinenumber{1300}{8e2e}
\createlinenumber{1301}{98ff}
\createlinenumber{1302}{4917}
\createlinenumber{1303}{f453}
\createlinenumber{1304}{8ee3}
\createlinenumber{1305}{c890}
\createlinenumber{1306}{95cf}
\createlinenumber{1307}{95cf}
\createlinenumber{1308}{427e}
\createlinenumber{1309}{427e}
\createlinenumber{1310}{baa7}
\createlinenumber{1311}{753f}
\createlinenumber{1312}{85c3}
\createlinenumber{1313}{3b9b}
\createlinenumber{1314}{80ec}
\createlinenumber{1315}{95cf}
\begin{lstlisting}[language={}]
// 判直线和圆相交, 包括相切
int intersect_line_circle(CP &c,double r,CP &l1,CP &l2){
  return disptoline(c,l1,l2)<r+eps;
}
int intersect_line_circle(CC &c,CP &l1,CP &l2){
  return disptoline(c.c,l1,l2)<c.r+eps;
}

// 判线段和圆相交, 包括端点和相切
int intersect_seg_circle(CP &c,double r,CP &l1,CP &l2){
  double t1=dis(c,l1)-r,t2=dis(c,l2)-r;
  point t=c;
  if (t1<eps||t2<eps)
    return t1>-eps||t2>-eps;
  t.x+=l1.y-l2.y;
  t.y+=l2.x-l1.x;
  return xmult(l1,c,t)*xmult(l2,c,t)<eps&&disptoline(c,l1,l2)-r<eps;
}
int intersect_seg_circle(CC &c,CP &l1,CP &l2){
  double t1=dis(c.c,l1)-c.r,t2=dis(c.c,l2)-c.r;
  point t=c.c;
  if (t1<eps||t2<eps)
    return t1>-eps||t2>-eps;
  t.x+=l1.y-l2.y;
  t.y+=l2.x-l1.x;
  return xmult(l1,c.c,t)*xmult(l2,c.c,t)<eps&&disptoline(c.c,l1,l2)-c.r<eps;
}
// 判圆和圆相交, 包括相切
int intersect_circle_circle(CP &c1,double r1,CP &c2,double r2){
  return dis(c1,c2)<r1+r2+eps&&dis(c1,c2)>fabs(r1-r2)-eps;
}
int intersect_circle_circle(CC &c1,CC &c2){
  return dis(c1.c,c2.c)<c1.r+c2.r+eps&&dis(c1.c,c2.c)>fabs(c1.r-c2.r)-eps;
}

// 计算圆上到点p 最近点, 如p 与圆心重合, 返回p 本身
point dot_to_circle(CP &c,double r,CP &p){
  point u,v;
  if (dis(p,c)<eps)
    return p;
  u.x=c.x+r*fabs(c.x-p.x)/dis(c,p);
  u.y=c.y+r*fabs(c.y-p.y)/dis(c,p)*((c.x-p.x)*(c.y-p.y)<0?-1:1);
  v.x=c.x-r*fabs(c.x-p.x)/dis(c,p);
  v.y=c.y-r*fabs(c.y-p.y)/dis(c,p)*((c.x-p.x)*(c.y-p.y)<0?-1:1);
  return dis(u,p)<dis(v,p)?u:v;
}
point dot_to_circle(CC &c,CP &p){
  point u,v;
  if (dis(p,c.c)<eps)
    return p;
  u.x=c.c.x+c.r*fabs(c.c.x-p.x)/dis(c.c,p);
  u.y=c.c.y+c.r*fabs(c.c.y-p.y)/dis(c.c,p)*((c.c.x-p.x)*(c.c.y-p.y)<0?-1:1);
  v.x=c.c.x-c.r*fabs(c.c.x-p.x)/dis(c.c,p);
  v.y=c.c.y-c.r*fabs(c.c.y-p.y)/dis(c.c,p)*((c.c.x-p.x)*(c.c.y-p.y)<0?-1:1);
  return dis(u,p)<dis(v,p)?u:v;
}

// 计算直线与圆的交点, 保证直线与圆有交点
// 计算线段与圆的交点可用这个函数后判点是否在线段上
void intersection_line_circle(CP &c,double r,CP &l1,CP &l2,point& p1,point& p2){
  point p=c;
  double t;
  p.x+=l1.y-l2.y;
  p.y+=l2.x-l1.x;
  p=intersection(p,c,l1,l2);
  t=sqrt(r*r-dis(p,c)*dis(p,c))/dis(l1,l2);
  p1.x=p.x+(l2.x-l1.x)*t;
  p1.y=p.y+(l2.y-l1.y)*t;
  p2.x=p.x-(l2.x-l1.x)*t;
  p2.y=p.y-(l2.y-l1.y)*t;
}
void intersection_line_circle(CC &c,CP &l1,CP &l2,point& p1,point& p2){
  point p=c.c;
  double t;
  p.x+=l1.y-l2.y;
  p.y+=l2.x-l1.x;
  p=intersection(p,c.c,l1,l2);
  t=sqrt(c.r*c.r-dis(p,c.c)*dis(p,c.c))/dis(l1,l2);
  p1.x=p.x+(l2.x-l1.x)*t;
  p1.y=p.y+(l2.y-l1.y)*t;
  p2.x=p.x-(l2.x-l1.x)*t;
  p2.y=p.y-(l2.y-l1.y)*t;
}

// 计算圆与圆的交点, 保证圆与圆有交点,圆心不重合
void intersection_circle_circle(CP &c1,double r1,CP &c2,double r2,point& p1,point& p2){
  point u,v;
  double t;
  t=(1+(r1*r1-r2*r2)/dis(c1,c2)/dis(c1,c2))/2;
  u.x=c1.x+(c2.x-c1.x)*t;
  u.y=c1.y+(c2.y-c1.y)*t;
  v.x=u.x+c1.y-c2.y;
  v.y=u.y-c1.x+c2.x;
  intersection_line_circle(c1,r1,u,v,p1,p2);
}
void intersection_circle_circle(CC &c1,CC &c2,point& p1,point& p2){
  point u,v;
  double t;
  t=(1+(c1.r*c1.r-c2.r*c2.r)/dis(c1.c,c2.c)/dis(c1.c,c2.c))/2;
  u.x=c1.c.x+(c2.c.x-c1.c.x)*t;
  u.y=c1.c.y+(c2.c.y-c1.c.y)*t;
  v.x=u.x+c1.c.y-c2.c.y;
  v.y=u.y-c1.c.x+c2.c.x;
  intersection_line_circle(c1.c,c1.r,u,v,p1,p2);
}

// 判断圆在多边形内, 顶点按顺时针或逆时针给出,offset 为多边形坐标上限
bool inside_circle_polygon(CP &c, double r, int n, point * polygon){
  if (!inside_polygon(c, n, polygon, 1))
    return false;
  for (int i = 0; i < n; ++i)
    if (disptoline(c,polygon[i], polygon[(i + 1) % n]) < r)
      return false;
  return true;  
} 
bool inside_circle_polygon(CC &c, int n, point * polygon){
  if (!inside_polygon(c.c, n, polygon, 1))
    return false;
  for (int i = 0; i < n; ++i)
    if (disptoline(c.c,polygon[i], polygon[(i + 1) % n]) < c.r)
      return false;
  return true;  
} 

// 判断多边形在圆内， 包括圆上 
bool inside_polygon_circle(CP &c, double r, int n, point *polygon){
  for (int i = 0; i < n; ++i)
    if (dis2(c, polygon[i]) >= r * r)
      return false;
  return true;
}
bool inside_polygon_circle(CC &c, int n, point *polygon){
  for (int i = 0; i < n; ++i)
    if (dis2(c.c, polygon[i]) >= c.r * c.r)
      return false;
  return true;
}

// 求圆外一点与圆的切线, 返回两个切点 
void tangent_point_circle(CP &c, double r, CP &p, point &a, point &b){
  double d = dis(c, p);
  double angp = acos(r / d);
  double ango = atan2(p.y - c.y, p.x - c.x);
  a.x = c.x + r * cos(ango + angp);
  a.y = c.y + r * sin(ango + angp);
  b.x = c.x + r * cos(ango - angp);
  b.y = c.y + r * sin(ango - angp);
}
void tangent_point_circle(CC &c, CP &p, point &a, point &b){
  double d = dis(c.c, p);
  double angp = acos(c.r / d);
  double ango = atan2(p.y - c.c.y, p.x - c.c.x);
  a.x = c.c.x + c.r * cos(ango + angp);
  a.y = c.c.y + c.r * sin(ango + angp);
  b.x = c.c.x + c.r * cos(ango - angp);
  b.y = c.c.y + c.r * sin(ango - angp);
}

// 求内切圆，返回两个切线
void incut_circle_circle(CP &c1,double r1,CP &c2,double r2,line& l1,line& l2){
  double d = sqrt(dis2(c1, c2) - sqr(r1 + r2));
  point p1, p2;
  intersection_circle_circle(c1, r1 + r2, c2, d, p1, p2);
  l1.a = (p1 * r1 + c1 * r2) / (r1 + r2);
  l1.b = l1.a + (c2 - p1);
  l2.a = (p2 * r1 + c1 * r2) / (r1 + r2);
  l2.b = l2.a + (c2 - p2);
}

//求原点原语扇形的夹角
double area_circle_angle(CP &p1, CP &p2, CP &c, double r){
  double alpha = fabs(atan2(p1.y - c.y, p1.x - c.x) - atan2(p2.y - c.y, p2.x - c.x));
  if (alpha > pi) alpha = 2 * pi - alpha;
  return alpha / 2 * r * r;
}

// 求三角形的的外接圆
void  circleoftri(CP &a, CP &b, CP &c, circle &tmp){
  tmp.c = circumcenter(a,b,c);
  tmp.r = dis(a, tmp.c);
}

// 求包含n 个给定点的的最小圆， n <= 3
void min_circle_reduce(int n, point *p, circle &tmp){
  //cout<<n<<endl;
  if (n == 0) tmp.r = -2;
  else if (n == 1){
    tmp.c = p[0];
    tmp.r = 0;
  }else if (n == 2){
    tmp.r = dis(p[0], p[1]) / 2;
    tmp.c = (p[0] + p[1]) / 2;
  }else if (n == 3)
    circleoftri(p[0], p[1], p[2], tmp);
} 

void min_circle(int n, point *p, int m, point *down, circle &c){
  
  min_circle_reduce(m, down, c);
  if (m == 3) return;
  for (int i = 0; i < n; ++i){
    //cout<<i<<"  "<<n<<endl;
    //cout<<dis(p[i], c.c)<<' '<<c.r<<endl;
    if (dis(p[i], c.c) > c.r){
      //cout<<m<<"yes"<<endl;
      down[m] = p[i];
      min_circle(i, p, m + 1, down, c);
      point tmp = p[i];
      for (int j = i; j >= 1; --j)
        p[j] = p[j - 1];
      p[0] = tmp;
    }
  }
} 

// 求包含n 个给定点的最小圆
void min_circle(int n, point *p, circle &c){
  point down[3];
  min_circle(n, p, 0,down,c);
}

//求圆和三角形{c p1 p2}的相交面积
double area_triangle_circle(CP &c, double r, CP &p1, CP &p2){
  double x = xmult(p2, c, p1);
  int flag = ((x)>eps?1:((x)<-eps?-1:0));
  if (flag == 0) return 0;
  double r2 = sqr(r);
  double s = 0, l1 = dis2(p1, c), l2 = dis2(p2, c);
  if ((l1 <= r2)&&(l2 <= r2))
    return area_triangle(p2, c, p1) * flag;
  if ((l1 > r2)&&(l2 > r2)){
    point p3, p4;
    s = area_circle_angle(p2, p1, c, r);
    if (disptoseg(c, p1, p2) < r){
      intersection_line_circle(c, r, p1, p2, p3, p4);
      if (dis2(p3, p1) > dis2(p4, p1)) swap(p3, p4);
      s -= area_circle_angle(p3, p4, c, r) - area_triangle(p3, c, p4);
      }
    return s * flag;
  }
  if (l1 < l2){
    point p3, p4;
    intersection_line_circle(c, r, p1, p2, p3, p4);
    if (dmult(p3, p2, p1) <= 0) p3 = p4;
    s = area_triangle(p1, p3, c) + area_circle_angle(p3, p2, c, r);
    return s * flag;
  }else{
    point p3, p4;
    intersection_line_circle(c, r, p1, p2, p3, p4);
    if (dmult(p3, p1, p2) <= 0) p3 = p4;
    s = area_triangle(p2, p3, c) + area_circle_angle(p3, p1, c, r);
    return s * flag;
  }
}

//求圆和多边形的相交面积
double area_polygon_circle(int n, point p[], CP &c, double r){
  double ans = 0;
  for (int i = 0; i < n; ++i)
    ans += area_triangle_circle(c, r, p[i], p[(i + 1) % n]);
  return fabs(ans);
}
\end{lstlisting}
\subsection{网格}
\createlinenumber{1316}{058c}
\createlinenumber{1317}{29c0}
\createlinenumber{1318}{427e}
\createlinenumber{1319}{0d5b}
\createlinenumber{1320}{5fd6}
\createlinenumber{1321}{95cf}
\createlinenumber{1322}{427e}
\createlinenumber{1323}{427e}
\createlinenumber{1324}{bd90}
\createlinenumber{1325}{54c1}
\createlinenumber{1326}{2dbf}
\createlinenumber{1327}{b3cc}
\createlinenumber{1328}{ee0f}
\createlinenumber{1329}{95cf}
\createlinenumber{1330}{427e}
\createlinenumber{1331}{427e}
\createlinenumber{1332}{b273}
\createlinenumber{1333}{54c1}
\createlinenumber{1334}{2dbf}
\createlinenumber{1335}{0639}
\createlinenumber{1336}{0ba0}
\createlinenumber{1337}{95cf}
\begin{lstlisting}[language={}]
#define abs(x) ((x)>0?(x):-(x))
struct point{int x,y;};

int gcd(int a,int b){
  return b?gcd(b,a%b):a;
}

// 多边形上的网格点个数
int grid_onedge(int n,point* p){
  int i,ret=0;
  for (i=0;i<n;i++)
    ret+=gcd(abs(p[i].x-p[(i+1)%n].x),abs(p[i].y-p[(i+1)%n].y));
  return ret;
}

// 多边形内的网格点个数
int grid_inside(int n,point* p){
  int i,ret=0;
  for (i=0;i<n;i++)
    ret+=p[(i+1)%n].y*(p[i].x-p[(i+2)%n].x);
  return (abs(ret)-grid_onedge(n,p))/2+1;
}
\end{lstlisting}
\subsection{区域中点集个数}
\createlinenumber{1338}{427e}
\createlinenumber{1339}{427e}
\createlinenumber{1340}{cfb5}
\createlinenumber{1341}{3c28}
\createlinenumber{1342}{03df}
\createlinenumber{1343}{95cf}
\createlinenumber{1344}{427e}
\createlinenumber{1345}{427e}
\createlinenumber{1346}{427e}
\createlinenumber{1347}{427e}
\createlinenumber{1348}{427e}
\createlinenumber{1349}{e42a}
\createlinenumber{1350}{283b}
\createlinenumber{1351}{53ef}
\createlinenumber{1352}{5a59}
\createlinenumber{1353}{f5d7}
\createlinenumber{1354}{150c}
\createlinenumber{1355}{fd8e}
\createlinenumber{1356}{5ffd}
\createlinenumber{1357}{95cf}
\createlinenumber{1358}{427e}
\createlinenumber{1359}{427e}
\createlinenumber{1360}{427e}
\createlinenumber{1361}{427e}
\createlinenumber{1362}{427e}
\createlinenumber{1363}{614b}
\createlinenumber{1364}{60da}
\createlinenumber{1365}{6c2f}
\createlinenumber{1366}{8abb}
\createlinenumber{1367}{fde8}
\createlinenumber{1368}{4a23}
\createlinenumber{1369}{ca58}
\createlinenumber{1370}{28c2}
\createlinenumber{1371}{2f66}
\createlinenumber{1372}{95cf}
\createlinenumber{1373}{b073}
\createlinenumber{1374}{07de}
\createlinenumber{1375}{fcfa}
\createlinenumber{1376}{ceb9}
\createlinenumber{1377}{95cf}
\createlinenumber{1378}{07b3}
\createlinenumber{1379}{9b9c}
\createlinenumber{1380}{ae6d}
\createlinenumber{1381}{917f}
\createlinenumber{1382}{95cf}
\createlinenumber{1383}{5021}
\createlinenumber{1384}{ca69}
\createlinenumber{1385}{c92b}
\createlinenumber{1386}{e5d0}
\createlinenumber{1387}{713f}
\createlinenumber{1388}{95cf}
\createlinenumber{1389}{95cf}
\createlinenumber{1390}{95cf}
\createlinenumber{1391}{427e}
\createlinenumber{1392}{427e}
\createlinenumber{1393}{427e}
\createlinenumber{1394}{427e}
\createlinenumber{1395}{251e}
\createlinenumber{1396}{35b8}
\createlinenumber{1397}{bd1e}
\createlinenumber{1398}{95cf}
\createlinenumber{1399}{427e}
\createlinenumber{1400}{427e}
\createlinenumber{1401}{427e}
\createlinenumber{1402}{427e}
\createlinenumber{1403}{427e}
\createlinenumber{1404}{73ff}
\createlinenumber{1405}{283b}
\createlinenumber{1406}{53ef}
\createlinenumber{1407}{2851}
\createlinenumber{1408}{61bc}
\createlinenumber{1409}{164e}
\createlinenumber{1410}{fd8e}
\createlinenumber{1411}{5ffd}
\createlinenumber{1412}{95cf}
\createlinenumber{1413}{427e}
\createlinenumber{1414}{427e}
\createlinenumber{1415}{427e}
\createlinenumber{1416}{427e}
\createlinenumber{1417}{427e}
\createlinenumber{1418}{3cbd}
\createlinenumber{1419}{9941}
\createlinenumber{1420}{6c2f}
\createlinenumber{1421}{8abb}
\createlinenumber{1422}{fde8}
\createlinenumber{1423}{4a23}
\createlinenumber{1424}{ca58}
\createlinenumber{1425}{28c2}
\createlinenumber{1426}{2f66}
\createlinenumber{1427}{95cf}
\createlinenumber{1428}{6613}
\createlinenumber{1429}{acb5}
\createlinenumber{1430}{6d16}
\createlinenumber{1431}{3745}
\createlinenumber{1432}{95cf}
\createlinenumber{1433}{b073}
\createlinenumber{1434}{07de}
\createlinenumber{1435}{fcfa}
\createlinenumber{1436}{ceb9}
\createlinenumber{1437}{95cf}
\createlinenumber{1438}{07b3}
\createlinenumber{1439}{9b9c}
\createlinenumber{1440}{8ddd}
\createlinenumber{1441}{917f}
\createlinenumber{1442}{95cf}
\createlinenumber{1443}{85b2}
\createlinenumber{1444}{ca69}
\createlinenumber{1445}{c92b}
\createlinenumber{1446}{e5d0}
\createlinenumber{1447}{95cf}
\createlinenumber{1448}{2410}
\createlinenumber{1449}{5021}
\createlinenumber{1450}{713f}
\createlinenumber{1451}{95cf}
\createlinenumber{1452}{95cf}
\createlinenumber{1453}{95cf}
\createlinenumber{1454}{95cf}
\begin{lstlisting}[language={}]
// 求p1 中任意三点切割的七个区域的p1 点集的个数, 要求三点不共线 
// 求xy 到xz 角度里点的个数 
int pointinang(int x, int y, int z, int m, int f[][MAXN], int index[][MAXN]){
  if (index[x][z] < index[x][y]) return m + f[x][z] - f[x][y] + 1;
  return f[x][z] - f[x][y] - 1;
}

// 求三角形xyz 中的点的个数, 输入总的点的个数,  
//f[x][y] 表示x 为中心ang 比y 小的点的个数
//h[x][y] 表示xy 左边的点的个数
//index[x][y] 表示x 为中心极角排序后的序 
int pointintri(point p[], int x, int y, int z, int m, int f[][MAXN], int h[][MAXN], int index[][MAXN]){
  if (xmult(p[z], p[y], p[x]) > 0) swap(y, z);
  int a = h[x][z] + h[y][x] + h[z][y];
  a += pointinang(x, y, z, m, f, index);
  a += pointinang(y, z, x, m, f, index);
  a += pointinang(z, x, y, m, f, index);
  a -= 2 * m;
  return a;
}

// 求p1 任意三点划分的区域的点的个数, 要求三点不共线  
//f[x][y] 表示x 为中心ang 比y 小的点的个数
//h[x][y] 表示xy 左边的点的个数
//index[x][y] 表示x 为中心极角排序后的序 
void pointinarea(int n, point p1[], int f[][MAXN], int h[][MAXN], int index[][MAXN]){
  point p[2 * MAXN];
  for (int i = 0; i < n; ++i){
    int cnt = 0;
    for (int j = 0; j < n; ++j)
      if (i != j){
        p[cnt] = p1[j];
        p[cnt].index = j;
        p[cnt++].ang = atan2(p1[j].y - p1[i].y, p1[j].x - p1[i].x);
      }
    sort(p, p + cnt, cmp);
    for (int j = 0; j < cnt; ++j){
      p[j + cnt] = p[j];
      p[j + cnt].ang += 2 * pi;
    }
    for (int k = 0, j = 0, mine = 0, l = 0; k < cnt; ++k){
      while (p[j].ang - p[k].ang < pi){
        ++mine;
        ++j;
      }
      --mine;
      h[i][p[k].index] = mine;
      f[i][p[k].index] = l;
      index[i][p[k].index] = k;
      ++l;
    }
  }
}


// 求p1 中任意三点切割的七个区域的p2 点集的个数, 要求三点不共线 
// 求xy 到xz 角度里点的个数 
int pointinang2(int x, int y, int z, int m, int f[][MAXN], int index[][MAXN]){
  if (index[x][z] < index[x][y]) return m + f[x][z] - f[x][y];
  return f[x][z] - f[x][y];
}

// 求三角形xyz 中的点的个数, 输入总的点的个数,  
//f[x][y] 表示x 为中心ang 比y 小的点的个数
//h[x][y] 表示xy 左边的点的个数
//index[x][y] 表示x 为中心极角排序后的序 
int pointintri2(point p[], int x, int y, int z, int m, int f[][MAXN], int h[][MAXN], int index[][MAXN]){
  if (xmult(p[z], p[y], p[x]) > 0) swap(y, z);
  int a = h[x][z] + h[y][x] + h[z][y];
  a += pointinang2(x, y, z, m, f, index);
  a += pointinang2(y, z, x, m, f, index);
  a += pointinang2(z, x, y, m, f, index);
  a -= 2 * m;
  return a;
}

// 求p1 任意三点划分的区域的p2 点的个数, 要求三点不共线  
//f[x][y] 表示x 为中心ang 比y 小的点的个数
//h[x][y] 表示xy 左边的点的个数
//index[x][y] 表示x 为中心极角排序后的序 
void pointinarea2(int n, point p1[], int m, point p2[], int f[][MAXN], int h[][MAXN], int index[][MAXN]){
  point p[2 * (MAXN + MAXM)];
  for (int i = 0; i < n; ++i){
    int cnt = 0;
    for (int j = 0; j < n; ++j)
      if (i != j){
        p[cnt] = p1[j];
        p[cnt].index = j;
        p[cnt++].ang = atan2(p1[j].y - p1[i].y, p1[j].x - p1[i].x);
      }
    for (int j = 0; j < m; ++j){
        p[cnt] = p2[j];
        p[cnt].index = n + j;
        p[cnt++].ang = atan2(p2[j].y - p1[i].y, p2[j].x - p1[i].x);
      }
    sort(p, p + cnt, cmp);
    for (int j = 0; j < cnt; ++j){
      p[j + cnt] = p[j];
      p[j + cnt].ang += 2 * pi;
    }
    for (int k = 0, j = 0, mine = 0, l = 0; k < cnt; ++k){
      while (p[j].ang - p[k].ang < pi){
        if (p[j].index >= n) ++mine;
        ++j;
      }
      if (p[k].index < n){
        h[i][p[k].index] = mine;
        f[i][p[k].index] = l;
        index[i][p[k].index] = k;
      }
      if (p[k].index >= n){
        --mine;
        ++l;
      }
    }
  }
}
\end{lstlisting}

\section{三维计算几何}
\subsection{定义}
\createlinenumber{1455}{652e}
\createlinenumber{1456}{c1b0}
\createlinenumber{1457}{0102}
\createlinenumber{1458}{dca2}
\createlinenumber{1459}{12d8}
\createlinenumber{1460}{13f1}
\createlinenumber{1461}{427e}
\createlinenumber{1462}{427e}
\createlinenumber{1463}{b6b2}
\createlinenumber{1464}{9d7e}
\createlinenumber{1465}{6c19}
\createlinenumber{1466}{18ee}
\createlinenumber{1467}{e87b}
\createlinenumber{1468}{d22b}
\createlinenumber{1469}{826b}
\createlinenumber{1470}{95cf}
\createlinenumber{1471}{548e}
\createlinenumber{1472}{1737}
\createlinenumber{1473}{e65c}
\createlinenumber{1474}{326b}
\createlinenumber{1475}{95cf}
\createlinenumber{1476}{66d1}
\createlinenumber{1477}{95cf}
\createlinenumber{1478}{bb9f}
\createlinenumber{1479}{d6bc}
\createlinenumber{1480}{d53d}
\createlinenumber{1481}{5365}
\createlinenumber{1482}{eb85}
\createlinenumber{1483}{5ffd}
\createlinenumber{1484}{95cf}
\createlinenumber{1485}{c055}
\createlinenumber{1486}{d6bc}
\createlinenumber{1487}{7683}
\createlinenumber{1488}{70a0}
\createlinenumber{1489}{ee56}
\createlinenumber{1490}{5ffd}
\createlinenumber{1491}{95cf}
\createlinenumber{1492}{1731}
\createlinenumber{1493}{d6bc}
\createlinenumber{1494}{225c}
\createlinenumber{1495}{414d}
\createlinenumber{1496}{155b}
\createlinenumber{1497}{5ffd}
\createlinenumber{1498}{95cf}
\createlinenumber{1499}{4f46}
\createlinenumber{1500}{d6bc}
\createlinenumber{1501}{7aa6}
\createlinenumber{1502}{9a5c}
\createlinenumber{1503}{f068}
\createlinenumber{1504}{5ffd}
\createlinenumber{1505}{95cf}
\createlinenumber{1506}{412f}
\createlinenumber{1507}{84cf}
\createlinenumber{1508}{95cf}
\createlinenumber{1509}{c712}
\createlinenumber{1510}{329b}
\createlinenumber{1511}{1da1}
\createlinenumber{1512}{5d5d}
\createlinenumber{1513}{d324}
\createlinenumber{1514}{95cf}
\createlinenumber{1515}{427e}
\createlinenumber{1516}{427e}
\createlinenumber{1517}{3cfc}
\createlinenumber{1518}{2f60}
\createlinenumber{1519}{2f79}
\createlinenumber{1520}{64c6}
\createlinenumber{1521}{0fa8}
\createlinenumber{1522}{ce41}
\createlinenumber{1523}{95cf}
\createlinenumber{1524}{e69c}
\createlinenumber{1525}{329b}
\createlinenumber{1526}{0e98}
\createlinenumber{1527}{ad81}
\createlinenumber{1528}{d324}
\createlinenumber{1529}{95cf}
\createlinenumber{1530}{427e}
\createlinenumber{1531}{427e}
\createlinenumber{1532}{a1a2}
\begin{lstlisting}[language={}]
#define eps 1e-8
#define fabs(x) ((x) > 0? (x): -(x))
#define zero(x) (fabs(x) < eps)
#define sqr(x) ((x)*(x))
#define _sign(x) ((x)>eps?1:((x)<-eps?2:0))
const double pi = acos(-1);

// 点的定义 
struct point3{
  double x, y, z;
  point3(){x = 0;y = 0;z = 0;}
  point3(double sx, double sy, double sz){
    x = sx;
    y = sy;
    z = sz;
    }
  bool operator <(const point3 &b)const{
    if (b.x == x){
      if (y == b.y) return z < b.z;
      return y < b.y;
    }
    return x < b.x;
  }
  point3 operator - (const point3 &b)const {
    point3 a;
    a.x = x - b.x;
    a.y = y - b.y;
    a.z = z - b.z;
    return a;
  }
  point3 operator + (const point3 &b)const{
    point3 a;
    a.x = x + b.x;
    a.y = y + b.y;
    a.z = z + b.z;
    return a;
  }
  point3 operator / (const double &c)const{
    point3 a;
    a.x = x / c;
    a.y = y / c;
    a.z = z / c;
    return a;
  }
  point3 operator * (const double &c)const{
    point3 a;
    a.x = x * c;
    a.y = y * c; 
    a.z = z * c;
    return a;
  }
  bool operator == (const point3 &p) const {
    return zero(x - p.x)&&zero(y - p.y)&&zero(z - p.z);
  }
  friend ostream& operator << (ostream &out, const point3 &a);
};
ostream& operator << (ostream &out, const point3 &a){
  out<<a.x<<' '<<a.y<<' '<<a.z;
  return out;
}

// 边定义
struct line3{
  point3 a, b;
  line3(){};
  line3(const point3 &p1, const point3 &p2){
    a = p1;
    b = p2;
  }
  friend ostream& operator << (ostream &out, const line3 &a);
};
ostream& operator << (ostream &out, const line3 &a){
  out<<a.a<<' '<<a.b<<' ';
  return out;
}

// 面定义
struct plane3{point3 a,b,c;};
\end{lstlisting}
\subsection{点线面}
\createlinenumber{1533}{427e}
\createlinenumber{1534}{c4b1}
\createlinenumber{1535}{92b5}
\createlinenumber{1536}{97a6}
\createlinenumber{1537}{55e0}
\createlinenumber{1538}{cf98}
\createlinenumber{1539}{ee0f}
\createlinenumber{1540}{95cf}
\createlinenumber{1541}{427e}
\createlinenumber{1542}{427e}
\createlinenumber{1543}{f42e}
\createlinenumber{1544}{49f2}
\createlinenumber{1545}{95cf}
\createlinenumber{1546}{427e}
\createlinenumber{1547}{427e}
\createlinenumber{1548}{388c}
\createlinenumber{1549}{07d5}
\createlinenumber{1550}{95cf}
\createlinenumber{1551}{afb0}
\createlinenumber{1552}{fd86}
\createlinenumber{1553}{95cf}
\createlinenumber{1554}{427e}
\createlinenumber{1555}{427e}
\createlinenumber{1556}{9e30}
\createlinenumber{1557}{fafb}
\createlinenumber{1558}{95cf}
\createlinenumber{1559}{be8b}
\createlinenumber{1560}{5cdd}
\createlinenumber{1561}{95cf}
\createlinenumber{1562}{427e}
\createlinenumber{1563}{427e}
\createlinenumber{1564}{81ce}
\createlinenumber{1565}{2aa8}
\createlinenumber{1566}{95cf}
\createlinenumber{1567}{427e}
\createlinenumber{1568}{427e}
\createlinenumber{1569}{d4bb}
\createlinenumber{1570}{f368}
\createlinenumber{1571}{95cf}
\createlinenumber{1572}{427e}
\createlinenumber{1573}{427e}
\createlinenumber{1574}{2e86}
\createlinenumber{1575}{03fd}
\createlinenumber{1576}{95cf}
\createlinenumber{1577}{427e}
\createlinenumber{1578}{427e}
\createlinenumber{1579}{e21b}
\createlinenumber{1580}{5cd9}
\createlinenumber{1581}{7c2a}
\createlinenumber{1582}{0643}
\createlinenumber{1583}{4305}
\createlinenumber{1584}{95cf}
\createlinenumber{1585}{ac26}
\createlinenumber{1586}{2feb}
\createlinenumber{1587}{0a0b}
\createlinenumber{1588}{6f88}
\createlinenumber{1589}{51be}
\createlinenumber{1590}{95cf}
\createlinenumber{1591}{427e}
\createlinenumber{1592}{427e}
\createlinenumber{1593}{bd50}
\createlinenumber{1594}{02c3}
\createlinenumber{1595}{95cf}
\createlinenumber{1596}{f8de}
\createlinenumber{1597}{35c7}
\createlinenumber{1598}{95cf}
\createlinenumber{1599}{427e}
\createlinenumber{1600}{427e}
\createlinenumber{1601}{9b58}
\createlinenumber{1602}{de8c}
\createlinenumber{1603}{febf}
\createlinenumber{1604}{95cf}
\createlinenumber{1605}{e9f4}
\createlinenumber{1606}{cc89}
\createlinenumber{1607}{daa7}
\createlinenumber{1608}{95cf}
\createlinenumber{1609}{427e}
\createlinenumber{1610}{427e}
\createlinenumber{1611}{6d33}
\createlinenumber{1612}{ac70}
\createlinenumber{1613}{1c47}
\createlinenumber{1614}{f1de}
\createlinenumber{1615}{95cf}
\createlinenumber{1616}{bcde}
\createlinenumber{1617}{3430}
\createlinenumber{1618}{505b}
\createlinenumber{1619}{f5c1}
\createlinenumber{1620}{95cf}
\createlinenumber{1621}{427e}
\createlinenumber{1622}{427e}
\createlinenumber{1623}{7ef7}
\createlinenumber{1624}{d86a}
\createlinenumber{1625}{95cf}
\createlinenumber{1626}{0410}
\createlinenumber{1627}{0b72}
\createlinenumber{1628}{95cf}
\createlinenumber{1629}{427e}
\createlinenumber{1630}{427e}
\createlinenumber{1631}{9477}
\createlinenumber{1632}{faa2}
\createlinenumber{1633}{95cf}
\createlinenumber{1634}{76a6}
\createlinenumber{1635}{4ffb}
\createlinenumber{1636}{95cf}
\createlinenumber{1637}{427e}
\createlinenumber{1638}{427e}
\createlinenumber{1639}{3b4b}
\createlinenumber{1640}{e2bb}
\createlinenumber{1641}{95cf}
\createlinenumber{1642}{7b77}
\createlinenumber{1643}{94f6}
\createlinenumber{1644}{95cf}
\createlinenumber{1645}{427e}
\createlinenumber{1646}{427e}
\createlinenumber{1647}{9512}
\createlinenumber{1648}{fe1f}
\createlinenumber{1649}{95cf}
\createlinenumber{1650}{05f5}
\createlinenumber{1651}{9067}
\createlinenumber{1652}{95cf}
\createlinenumber{1653}{427e}
\createlinenumber{1654}{427e}
\createlinenumber{1655}{490a}
\createlinenumber{1656}{1ac2}
\createlinenumber{1657}{95cf}
\createlinenumber{1658}{7409}
\createlinenumber{1659}{8751}
\createlinenumber{1660}{95cf}
\createlinenumber{1661}{427e}
\createlinenumber{1662}{427e}
\createlinenumber{1663}{3062}
\createlinenumber{1664}{c6ae}
\createlinenumber{1665}{95cf}
\createlinenumber{1666}{7d09}
\createlinenumber{1667}{ef70}
\createlinenumber{1668}{95cf}
\createlinenumber{1669}{427e}
\createlinenumber{1670}{427e}
\createlinenumber{1671}{454a}
\createlinenumber{1672}{31d4}
\createlinenumber{1673}{95cf}
\createlinenumber{1674}{06d0}
\createlinenumber{1675}{d311}
\createlinenumber{1676}{95cf}
\createlinenumber{1677}{427e}
\createlinenumber{1678}{427e}
\createlinenumber{1679}{b98a}
\createlinenumber{1680}{85bf}
\createlinenumber{1681}{95cf}
\createlinenumber{1682}{b77b}
\createlinenumber{1683}{4547}
\createlinenumber{1684}{95cf}
\createlinenumber{1685}{427e}
\createlinenumber{1686}{427e}
\createlinenumber{1687}{0e75}
\createlinenumber{1688}{da40}
\createlinenumber{1689}{95cf}
\createlinenumber{1690}{75f2}
\createlinenumber{1691}{8919}
\createlinenumber{1692}{95cf}
\createlinenumber{1693}{427e}
\createlinenumber{1694}{427e}
\createlinenumber{1695}{16f9}
\createlinenumber{1696}{ff31}
\createlinenumber{1697}{95cf}
\createlinenumber{1698}{d6d3}
\createlinenumber{1699}{d501}
\createlinenumber{1700}{95cf}
\createlinenumber{1701}{427e}
\createlinenumber{1702}{427e}
\createlinenumber{1703}{dfe1}
\createlinenumber{1704}{5163}
\createlinenumber{1705}{7021}
\createlinenumber{1706}{e887}
\createlinenumber{1707}{d666}
\createlinenumber{1708}{efeb}
\createlinenumber{1709}{95cf}
\createlinenumber{1710}{2b77}
\createlinenumber{1711}{cedb}
\createlinenumber{1712}{7021}
\createlinenumber{1713}{8fcb}
\createlinenumber{1714}{4b79}
\createlinenumber{1715}{cc40}
\createlinenumber{1716}{95cf}
\createlinenumber{1717}{427e}
\createlinenumber{1718}{427e}
\createlinenumber{1719}{ea94}
\createlinenumber{1720}{6c51}
\createlinenumber{1721}{95cf}
\createlinenumber{1722}{aa4a}
\createlinenumber{1723}{6424}
\createlinenumber{1724}{95cf}
\createlinenumber{1725}{427e}
\createlinenumber{1726}{427e}
\createlinenumber{1727}{4e75}
\createlinenumber{1728}{8378}
\createlinenumber{1729}{153b}
\createlinenumber{1730}{95cf}
\createlinenumber{1731}{e9ac}
\createlinenumber{1732}{3c9d}
\createlinenumber{1733}{89da}
\createlinenumber{1734}{95cf}
\createlinenumber{1735}{427e}
\createlinenumber{1736}{427e}
\createlinenumber{1737}{2571}
\createlinenumber{1738}{02e8}
\createlinenumber{1739}{f9f7}
\createlinenumber{1740}{95cf}
\createlinenumber{1741}{ebd9}
\createlinenumber{1742}{3e15}
\createlinenumber{1743}{ebb0}
\createlinenumber{1744}{95cf}
\createlinenumber{1745}{427e}
\createlinenumber{1746}{427e}
\createlinenumber{1747}{427e}
\createlinenumber{1748}{58cf}
\createlinenumber{1749}{87cc}
\createlinenumber{1750}{273a}
\createlinenumber{1751}{9cb3}
\createlinenumber{1752}{1143}
\createlinenumber{1753}{12e9}
\createlinenumber{1754}{1037}
\createlinenumber{1755}{ee0f}
\createlinenumber{1756}{95cf}
\createlinenumber{1757}{b3fa}
\createlinenumber{1758}{1fef}
\createlinenumber{1759}{a7db}
\createlinenumber{1760}{16f0}
\createlinenumber{1761}{a1f8}
\createlinenumber{1762}{fa1b}
\createlinenumber{1763}{d408}
\createlinenumber{1764}{ee0f}
\createlinenumber{1765}{95cf}
\createlinenumber{1766}{427e}
\createlinenumber{1767}{427e}
\createlinenumber{1768}{427e}
\createlinenumber{1769}{1f8f}
\createlinenumber{1770}{a582}
\createlinenumber{1771}{f84a}
\createlinenumber{1772}{7e59}
\createlinenumber{1773}{6247}
\createlinenumber{1774}{6934}
\createlinenumber{1775}{706b}
\createlinenumber{1776}{ee0f}
\createlinenumber{1777}{95cf}
\createlinenumber{1778}{2ec4}
\createlinenumber{1779}{2f24}
\createlinenumber{1780}{38b0}
\createlinenumber{1781}{e0f5}
\createlinenumber{1782}{6302}
\createlinenumber{1783}{9cd9}
\createlinenumber{1784}{29b2}
\createlinenumber{1785}{ee0f}
\createlinenumber{1786}{95cf}
\createlinenumber{1787}{427e}
\createlinenumber{1788}{427e}
\createlinenumber{1789}{69e4}
\createlinenumber{1790}{57af}
\createlinenumber{1791}{7b9a}
\createlinenumber{1792}{033e}
\createlinenumber{1793}{ee0f}
\createlinenumber{1794}{95cf}
\createlinenumber{1795}{68d7}
\createlinenumber{1796}{57af}
\createlinenumber{1797}{0075}
\createlinenumber{1798}{2a2b}
\createlinenumber{1799}{ee0f}
\createlinenumber{1800}{95cf}
\createlinenumber{1801}{427e}
\createlinenumber{1802}{427e}
\createlinenumber{1803}{3696}
\createlinenumber{1804}{eddb}
\createlinenumber{1805}{95cf}
\createlinenumber{1806}{c402}
\createlinenumber{1807}{c833}
\createlinenumber{1808}{95cf}
\createlinenumber{1809}{427e}
\createlinenumber{1810}{427e}
\createlinenumber{1811}{7ed7}
\createlinenumber{1812}{b87b}
\createlinenumber{1813}{95cf}
\createlinenumber{1814}{33d1}
\createlinenumber{1815}{3cea}
\createlinenumber{1816}{95cf}
\createlinenumber{1817}{427e}
\createlinenumber{1818}{427e}
\createlinenumber{1819}{eaed}
\createlinenumber{1820}{79e9}
\createlinenumber{1821}{2a04}
\createlinenumber{1822}{95cf}
\createlinenumber{1823}{c288}
\createlinenumber{1824}{a9a1}
\createlinenumber{1825}{04de}
\createlinenumber{1826}{95cf}
\createlinenumber{1827}{427e}
\createlinenumber{1828}{427e}
\createlinenumber{1829}{7010}
\createlinenumber{1830}{0567}
\createlinenumber{1831}{95cf}
\createlinenumber{1832}{a590}
\createlinenumber{1833}{b4cf}
\createlinenumber{1834}{95cf}
\createlinenumber{1835}{427e}
\createlinenumber{1836}{427e}
\createlinenumber{1837}{5766}
\createlinenumber{1838}{8688}
\createlinenumber{1839}{95cf}
\createlinenumber{1840}{2053}
\createlinenumber{1841}{a583}
\createlinenumber{1842}{95cf}
\createlinenumber{1843}{427e}
\createlinenumber{1844}{427e}
\createlinenumber{1845}{9344}
\createlinenumber{1846}{2177}
\createlinenumber{1847}{95cf}
\createlinenumber{1848}{e36a}
\createlinenumber{1849}{14dc}
\createlinenumber{1850}{95cf}
\begin{lstlisting}[language={}]
// 计算cross product U x V
point3 xmult(const point3 &u, const point3 &v){
  point3 ret;
  ret.x = u.y * v.z - v.y * u.z;
  ret.y = u.z * v.x - u.x * v.z;
  ret.z = u.x * v.y - u.y * v.x;
  return ret;
}

// 计算dot product U . V
double dmult(const point3 &u, const point3 &v){
  return u.x * v.x + u.y * v.y + u.z * v.z;
}

// 取平面法向量
point3 pvec(const plane3 &s){
  return xmult(s.a - s.b, s.b - s.c);
}
point3 pvec(const point3 &s1, const point3 &s2, const point3 &s3){
  return xmult(s1 - s2, s2 - s3);
}

// 两点距离, 单参数取向量大小
double dis(const point3 &p1, const point3 &p2){
  return sqrt(sqr(p1.x - p2.x) + sqr(p1.y - p2.y) + sqr(p1.z - p2.z));
}
double dis2(const point3 &p1, const point3 &p2){
  return sqr(p1.x - p2.x) + sqr(p1.y - p2.y) + sqr(p1.z - p2.z);
}

// 向量大小
double len(const point3 &p){
  return sqrt(sqr(p.x) + sqr(p.y) + sqr(p.z));
}

// 判三点共线
int dots_inline(const point3 &p1, const point3 &p2,const point3 &p3){
  return len(xmult(p1 - p2, p2 - p3)) < eps;
}

// 判四点共面
int dots_onplane(const point3 &a, const point3 &b, const point3 &c, const point3 &d){
  return zero(dmult(pvec(a, b, c), d - a));
}

// 判点是否在线段上, 包括端点和共线
int dot_online_in(const point3 &p, const line3 &l){
  return zero(len(xmult(p - l.a, p - l.b)))&&
    (l.a.x - p.x) * (l.b.x - p.x) < eps&&
    (l.a.y - p.y) * (l.b.y - p.y) < eps&&
    (l.a.z - p.z) * (l.b.z - p.z) < eps;
}
int dot_online_in(const point3 &p, const point3 &l1, const point3 &l2){
  return zero(len(xmult(p - l1,p - l2)))&&
    (l1.x - p.x) * (l2.x - p.x) < eps&&
    (l1.y - p.y) * (l2.y - p.y) < eps&&
    (l1.z - p.z) * (l2.z - p.z) < eps;
}

// 判点是否在线段上, 不包括端点
int dot_online_ex(const point3 &p, const line3 &l){
  return dot_online_in(p, l) && (!(p == l.a))&&(!(p == l.b));
}
int dot_online_ex(const point3 &p, const point3 &l1, const point3 &l2){
  return dot_online_in(p, l1, l2) && (!(p == l1))&&(!(p == l2));
}

// 判点是否在空间三角形上, 包括边界, 三点共线无意义
int dot_inplane_in(const point3 &p, const plane3 &s){
  return zero(len(xmult(s.a - s.b, s.a - s.c)) - len(xmult(p - s.a, p - s.b))-
    len(xmult(p - s.b, p - s.c)) - len(xmult(p - s.c, p - s.a)));
}
int dot_inplane_in(const point3 &p, const point3 &s1, const point3 &s2, const point3 &s3){
  return zero(len(xmult(s1 - s2, s1 - s3)) - len(xmult(p - s1, p - s2))-
    len(xmult(p - s2, p - s3)) - len(xmult(p - s3, p - s1)));
}

// 判点是否在空间三角形上, 不包括边界, 三点共线无意义
int dot_inplane_ex(const point3 &p, const plane3 &s){
  return dot_inplane_in(p, s) && len(xmult(p - s.a, p - s.b)) > eps &&
    len(xmult(p - s.b, p - s.c)) > eps &&
    len(xmult(p - s.c, p - s.a)) > eps;
}
int dot_inplane_ex(const point3 &p, const point3 &s1, const point3 &s2, const point3 &s3){
  return dot_inplane_in(p, s1, s2, s3) && len(xmult(p - s1, p - s2)) > eps &&
    len(xmult(p - s2, p - s3)) > eps &&
    len(xmult(p - s3, p - s1)) > eps;
}

// 判两点在线段同侧, 点在线段上返回0, 不共面无意义
int same_side(const point3 &p1, const point3 &p2, const line3 &l){
  return dmult(xmult(l.a - l.b, p1 - l.b), xmult(l.a - l.b, p2 - l.b)) > eps;
}
int same_side(const point3 &p1, const point3 &p2,const point3 &l1, const point3 &l2){
  return dmult(xmult(l1 - l2, p1 - l2),xmult(l1 - l2, p2 - l2)) > eps;
}

// 判两点在线段异侧, 点在线段上返回0, 不共面无意义
int opposite_side(const point3 &p1, const point3 &p2, const line3 &l){
  return dmult(xmult(l.a - l.b, p1 - l.b), xmult(l.a - l.b, p2 - l.b)) < -eps;
}
int opposite_side(const point3 &p1, const point3 &p2,const point3 &l1, const point3 &l2){
  return dmult(xmult(l1 - l2, p1 - l2),xmult(l1 - l2, p2 - l2)) < -eps;
}

// 判两点在平面同侧, 点在平面上返回0
int same_side(const point3 &p1, const point3 &p2, const plane3 &s){
  return dmult(pvec(s), p1 - s.a) * dmult(pvec(s), p2 - s.a) > eps;
}
int same_side(const point3 &p1, const point3 &p2, const point3 &s1, const point3 &s2, const point3 &s3){
  return dmult(pvec(s1,s2,s3), p1 - s1) * dmult(pvec(s1,s2,s3), p2 - s1) > eps;
}

// 判两点在平面异侧, 点在平面上返回0
int opposite_side(const point3 &p1, const point3 &p2, const plane3 &s){
  return dmult(pvec(s), p1 - s.a) * dmult(pvec(s), p2 - s.a) < -eps;
}
int opposite_side(const point3 &p1, const point3 &p2, const point3 &s1, const point3 &s2, const point3 &s3){
  return dmult(pvec(s1,s2,s3), p1 - s1) * dmult(pvec(s1,s2,s3), p2 - s1) < -eps;
}

// 判两直线平行
int parallel(const line3 &u, const line3 &v){
  return len(xmult(u.a - u.b, v.a - v.b)) < eps;
}
int parallel(const point3 &u1, const point3 &u2, const point3 &v1, const point3 &v2){
  return len(xmult(u1 - u2, v1 - v2)) < eps;
}

// 判两平面平行
int parallel(const plane3 &u, const plane3 &v){
  return len(xmult(pvec(u) , pvec(v))) < eps;
}
int parallel(const point3 &u1, const point3 &u2, const point3 &u3, const point3 &v1,point3 v2,point3 v3){
  return len(xmult(pvec(u1, u2, u3), pvec(v1, v2, v3))) < eps;
}

// 判直线与平面平行
int parallel(const line3 &l, const plane3 &s){
  return zero(dmult(l.a - l.b, pvec(s)));
}
int parallel(const point3 &l1, const point3 &l2, const point3 &s1, const point3 &s2, const point3 &s3){
  return zero(dmult(l1 - l2, pvec(s1, s2, s3)));
}

// 判两直线垂直
int perpendicular(const line3 &u, const line3 &v){
  return zero(dmult(u.a - u.b, v.a - v.b));
}
int perpendicular(const point3 &u1, const point3 &u2, const point3 &v1, const point3 &v2){
  return zero(dmult(u1 - u2, v1 - v2));
}

// 判两平面垂直
int perpendicular(const plane3 &u, const plane3 &v){
  return zero(dmult(pvec(u), pvec(v)));
}
int perpendicular(const point3 &u1, const point3 &u2, const point3 &u3, const point3 &v1, const point3 &v2, const point3 &v3){
  return zero(dmult(pvec(u1, u2, u3), pvec(v1, v2, v3)));
}

// 判直线与平面平行
int perpendicular(const line3 &l, const plane3 &s){
  return len(xmult(l.a - l.b, pvec(s))) < eps;
}
int perpendicular(const point3 &l1, const point3 &l2, const point3 &s1, const point3 &s2, const point3 &s3){
  return len(xmult(l1 - l2, pvec(s1, s2, s3))) < eps;
}

// 判两线段相交, 包括端点和部分重合
int intersect_in(const line3 &u, const line3 &v){
  if (!dots_onplane(u.a, u.b, v.a, v.b))
    return 0;
  if (!dots_inline(u.a,u.b,v.a)||!dots_inline(u.a,u.b,v.b))
    return !same_side(u.a,u.b,v)&&!same_side(v.a,v.b,u);
  return dot_online_in(u.a,v)||dot_online_in(u.b,v)||dot_online_in(v.a,u)||dot_online_in(v.b,u);
}
int intersect_in(const point3 &u1, const point3 &u2, const point3 &v1, const point3 &v2){
  if (!dots_onplane(u1, u2, v1, v2))
    return 0;
  if (!dots_inline(u1,u2,v1)||!dots_inline(u1,u2,v2))
    return !same_side(u1,u2,v1,v2)&&!same_side(v1,v2,u1,u2);
  return dot_online_in(u1,v1,v2)||dot_online_in(u2,v1,v2)||dot_online_in(v1,u1,u2)||dot_online_in(v2,u1,u2);
}

// 判两线段相交, 不包括端点和部分重合
int intersect_ex(const line3 &u, const line3 &v){
  return dots_onplane(u.a,u.b,v.a,v.b)&&opposite_side(u.a,u.b,v)&&opposite_side(v.a,v.b,u);
}
int intersect_ex(const point3 &u1, const point3 &u2, const point3 &v1, const point3 &v2){
  return dots_onplane(u1,u2,v1,v2)&&opposite_side(u1,u2,v1,v2)&&opposite_side(v1,v2,u1,u2);
}

// 判线段与空间三角形相交, 包括交于边界和( 部分) 包含
int intersect_in(const line3 &l, const plane3 &s){
  return !same_side(l.a,l.b,s)&&!same_side(s.a,s.b,l.a,l.b,s.c)&&
    !same_side(s.b,s.c,l.a,l.b,s.a)&&!same_side(s.c,s.a,l.a,l.b,s.b);
}
int intersect_in(const point3 &l1, const point3 &l2, const point3 &s1, const point3 &s2, const point3 &s3){
  return !same_side(l1,l2,s1,s2,s3)&&!same_side(s1,s2,l1,l2,s3)&&
    !same_side(s2,s3,l1,l2,s1)&&!same_side(s3,s1,l1,l2,s2);
}

// 判线段与空间三角形相交, 不包括交于边界和( 部分) 包含
int intersect_ex(const line3 &l, const plane3 &s){
  return opposite_side(l.a,l.b,s)&&opposite_side(s.a,s.b,l.a,l.b,s.c)&&
    opposite_side(s.b,s.c,l.a,l.b,s.a)&&opposite_side(s.c,s.a,l.a,l.b,s.b);
}
int intersect_ex(const point3 &l1, const point3 &l2, const point3 &s1, const point3 &s2, const point3 &s3){
  return opposite_side(l1,l2,s1,s2,s3)&&opposite_side(s1,s2,l1,l2,s3)&&
    opposite_side(s2,s3,l1,l2,s1)&&opposite_side(s3,s1,l1,l2,s2);
}

// 计算两直线交点, 注意事先判断直线是否共面和平行 !
// 线段交点请另外判线段相交 (同时还是要判断是否平行 !)
point3 intersection(const line3 &u, const line3 &v){
  point3 ret=u.a;
  double t=((u.a.x-v.a.x)*(v.a.y-v.b.y)-(u.a.y-v.a.y)*(v.a.x-v.b.x))
      /((u.a.x-u.b.x)*(v.a.y-v.b.y)-(u.a.y-u.b.y)*(v.a.x-v.b.x));
  ret.x+=(u.b.x-u.a.x)*t;
  ret.y+=(u.b.y-u.a.y)*t;
  ret.z+=(u.b.z-u.a.z)*t;
  return ret;
}
point3 intersection(const point3 &u1, const point3 &u2, const point3 &v1, const point3 &v2){
  point3 ret=u1;
  double t=((u1.x-v1.x)*(v1.y-v2.y)-(u1.y-v1.y)*(v1.x-v2.x))
      /((u1.x-u2.x)*(v1.y-v2.y)-(u1.y-u2.y)*(v1.x-v2.x));
  ret.x+=(u2.x-u1.x)*t;
  ret.y+=(u2.y-u1.y)*t;
  ret.z+=(u2.z-u1.z)*t;
  return ret;
}

// 计算直线与平面交点, 注意事先判断是否平行, 并保证三点不共线!
// 线段和空间三角形交点请另外判断
point3 intersection(const line3 &l, const plane3 &s){
  point3 ret=pvec(s);
  double t=(ret.x*(s.a.x-l.a.x)+ret.y*(s.a.y-l.a.y)+ret.z*(s.a.z-l.a.z))/
    (ret.x*(l.b.x-l.a.x)+ret.y*(l.b.y-l.a.y)+ret.z*(l.b.z-l.a.z));
  ret.x=l.a.x+(l.b.x-l.a.x)*t;
  ret.y=l.a.y+(l.b.y-l.a.y)*t;
  ret.z=l.a.z+(l.b.z-l.a.z)*t;
  return ret;
}
point3 intersection(const point3 &l1, const point3 &l2, const point3 &s1,const point3 &s2, const point3 &s3){
  point3 ret=pvec(s1,s2,s3);
  double t=(ret.x*(s1.x-l1.x)+ret.y*(s1.y-l1.y)+ret.z*(s1.z-l1.z))/
    (ret.x*(l2.x-l1.x)+ret.y*(l2.y-l1.y)+ret.z*(l2.z-l1.z));
  ret.x=l1.x+(l2.x-l1.x)*t;
  ret.y=l1.y+(l2.y-l1.y)*t;
  ret.z=l1.z+(l2.z-l1.z)*t;
  return ret;
}

// 计算两平面交线, 注意事先判断是否平行, 并保证三点不共线 !
line3 intersection(const plane3 &u, const plane3 &v){
  line3 ret;
  ret.a=parallel(v.a,v.b,u.a,u.b,u.c)?intersection(v.b,v.c,u.a,u.b,u.c):intersection(v.a,v.b,u.a,u.b,u.c);
  ret.b=parallel(v.c,v.a,u.a,u.b,u.c)?intersection(v.b,v.c,u.a,u.b,u.c):intersection(v.c,v.a,u.a,u.b,u.c);
  return ret;
}
line3 intersection(const point3 &u1, const point3 &u2, const point3 &u3, const point3 &v1, const point3 &v2, const point3 &v3){
  line3 ret;
  ret.a=parallel(v1,v2,u1,u2,u3)?intersection(v2,v3,u1,u2,u3):intersection(v1,v2,u1,u2,u3);
  ret.b=parallel(v3,v1,u1,u2,u3)?intersection(v2,v3,u1,u2,u3):intersection(v3,v1,u1,u2,u3);
  return ret;
}

// 点到直线距离
double ptoline(const point3 &p, const line3 &l){
  return len(xmult(p - l.a, l.b - l.a))/dis(l.a,l.b);
}
double ptoline(const point3 &p, const point3 &l1, const point3 &l2){
  return len(xmult(p - l1, l2 - l1))/dis(l1,l2);
}

// 点到平面距离
double ptoplane(const point3 &p, const plane3 &s){
  return fabs(dmult(pvec(s), p - s.a))/len(pvec(s));
}
double ptoplane(const point3 &p, const point3 &s1, const point3 &s2, const point3 &s3){
  return fabs(dmult(pvec(s1,s2,s3), p - s1))/len(pvec(s1,s2,s3));
}

// 直线到直线距离
double linetoline(const line3 &u, const line3 &v){
  point3 n=xmult(u.a - u.b, v.a - v.b);
  return fabs(dmult(u.a - v.a,n))/len(n);
}
double linetoline(const point3 &u1, const point3 &u2, const point3 &v1, const point3 &v2){
  point3 n=xmult(u1 - u2, v1 - v2);
  return fabs(dmult(u1 - v1,n))/len(n);
}

// 两直线夹角cos 值
double angle_cos(const line3 &u, const line3 &v){
  return dmult(u.a - u.b, v.a - v.b)/len(u.a - u.b)/len(v.a - v.b);
}
double angle_cos(const point3 &u1, const point3 &u2, const point3 &v1, const point3 &v2){
  return dmult(u1 - u2, v1 - v2)/len(u1 - u2)/len(v1 - v2);
}

// 两平面夹角cos 值
double angle_cos(const plane3 &u, const plane3 &v){
  return dmult(pvec(u),pvec(v))/len(pvec(u))/len(pvec(v));
}
double angle_cos(const point3 &u1, const point3 &u2, const point3 &u3, const point3 &v1, const point3 &v2, const point3 &v3){
  return dmult(pvec(u1,u2,u3),pvec(v1,v2,v3))/len(pvec(u1,u2,u3))/len(pvec(v1,v2,v3));
}

// 直线平面夹角sin 值
double angle_sin(const line3 &l, const plane3 &s){
  return dmult(l.a - l.b,pvec(s))/len(l.a - l.b)/len(pvec(s));
}
double angle_sin(const point3 &l1,const point3 &l2, const point3 &s1, const point3 &s2, const point3 &s3){
  return dmult(l1 - l2,pvec(s1,s2,s3))/len(l1 - l2)/len(pvec(s1,s2,s3));
}
\end{lstlisting}
\subsection{面积}
\createlinenumber{1851}{427e}
\createlinenumber{1852}{0f35}
\createlinenumber{1853}{c025}
\createlinenumber{1854}{95cf}
\createlinenumber{1855}{78b2}
\createlinenumber{1856}{aa2a}
\createlinenumber{1857}{95cf}
\createlinenumber{1858}{6e8b}
\createlinenumber{1859}{c28a}
\createlinenumber{1860}{95cf}
\createlinenumber{1861}{427e}
\createlinenumber{1862}{2eca}
\createlinenumber{1863}{99ec}
\createlinenumber{1864}{85c3}
\createlinenumber{1865}{d161}
\createlinenumber{1866}{fe09}
\createlinenumber{1867}{95cf}
\begin{lstlisting}[language={}]
// 求三角形有向表面积， 输入三个顶点
double area_triangle(const plane3 &p){
  return len(xmult(p.b - p.a, p.c - p.a))/2;
} 
double area_triangle(const point3 &p1, const point3 &p2, const point3 &p3){
  return len(xmult(p2 - p1, p3 - p1))/2;
} 
double area_triangle(const point3 &p2, const point3 &p3){
  return len(xmult(p2, p3))/2;
} 
// 求多边形有向表面积， 输入三个顶点
double area_polygon(int n,point3* p){
  double s;
  for (int i = 0;i < n; ++i)
    s += len(xmult(p[i], p[(i + 1) % n])) / 2;
  return s;
}
\end{lstlisting}
\subsection{体积}
\createlinenumber{1868}{427e}
\createlinenumber{1869}{ef35}
\createlinenumber{1870}{c2f2}
\createlinenumber{1871}{95cf}
\createlinenumber{1872}{b1cf}
\createlinenumber{1873}{74cc}
\createlinenumber{1874}{95cf}
\createlinenumber{1875}{2cde}
\createlinenumber{1876}{9493}
\createlinenumber{1877}{95cf}
\createlinenumber{1878}{427e}
\createlinenumber{1879}{0532}
\createlinenumber{1880}{0ea9}
\createlinenumber{1881}{85c3}
\createlinenumber{1882}{8088}
\createlinenumber{1883}{14df}
\createlinenumber{1884}{95cf}
\begin{lstlisting}[language={}]
// 求四面体有向体积， 输入四个点
double volume_tetrahedron(const point3 &p1, const point3 &p2, const point3 &p3, const point3 &p4){
  return dmult(xmult(p1 - p4, p2 - p4), p3 - p4) / 6;
}
double volume_tetrahedron(const point3 &p1, const point3 &p2, const point3 &p3){
  return dmult(xmult(p1, p2), p3) / 6;
}
double volume_tetrahedron(const plane3 &p){
  return dmult(xmult(p.a, p.b), p.c) / 6;
}
// 求多面体有向体积 
double volume_polygon(int n, plane3 *polygon){
  double c = 0;
  for (int i = 0; i < n; ++i)
    c += volume_tetrahedron(polygon[i]);
  return c;
}
\end{lstlisting}
\subsection{重心}
\createlinenumber{1885}{427e}
\createlinenumber{1886}{4ce9}
\createlinenumber{1887}{85a3}
\createlinenumber{1888}{95cf}
\createlinenumber{1889}{427e}
\createlinenumber{1890}{6485}
\createlinenumber{1891}{3cb1}
\createlinenumber{1892}{95cf}
\createlinenumber{1893}{427e}
\createlinenumber{1894}{0a46}
\createlinenumber{1895}{a1fc}
\createlinenumber{1896}{b0c2}
\createlinenumber{1897}{6c2f}
\createlinenumber{1898}{e51b}
\createlinenumber{1899}{58e1}
\createlinenumber{1900}{32b4}
\createlinenumber{1901}{95cf}
\createlinenumber{1902}{432b}
\createlinenumber{1903}{95cf}
\begin{lstlisting}[language={}]
// 三角形重心
point3 barycenter(const point3 &a, const point3 &b, const point3 &c){
  return a + b + c / 3;
}
// 四面体重心 
point3 barycenter(const point3 &a, const point3 &b, const point3 &c, const point3 &d){
  return (a + b) + (c + d) / 4;
}
// 多面体重心
point3 barycenter(int n, plane3 *polygon){
  point3 c;
  double v = 0;
  for (int i = 0; i < n; ++i){
    double j = volume_tetrahedron(polygon[i]);
    v += j;
    c = c + (polygon[i].a + polygon[i].b + polygon[i].c) * j;
    }
  return c / (4 * v);
}
\end{lstlisting}
\subsection{凸包}
\createlinenumber{1904}{427e}
\createlinenumber{1905}{ce3a}
\createlinenumber{1906}{9400}
\createlinenumber{1907}{f8d9}
\createlinenumber{1908}{f5a3}
\createlinenumber{1909}{7f4c}
\createlinenumber{1910}{4cef}
\createlinenumber{1911}{91d4}
\createlinenumber{1912}{8164}
\createlinenumber{1913}{0019}
\createlinenumber{1914}{d010}
\createlinenumber{1915}{901a}
\createlinenumber{1916}{95cf}
\createlinenumber{1917}{f01b}
\createlinenumber{1918}{582f}
\createlinenumber{1919}{661d}
\createlinenumber{1920}{50e3}
\createlinenumber{1921}{c4b1}
\createlinenumber{1922}{202c}
\createlinenumber{1923}{7fb3}
\createlinenumber{1924}{100b}
\createlinenumber{1925}{1e79}
\createlinenumber{1926}{ac2d}
\createlinenumber{1927}{95cf}
\createlinenumber{1928}{c1c6}
\createlinenumber{1929}{05a3}
\createlinenumber{1930}{40d9}
\createlinenumber{1931}{3c28}
\createlinenumber{1932}{95cf}
\createlinenumber{1933}{427e}
\createlinenumber{1934}{427e}
\createlinenumber{1935}{427e}
\createlinenumber{1936}{4db6}
\createlinenumber{1937}{d712}
\createlinenumber{1938}{06de}
\createlinenumber{1939}{b7ad}
\createlinenumber{1940}{37f3}
\createlinenumber{1941}{79d4}
\createlinenumber{1942}{3d14}
\createlinenumber{1943}{6173}
\createlinenumber{1944}{95cf}
\createlinenumber{1945}{ea37}
\createlinenumber{1946}{97fe}
\createlinenumber{1947}{0393}
\createlinenumber{1948}{cee5}
\createlinenumber{1949}{7384}
\createlinenumber{1950}{e569}
\createlinenumber{1951}{da36}
\createlinenumber{1952}{21b5}
\createlinenumber{1953}{e569}
\createlinenumber{1954}{9413}
\createlinenumber{1955}{9004}
\createlinenumber{1956}{bda5}
\createlinenumber{1957}{1807}
\createlinenumber{1958}{68c3}
\createlinenumber{1959}{95cf}
\createlinenumber{1960}{95cf}
\createlinenumber{1961}{576f}
\createlinenumber{1962}{d4d9}
\createlinenumber{1963}{82ac}
\createlinenumber{1964}{c1d7}
\createlinenumber{1965}{f7bf}
\createlinenumber{1966}{95cf}
\createlinenumber{1967}{ffec}
\createlinenumber{1968}{95cf}
\begin{lstlisting}[language={}]
//a-b-c右手定则指向凸包外面 
const int MAXN = 500;
const int MAXM = 250000;
struct NODE{
  int p[4], next, out;
  point3 f;
}s[MAXM];
int edge[MAXN][MAXN];
int tot;
int next(int x){
  if (s[x].next == x) return x;
  return s[x].next = next(s[x].next);
}
void add(int a, int b, int c, point3 *p){
  s[tot].p[0] = a;
  s[tot].p[1] = b;
  s[tot].p[2] = c;
  s[tot].p[3] = a;
  s[tot].f = xmult(p[b] - p[a], p[c] - p[a]);
  s[tot].out = false;
  for (int i = 0; i < 3; ++i)
    edge[s[tot].p[i]][s[tot].p[i + 1]] = tot;
  ++tot;
}
void add(int a, int b, int c, int d, point3 *p){
  point3 f = xmult(p[b] - p[a], p[c] - p[a]);
  if (dmult(f, p[d] - p[a]) > 0) add(a, c, b, p);
  else add(a, b, c, p);
}

// 主程序输入顶点个数， 点集， 返回面，
// 要求不是所有点共面
int get_convex(int n, point3* p, plane3* convex){
  for (int i = 0; i < MAXM; ++i)
    s[i].next = i;
  tot = 0;
  for (int i = 3; i < n; ++i)
    if (!dots_onplane(p[0], p[1], p[2], p[i])){
      swap(p[i], p[3]);
      break;
    }
  add(0, 1, 2, 3, p);
  add(2, 3, 0, 1, p);
  add(3, 1, 0, 2, p);
  add(3, 1, 2, 0, p);
  for (int i = 4; i < n; ++i){
    for (int j = next(0); j < tot; j = next(j + 1))
      s[j].out = dmult(s[j].f, p[i] - p[s[j].p[0]]) > 0;
    int c = tot;
    for (int j = next(0); j < tot; j = next(j + 1))
      if (s[j].out){
        for (int k = 0; k < 3; ++k)
          if (!s[edge[s[j].p[k + 1]][s[j].p[k]]].out)
            add(s[j].p[k], s[j].p[k + 1], i, p); 
        s[j].next = j + 1;
      }
  }
  int i, j; 
  for (i = 0, j = next(0); j < tot; ++i, j = next(j + 1)){
    convex[i].a = p[s[j].p[0]];
    convex[i].b = p[s[j].p[1]];
    convex[i].c = p[s[j].p[2]];
  }
  return i;
}
\end{lstlisting}

\section{数论}
\subsection{头文件}
\createlinenumber{1969}{427e}
\createlinenumber{1970}{e0a5}
\createlinenumber{1971}{54ff}
\createlinenumber{1972}{c928}
\createlinenumber{1973}{59b9}
\createlinenumber{1974}{59b9}
\createlinenumber{1975}{8c52}
\createlinenumber{1976}{6326}
\createlinenumber{1977}{09f7}
\createlinenumber{1978}{ef2f}
\createlinenumber{1979}{2349}
\createlinenumber{1980}{421c}
\createlinenumber{1981}{5cad}
\createlinenumber{1982}{1f2c}
\createlinenumber{1983}{b773}
\createlinenumber{1984}{4d7e}
\begin{lstlisting}[language={}]
// independent
#include<iostream>
#include<algorithm>
#include<cmath>
#include<cstdio>
#include<cstdio>
#include<map>
#include<set>
#include<vector>
#include<cstring>
#include<string>
using namespace std;
typedef long long LL;
typedef unsigned int UI;
typedef unsigned long long ULL;
const LL mod=1000000007;
\end{lstlisting}
\subsection{基础}
\createlinenumber{1985}{427e}
\createlinenumber{1986}{427e}
\createlinenumber{1987}{3f6b}
\createlinenumber{1988}{4506}
\createlinenumber{1989}{af5c}
\createlinenumber{1990}{b56a}
\createlinenumber{1991}{4c1b}
\createlinenumber{1992}{06fb}
\createlinenumber{1993}{3ea9}
\createlinenumber{1994}{2f01}
\createlinenumber{1995}{95cf}
\createlinenumber{1996}{4206}
\createlinenumber{1997}{95cf}
\createlinenumber{1998}{427e}
\createlinenumber{1999}{c2e9}
\createlinenumber{2000}{4506}
\createlinenumber{2001}{55d6}
\createlinenumber{2002}{c56f}
\createlinenumber{2003}{4506}
\createlinenumber{2004}{28f6}
\createlinenumber{2005}{95cf}
\createlinenumber{2006}{5ffd}
\createlinenumber{2007}{95cf}
\createlinenumber{2008}{80eb}
\createlinenumber{2009}{2dcf}
\createlinenumber{2010}{bda5}
\createlinenumber{2011}{95cf}
\createlinenumber{2012}{427e}
\createlinenumber{2013}{8534}
\createlinenumber{2014}{4506}
\createlinenumber{2015}{7d1a}
\createlinenumber{2016}{e9fa}
\createlinenumber{2017}{166e}
\createlinenumber{2018}{05da}
\createlinenumber{2019}{95cf}
\begin{lstlisting}[language={}]
// independent 
// fast multiplication
LL FM(LL a,LL t,LL mod)
{
  a%=mod;
  LL ans=1, mid=a;
  while(t){
    if(t&1) ans*=mid,ans%=mod;
    mid*=mid;mid%=mod;
    t>>=1;  
  } 
  return ans;
}
// gcd
LL gcd(LL a,LL b)
{
  if (a<b){LL c=a;a=b;b=c;}
  while (b!=0)
  {
    LL c=a;a=b;b=c%b;
  }
  return a;
}
LL lcm(LL a,LL b){
  LL g=gcd(a,b);
  return a/g*b; 
}
// return gcd(a,b),a*x+b*y=g;
LL ext_gcd(LL a,LL b,LL &x,LL &y)
{
  if(b == 0){x = 1;y = 0;return a;}
  LL g = ext_gcd(b, a % b, x, y);
  LL t = x;x = y,y=t-a/b*y;
  return g;
}
\end{lstlisting}
\subsection{线性筛法}
\createlinenumber{2020}{427e}
\createlinenumber{2021}{62a8}
\createlinenumber{2022}{1858}
\createlinenumber{2023}{8a94}
\createlinenumber{2024}{0919}
\createlinenumber{2025}{ff7c}
\createlinenumber{2026}{3099}
\createlinenumber{2027}{f677}
\createlinenumber{2028}{97c2}
\createlinenumber{2029}{c98f}
\createlinenumber{2030}{ece6}
\createlinenumber{2031}{0f27}
\createlinenumber{2032}{95cf}
\createlinenumber{2033}{95cf}
\createlinenumber{2034}{95cf}
\begin{lstlisting}[language={}]
// independent 
const int MAXN=10000000;
int cprime[MAXN],used=0;
char p[MAXN]; 
void prime_(){
   memset(p,0,sizeof p);
   for(int i=2;i<MAXN;i++){
     if(!p[i])  cprime[used]=i,used++;
     for(int j=0;j<used;j++){
       if(i*cprime[j]>MAXN) break;
       p[i*cprime[j]]=true;
       if(i%cprime[j]==0)break;   
     }    
   }
}
\end{lstlisting}
\subsection{线性同余方程}
\createlinenumber{2035}{427e}
\createlinenumber{2036}{427e}
\createlinenumber{2037}{427e}
\createlinenumber{2038}{c8bd}
\createlinenumber{2039}{4506}
\createlinenumber{2040}{2f15}
\createlinenumber{2041}{6b0f}
\createlinenumber{2042}{1bd9}
\createlinenumber{2043}{2800}
\createlinenumber{2044}{62c8}
\createlinenumber{2045}{89a5}
\createlinenumber{2046}{3361}
\createlinenumber{2047}{95cf}
\begin{lstlisting}[language={}]
// depend on 基础：ext_gcd 

// 求一元线性同余方程： a*x = b mod m   的所有解（在同余系中） ,存于ans数组 ,解的个数存在len中 
bool cong_eq(LL a,LL b,LL m,LL ans[],LL &len)
{
   LL g,x,y;
   g=ext_gcd(a,m,x,y);
   if(b%g) return false;
   LL base=((b/g*x)%m+m)%m;
   len=g;
   for(int i=0;i<len;i++) ans[i]=(base+i*(m/len))%m;
   return true;
}
\end{lstlisting}
\subsection{中国剩余定理}
\createlinenumber{2048}{427e}
\createlinenumber{2049}{427e}
\createlinenumber{2050}{427e}
\createlinenumber{2051}{7300}
\createlinenumber{2052}{afa3}
\createlinenumber{2053}{8fa0}
\createlinenumber{2054}{38d2}
\createlinenumber{2055}{b024}
\createlinenumber{2056}{95cf}
\createlinenumber{2057}{38d2}
\createlinenumber{2058}{13d5}
\createlinenumber{2059}{e90f}
\createlinenumber{2060}{e55d}
\createlinenumber{2061}{95cf}
\createlinenumber{2062}{361d}
\createlinenumber{2063}{4206}
\createlinenumber{2064}{95cf}
\begin{lstlisting}[language={}]
// depend on 基础：ext_gcd 

// 中国剩余定理解特殊线性方程组，  x= a[i] mod b[i],其中 b[i]两两互质，共r个方程 
LL china(LL a[], LL b[], int r){
  LL M=1;
  LL i,Mi,x0,y0,d,ans=0;
  for(i=0;i<r;i++){
    M*=b[i];  
  } 
  for(i=0;i<r;i++){
    Mi=M/b[i];
    ext_gcd(Mi,b[i],x0,y0);
    ans=(ans+Mi*x0*a[i])%M; 
  }
  if(ans<0) ans+=M;
  return ans;
}
\end{lstlisting}
\subsection{离散对数}
\createlinenumber{2065}{427e}
\createlinenumber{2066}{427e}
\createlinenumber{2067}{427e}
\createlinenumber{2068}{ee1f}
\createlinenumber{2069}{4609}
\createlinenumber{2070}{db04}
\createlinenumber{2071}{cbde}
\createlinenumber{2072}{ab55}
\createlinenumber{2073}{3ce9}
\createlinenumber{2074}{4921}
\createlinenumber{2075}{2e3c}
\createlinenumber{2076}{fcdc}
\createlinenumber{2077}{29f2}
\createlinenumber{2078}{81a6}
\createlinenumber{2079}{c3b7}
\createlinenumber{2080}{e19e}
\createlinenumber{2081}{4f2d}
\createlinenumber{2082}{95cf}
\createlinenumber{2083}{fd3e}
\createlinenumber{2084}{e55c}
\createlinenumber{2085}{5551}
\createlinenumber{2086}{95cf}
\createlinenumber{2087}{f7e2}
\createlinenumber{2088}{8c95}
\createlinenumber{2089}{d291}
\createlinenumber{2090}{ad12}
\createlinenumber{2091}{95cf}
\createlinenumber{2092}{99f4}
\createlinenumber{2093}{2e3c}
\createlinenumber{2094}{a4dc}
\createlinenumber{2095}{9030}
\createlinenumber{2096}{b35f}
\createlinenumber{2097}{5551}
\createlinenumber{2098}{95cf}
\createlinenumber{2099}{fb5e}
\createlinenumber{2100}{95cf}
\createlinenumber{2101}{427e}
\createlinenumber{2102}{e8bb}
\createlinenumber{2103}{5e78}
\createlinenumber{2104}{0c60}
\createlinenumber{2105}{a0bb}
\createlinenumber{2106}{4d23}
\createlinenumber{2107}{0eb3}
\createlinenumber{2108}{ee0f}
\createlinenumber{2109}{95cf}
\createlinenumber{2110}{427e}
\createlinenumber{2111}{49b5}
\createlinenumber{2112}{4506}
\createlinenumber{2113}{8fef}
\createlinenumber{2114}{7c06}
\createlinenumber{2115}{4506}
\createlinenumber{2116}{6f75}
\createlinenumber{2117}{6bc0}
\createlinenumber{2118}{3386}
\createlinenumber{2119}{ca1f}
\createlinenumber{2120}{f959}
\createlinenumber{2121}{95cf}
\createlinenumber{2122}{3be4}
\createlinenumber{2123}{9853}
\createlinenumber{2124}{38ce}
\createlinenumber{2125}{4c93}
\createlinenumber{2126}{4e9d}
\createlinenumber{2127}{95cf}
\createlinenumber{2128}{c5f3}
\createlinenumber{2129}{856b}
\createlinenumber{2130}{c05a}
\createlinenumber{2131}{36c9}
\createlinenumber{2132}{9f59}
\createlinenumber{2133}{87dc}
\createlinenumber{2134}{9506}
\createlinenumber{2135}{fb15}
\createlinenumber{2136}{6f10}
\createlinenumber{2137}{e3f3}
\createlinenumber{2138}{b8d3}
\createlinenumber{2139}{95cf}
\createlinenumber{2140}{fea4}
\createlinenumber{2141}{2662}
\createlinenumber{2142}{21a3}
\createlinenumber{2143}{5d4e}
\createlinenumber{2144}{b3d8}
\createlinenumber{2145}{95cf}
\createlinenumber{2146}{fb5e}
\createlinenumber{2147}{95cf}
\createlinenumber{2148}{427e}
\createlinenumber{2149}{427e}
\createlinenumber{2150}{427e}
\createlinenumber{2151}{3117}
\createlinenumber{2152}{1e17}
\createlinenumber{2153}{2072}
\createlinenumber{2154}{1fc4}
\createlinenumber{2155}{1719}
\createlinenumber{2156}{6a67}
\createlinenumber{2157}{95cf}
\createlinenumber{2158}{7021}
\createlinenumber{2159}{95cf}
\begin{lstlisting}[language={}]
// independent
// 求解形如  a^x= bmod MOD 的方程，a，b，MOD已知 

const int maxn = 65535;
struct hash{
  int a,b,next;
}Hash[maxn << 1];
int flg[maxn];
int top,idx;
void ins(int a,int b){
  int k = b & maxn;
  if(flg[k] != idx){
    flg[k] = idx;
    Hash[k].next = -1;
    Hash[k].a = a;
    Hash[k].b = b;
    return ;
  }
  while(Hash[k].next != -1){
    if(Hash[k].b == b) return ;
    k = Hash[k].next;
  }
  Hash[k].next = ++ top;
  Hash[top].next = -1;
  Hash[top].a = a;
  Hash[top].b = b;
}
int find(int b){
  int k = b & maxn;
  if(flg[k] != idx) return -1;
  while(k != -1){
    if(Hash[k].b == b) return Hash[k].a;
    k = Hash[k].next;
  }
  return -1;
}

int gcd(int a,int b){return b?gcd(b,a%b):a;}
int ext_gcd(int a,int b,int& x,int& y){
  int t,ret;
  if (!b){x=1,y=0;return a;}
  ret=ext_gcd(b,a%b,x,y);
  t=x,x=y,y=t-a/b*y;
  return ret;
}

int pow_mod(LL a,int b,int c)
{
  LL ret=1%c;a%=c;
  while(b)
  {
    if(b&1)
    ret=ret*a%c;
    a=a*a%c;
    b>>=1;
  }return ret;
}
int Inval(int a,int b,int n){
  int x,y,e;
  ext_gcd(a,n,x,y);
  e=(LL)x*b%n;
  return e<0?e+n:e;
}
int BabyStep(int A,int B,int C){
  top = maxn; ++ idx; 
  LL buf=1%C,D=buf,K;
  int i,d=0,tmp;
  for(i=0;i<=100;buf=buf*A%C,++i)if(buf==B)return i;
  while((tmp=gcd(A,C))!=1){
    if(B%tmp)return -1;
    ++d;
    C/=tmp;
    B/=tmp;
    D=D*A/tmp%C;
  }
  int M=(int)ceil(sqrt((double)C));
  for(buf=1%C,i=0;i<=M;buf=buf*A%C,++i)ins(i,buf);
  for(i=0,K=pow_mod((LL)A,M,C);i<=M;D=D*K%C,++i){
    tmp=Inval((int)D,B,C);int w ;
    if(tmp>0&&(w = find(tmp)) != -1)return i*M+w+d;
  }
  return -1;
}



int main(){
  int A,B,C;
  while(scanf("%d%d%d",&A,&C,&B)!=EOF,A || B || C){
    B %= C;
    int tmp=BabyStep(A,B,C);
    if(tmp<0)puts("No Solution");else printf("%d\n",tmp);
  }
  return 0;
}
\end{lstlisting}
\subsection{MillerRabin}
\createlinenumber{2160}{427e}
\createlinenumber{2161}{44b6}
\createlinenumber{2162}{c625}
\createlinenumber{2163}{2f70}
\createlinenumber{2164}{01e0}
\createlinenumber{2165}{427e}
\createlinenumber{2166}{de44}
\createlinenumber{2167}{3c2f}
\createlinenumber{2168}{6da3}
\createlinenumber{2169}{7216}
\createlinenumber{2170}{89ce}
\createlinenumber{2171}{a72c}
\createlinenumber{2172}{fe75}
\createlinenumber{2173}{95cf}
\createlinenumber{2174}{95cf}
\createlinenumber{2175}{3361}
\createlinenumber{2176}{95cf}
\createlinenumber{2177}{427e}
\createlinenumber{2178}{2daf}
\createlinenumber{2179}{89e8}
\createlinenumber{2180}{62ac}
\createlinenumber{2181}{d8c4}
\createlinenumber{2182}{148a}
\createlinenumber{2183}{2e40}
\createlinenumber{2184}{6474}
\createlinenumber{2185}{95cf}
\createlinenumber{2186}{3361}
\createlinenumber{2187}{95cf}
\begin{lstlisting}[language={}]
// depend on 基础  ：multiMod 
bool witness ( LL s , LL n ) {  
  LL u = n - 1 ;  
  int t = 0 ;  
  while ( ( u & 1 ) == 0 ) u >>= 1 , t ++ ;  
    
  LL x = FM ( s , u , n ) ;  
  while ( t -- ) {  
    LL tmp = x ;  
    x = multiMod ( x , x , n ) ;  
    if ( x == 1 ) {  
      if ( tmp == n - 1 || tmp == 1  ) return false ;//may be prime  
      else return true ;//composite  
    }  
  }  
  return true ; //composite  
}  
  
bool millerRabin ( LL n , const int times = 3 ) {  
  if ( n == 2 ) return true ;  
  if ( ( n & 1 ) == 0 || n < 2 ) return false ;  
  int i = times ;  
  while ( i -- ) {  
    LL s = rand ( ) % ( n - 1 ) + 1 ;  
    if ( witness ( s , n ) ) return false ;  
  }  
  return true ;  
}
\end{lstlisting}
\subsection{PollardRho}
\createlinenumber{2188}{427e}
\createlinenumber{2189}{5bc3}
\createlinenumber{2190}{dcd8}
\createlinenumber{2191}{37f2}
\createlinenumber{2192}{9f3a}
\createlinenumber{2193}{ca22}
\createlinenumber{2194}{90a9}
\createlinenumber{2195}{4134}
\createlinenumber{2196}{f497}
\createlinenumber{2197}{95cf}
\createlinenumber{2198}{80ab}
\createlinenumber{2199}{082b}
\createlinenumber{2200}{95cf}
\createlinenumber{2201}{fe09}
\createlinenumber{2202}{95cf}
\createlinenumber{2203}{427e}
\createlinenumber{2204}{9285}
\createlinenumber{2205}{c7db}
\createlinenumber{2206}{eb30}
\createlinenumber{2207}{7ce6}
\createlinenumber{2208}{5ab5}
\createlinenumber{2209}{5085}
\createlinenumber{2210}{517f}
\createlinenumber{2211}{95cf}
\createlinenumber{2212}{fe6e}
\createlinenumber{2213}{95cf}
\createlinenumber{2214}{427e}
\createlinenumber{2215}{44b6}
\createlinenumber{2216}{c625}
\createlinenumber{2217}{2f70}
\createlinenumber{2218}{01e0}
\createlinenumber{2219}{427e}
\createlinenumber{2220}{de44}
\createlinenumber{2221}{3c2f}
\createlinenumber{2222}{6da3}
\createlinenumber{2223}{7216}
\createlinenumber{2224}{89ce}
\createlinenumber{2225}{a72c}
\createlinenumber{2226}{fe75}
\createlinenumber{2227}{95cf}
\createlinenumber{2228}{95cf}
\createlinenumber{2229}{3361}
\createlinenumber{2230}{95cf}
\createlinenumber{2231}{427e}
\createlinenumber{2232}{2daf}
\createlinenumber{2233}{89e8}
\createlinenumber{2234}{62ac}
\createlinenumber{2235}{d8c4}
\createlinenumber{2236}{148a}
\createlinenumber{2237}{2e40}
\createlinenumber{2238}{6474}
\createlinenumber{2239}{95cf}
\createlinenumber{2240}{3361}
\createlinenumber{2241}{95cf}
\createlinenumber{2242}{4990}
\createlinenumber{2243}{22aa}
\createlinenumber{2244}{7b09}
\createlinenumber{2245}{95cf}
\createlinenumber{2246}{32db}
\createlinenumber{2247}{61ac}
\createlinenumber{2248}{2cce}
\createlinenumber{2249}{7924}
\createlinenumber{2250}{0d80}
\createlinenumber{2251}{25c7}
\createlinenumber{2252}{427e}
\createlinenumber{2253}{1026}
\createlinenumber{2254}{a42b}
\createlinenumber{2255}{a98e}
\createlinenumber{2256}{abe5}
\createlinenumber{2257}{397a}
\createlinenumber{2258}{f73d}
\createlinenumber{2259}{6dad}
\createlinenumber{2260}{037f}
\createlinenumber{2261}{679a}
\createlinenumber{2262}{88e9}
\createlinenumber{2263}{453c}
\createlinenumber{2264}{95cf}
\createlinenumber{2265}{95cf}
\createlinenumber{2266}{95cf}
\createlinenumber{2267}{95cf}
\createlinenumber{2268}{427e}
\createlinenumber{2269}{a6bf}
\createlinenumber{2270}{427e}
\createlinenumber{2271}{9f58}
\createlinenumber{2272}{427e}
\createlinenumber{2273}{10b4}
\createlinenumber{2274}{0494}
\createlinenumber{2275}{037f}
\createlinenumber{2276}{3942}
\createlinenumber{2277}{a69f}
\createlinenumber{2278}{9a67}
\createlinenumber{2279}{1ce0}
\createlinenumber{2280}{83ef}
\createlinenumber{2281}{0573}
\createlinenumber{2282}{95cf}
\createlinenumber{2283}{95cf}
\begin{lstlisting}[language={}]
// depend on 基础：multiMod，FM 
LL multiMod ( LL a , LL b , LL n ) {
  a %= n ;  
  b %= n ;  
  LL s = 0 ;  
  while( b ) {  
    if( b & 1 ) {  
      s += a ;  
      if( s >= n ) s -= n ;  
    }  
    a <<= 1 ; b >>= 1 ;
    if(a >= n ) a -= n ;  
  }  
  return  s ;  
}  
  
LL FM ( LL s , LL u , LL n ) {  
  s %= n ;  
  LL tmp = 1 ;  
  while ( u ) {  
    if ( u & 1 ) tmp = multiMod ( tmp , s , n ) ;  
    s = multiMod ( s , s , n ) ;  
    u >>= 1 ;  
  }  
  return tmp ;  
}  
  
bool witness ( LL s , LL n ) {  
  LL u = n - 1 ;  
  int t = 0 ;  
  while ( ( u & 1 ) == 0 ) u >>= 1 , t ++ ;  
    
  LL x = FM ( s , u , n ) ;  
  while ( t -- ) {  
    LL tmp = x ;  
    x = multiMod ( x , x , n ) ;  
    if ( x == 1 ) {  
      if ( tmp == n - 1 || tmp == 1  ) return false ;//may be prime  
      else return true ;//composite  
    }  
  }  
  return true ; //composite  
}  
  
bool millerRabin ( LL n , const int times = 3 ) {  
  if ( n == 2 ) return true ;  
  if ( ( n & 1 ) == 0 || n < 2 ) return false ;  
  int i = times ;  
  while ( i -- ) {  
    LL s = rand ( ) % ( n - 1 ) + 1 ;  
    if ( witness ( s , n ) ) return false ;  
  }  
  return true ;  
}  
LL gcd ( LL a , LL b ) {  
  if ( b == 0 ) return a ;  
  return gcd ( b , a % b ) ;  
}  
LL pollard_rho ( LL n ) {  
  LL x , y , k , d  ;  
  x = y = rand ( ) % n ;  
  k = 2 ;  
  int i = 1 ;  
  int c =rand ( ) % n ;  

  while ( true ) {  
    i ++ ;  
    x = ( multiMod ( x , x , n ) + c ) % n ;  
    if ( y == x ) return 1 ;//restart  
    else if ( y > x ) d = gcd ( y - x , n ) ;  
    else d = gcd ( x - y , n ) ;  
    if ( d != 1 && d != n - 1 ) return d ;  
    else {  
      if ( i == k ) {  
        y = x ;  
        k <<= 1 ;  
      }  
    }  
  }  
}  
//存放分解出的质因子 
LL factors [ 54 ] ;
//初始化为0 
int cnt ;  
  
void split ( LL n ) {//n != 1  
  if ( millerRabin ( n ) ) factors [ cnt ++ ] = n ;  
  else {  
    LL p ;  
    do {  
      p = pollard_rho ( n ) ;   
    }while ( p == n || p == 1 );  
    split ( p ) ;  
    split ( n / p ) ;  
  }  
}
\end{lstlisting}
\subsection{矩阵基础}
\createlinenumber{2284}{427e}
\createlinenumber{2285}{cffb}
\createlinenumber{2286}{d184}
\createlinenumber{2287}{d0d9}
\createlinenumber{2288}{6b09}
\createlinenumber{2289}{95cf}
\createlinenumber{2290}{b54c}
\createlinenumber{2291}{329b}
\createlinenumber{2292}{427e}
\createlinenumber{2293}{0a3f}
\createlinenumber{2294}{c97f}
\createlinenumber{2295}{3fe0}
\createlinenumber{2296}{7272}
\createlinenumber{2297}{91ca}
\createlinenumber{2298}{6363}
\createlinenumber{2299}{d081}
\createlinenumber{2300}{78c3}
\createlinenumber{2301}{427e}
\createlinenumber{2302}{95cf}
\createlinenumber{2303}{95cf}
\createlinenumber{2304}{95cf}
\createlinenumber{2305}{14df}
\createlinenumber{2306}{95cf}
\createlinenumber{2307}{427e}
\createlinenumber{2308}{427e}
\createlinenumber{2309}{ece1}
\createlinenumber{2310}{c97f}
\createlinenumber{2311}{b567}
\createlinenumber{2312}{91ca}
\createlinenumber{2313}{c58d}
\createlinenumber{2314}{c4cc}
\createlinenumber{2315}{bd48}
\createlinenumber{2316}{95cf}
\createlinenumber{2317}{95cf}
\createlinenumber{2318}{14df}
\createlinenumber{2319}{95cf}
\createlinenumber{2320}{5eb9}
\createlinenumber{2321}{4506}
\createlinenumber{2322}{d2a0}
\createlinenumber{2323}{782d}
\createlinenumber{2324}{6880}
\createlinenumber{2325}{4c1b}
\createlinenumber{2326}{e385}
\createlinenumber{2327}{c1cb}
\createlinenumber{2328}{2f01}
\createlinenumber{2329}{95cf}
\createlinenumber{2330}{4206}
\createlinenumber{2331}{95cf}
\begin{lstlisting}[language={}]
// independent 
struct Matrix{int m[MAXN][MAXN],l,r;
  Matrix(int w){
    l=r=w;  
    memset(m,0,sizeof m);
  }
  Matrix(){l=r=0;memset(m,0,sizeof m);}
};
// a.r = b.l
Matrix operator * (Matrix a,Matrix b){ 
  Matrix c;
  memset(c.m,0,sizeof c.m);
  c.l=a.l,c.r=b.r;
  for(int i=0;i<a.l;i++){
    for(int j=0;j<b.r;j++){
      for(int k=0;k<a.r;k++){
        c.m[i][j]+=a.m[i][k]*b.m[k][j];
//        c.m[i][j]%=mod;//取余 
      }
    } 
  } 
  return c;
} 

// a.l == b.l && a.r == b.r
Matrix operator + (Matrix a,Matrix b){
  Matrix c;
  c.l=a.l;c.r=a.r;
  for(int i=0;i<a.l;i++){
    for(int j=0;j<a.r;j++){
      c.m[i][j]=a.m[i][j]+b.m[i][j];
      c.m[i][j]%=mod;
    } 
  }
  return c;
}
Matrix FM(Matrix a,int t)
{
  Matrix ans;ans.l=ans.r=a.l;
  for(int i=0;i<a.l;i++)ans.m[i][i]=1;
  Matrix mid=a;
  while(t){
    if(t&1) ans=ans*mid;
    mid=mid*mid;
    t>>=1;
  }
  return ans;
}
\end{lstlisting}
\subsection{高斯消元}
\createlinenumber{2332}{427e}
\createlinenumber{2333}{fb02}
\createlinenumber{2334}{c1b0}
\createlinenumber{2335}{b76f}
\createlinenumber{2336}{427e}
\createlinenumber{2337}{427e}
\createlinenumber{2338}{427e}
\createlinenumber{2339}{f2e9}
\createlinenumber{2340}{c75e}
\createlinenumber{2341}{ea2e}
\createlinenumber{2342}{ab8e}
\createlinenumber{2343}{a1ed}
\createlinenumber{2344}{8dd1}
\createlinenumber{2345}{f0ed}
\createlinenumber{2346}{ff5d}
\createlinenumber{2347}{7021}
\createlinenumber{2348}{7dcf}
\createlinenumber{2349}{0dff}
\createlinenumber{2350}{b70f}
\createlinenumber{2351}{243a}
\createlinenumber{2352}{95cf}
\createlinenumber{2353}{1ff9}
\createlinenumber{2354}{8e4d}
\createlinenumber{2355}{34eb}
\createlinenumber{2356}{56e2}
\createlinenumber{2357}{95cf}
\createlinenumber{2358}{4cd8}
\createlinenumber{2359}{34eb}
\createlinenumber{2360}{5fe8}
\createlinenumber{2361}{95cf}
\createlinenumber{2362}{e913}
\createlinenumber{2363}{cd1d}
\createlinenumber{2364}{2139}
\createlinenumber{2365}{7459}
\createlinenumber{2366}{95cf}
\begin{lstlisting}[language={}]
// independent
#define MAXN 100
#define fabs(x) ((x)>0?(x):-(x))
#define eps 1e-10

//列主元gauss消去求解a[][]x[]=b[]
//返回是否有唯一解,若有解在b[]中
int gauss_cpivot(int n,double a[][MAXN],double b[]){
  int i,j,k,row;
  double maxp,t;
  for (k=0;k<n;k++){
    for (maxp=0,i=k;i<n;i++)
      if (fabs(a[i][k])>fabs(maxp))
        maxp=a[row=i][k];
    if (fabs(maxp)<eps)
      return 0;
    if (row!=k){
      for (j=k;j<n;j++)
        t=a[k][j],a[k][j]=a[row][j],a[row][j]=t;
      t=b[k],b[k]=b[row],b[row]=t;
    }
    for (j=k+1;j<n;j++){
      a[k][j]/=maxp;
      for (i=k+1;i<n;i++)
        a[i][j]-=a[i][k]*a[k][j];
    }
    b[k]/=maxp;
    for (i=k+1;i<n;i++)
      b[i]-=b[k]*a[i][k];
  }
  for (i=n-1;i>=0;i--)
    for (j=i+1;j<n;j++)
      b[i]-=a[i][j]*b[j];
  return 1;
}
\end{lstlisting}

\section{数据结构}
\subsection{SplayTree}
\createlinenumber{2367}{59b9}
\createlinenumber{2368}{ef2f}
\createlinenumber{2369}{bffa}
\createlinenumber{2370}{427e}
\createlinenumber{2371}{421c}
\createlinenumber{2372}{427e}
\createlinenumber{2373}{1c79}
\createlinenumber{2374}{06a1}
\createlinenumber{2375}{5da6}
\createlinenumber{2376}{11d0}
\createlinenumber{2377}{427e}
\createlinenumber{2378}{f7cd}
\createlinenumber{2379}{b275}
\createlinenumber{2380}{427e}
\createlinenumber{2381}{440f}
\createlinenumber{2382}{427e}
\createlinenumber{2383}{b01b}
\createlinenumber{2384}{427e}
\createlinenumber{2385}{4a30}
\createlinenumber{2386}{427e}
\createlinenumber{2387}{88f1}
\createlinenumber{2388}{4506}
\createlinenumber{2389}{bd30}
\createlinenumber{2390}{1bb9}
\createlinenumber{2391}{47f6}
\createlinenumber{2392}{ab2e}
\createlinenumber{2393}{f607}
\createlinenumber{2394}{c969}
\createlinenumber{2395}{e3e8}
\createlinenumber{2396}{b6b3}
\createlinenumber{2397}{0e03}
\createlinenumber{2398}{2753}
\createlinenumber{2399}{d657}
\createlinenumber{2400}{95cf}
\createlinenumber{2401}{427e}
\createlinenumber{2402}{b77a}
\createlinenumber{2403}{dbed}
\createlinenumber{2404}{40e5}
\createlinenumber{2405}{2d59}
\createlinenumber{2406}{bc22}
\createlinenumber{2407}{577f}
\createlinenumber{2408}{ca6f}
\createlinenumber{2409}{427e}
\createlinenumber{2410}{fdcf}
\createlinenumber{2411}{427e}
\createlinenumber{2412}{dd0c}
\createlinenumber{2413}{95cf}
\createlinenumber{2414}{427e}
\createlinenumber{2415}{9356}
\createlinenumber{2416}{47f6}
\createlinenumber{2417}{ab2e}
\createlinenumber{2418}{f607}
\createlinenumber{2419}{c969}
\createlinenumber{2420}{e3e8}
\createlinenumber{2421}{b6b3}
\createlinenumber{2422}{0e03}
\createlinenumber{2423}{2753}
\createlinenumber{2424}{d657}
\createlinenumber{2425}{95cf}
\createlinenumber{2426}{427e}
\createlinenumber{2427}{886d}
\createlinenumber{2428}{fa89}
\createlinenumber{2429}{180a}
\createlinenumber{2430}{b048}
\createlinenumber{2431}{935a}
\createlinenumber{2432}{3392}
\createlinenumber{2433}{9a2e}
\createlinenumber{2434}{8176}
\createlinenumber{2435}{0181}
\createlinenumber{2436}{7a57}
\createlinenumber{2437}{77d1}
\createlinenumber{2438}{a71b}
\createlinenumber{2439}{95cf}
\createlinenumber{2440}{427e}
\createlinenumber{2441}{1455}
\createlinenumber{2442}{dbed}
\createlinenumber{2443}{6eb3}
\createlinenumber{2444}{45c9}
\createlinenumber{2445}{d66a}
\createlinenumber{2446}{d26a}
\createlinenumber{2447}{e573}
\createlinenumber{2448}{3058}
\createlinenumber{2449}{37f3}
\createlinenumber{2450}{89b1}
\createlinenumber{2451}{be32}
\createlinenumber{2452}{95cf}
\createlinenumber{2453}{e2e3}
\createlinenumber{2454}{f24b}
\createlinenumber{2455}{ef88}
\createlinenumber{2456}{001e}
\createlinenumber{2457}{95cf}
\createlinenumber{2458}{925b}
\createlinenumber{2459}{fe38}
\createlinenumber{2460}{427e}
\createlinenumber{2461}{965e}
\createlinenumber{2462}{487c}
\createlinenumber{2463}{427e}
\createlinenumber{2464}{427e}
\createlinenumber{2465}{18d3}
\createlinenumber{2466}{390f}
\createlinenumber{2467}{8b3f}
\createlinenumber{2468}{70ea}
\createlinenumber{2469}{561f}
\createlinenumber{2470}{6439}
\createlinenumber{2471}{b627}
\createlinenumber{2472}{c05b}
\createlinenumber{2473}{0e39}
\createlinenumber{2474}{95cf}
\createlinenumber{2475}{427e}
\createlinenumber{2476}{5237}
\createlinenumber{2477}{56b2}
\createlinenumber{2478}{6eb3}
\createlinenumber{2479}{1d6c}
\createlinenumber{2480}{427e}
\createlinenumber{2481}{188b}
\createlinenumber{2482}{f57e}
\createlinenumber{2483}{17be}
\createlinenumber{2484}{f19e}
\createlinenumber{2485}{95cf}
\createlinenumber{2486}{dd0c}
\createlinenumber{2487}{95cf}
\createlinenumber{2488}{427e}
\createlinenumber{2489}{ce71}
\createlinenumber{2490}{46d4}
\createlinenumber{2491}{fe38}
\createlinenumber{2492}{427e}
\createlinenumber{2493}{58b9}
\createlinenumber{2494}{961d}
\createlinenumber{2495}{66e8}
\createlinenumber{2496}{427e}
\createlinenumber{2497}{ea33}
\createlinenumber{2498}{b6c4}
\createlinenumber{2499}{2f96}
\createlinenumber{2500}{5c86}
\createlinenumber{2501}{649a}
\createlinenumber{2502}{f931}
\createlinenumber{2503}{1112}
\createlinenumber{2504}{2f96}
\createlinenumber{2505}{3252}
\createlinenumber{2506}{649a}
\createlinenumber{2507}{b8c5}
\createlinenumber{2508}{8e2e}
\createlinenumber{2509}{717f}
\createlinenumber{2510}{eb10}
\createlinenumber{2511}{649a}
\createlinenumber{2512}{142a}
\createlinenumber{2513}{95cf}
\createlinenumber{2514}{95cf}
\createlinenumber{2515}{66e8}
\createlinenumber{2516}{95cf}
\createlinenumber{2517}{427e}
\createlinenumber{2518}{519b}
\createlinenumber{2519}{4506}
\createlinenumber{2520}{3cd1}
\createlinenumber{2521}{8d36}
\createlinenumber{2522}{427e}
\createlinenumber{2523}{17d7}
\createlinenumber{2524}{4be3}
\createlinenumber{2525}{4506}
\createlinenumber{2526}{ebae}
\createlinenumber{2527}{841d}
\createlinenumber{2528}{530f}
\createlinenumber{2529}{4f2d}
\createlinenumber{2530}{95cf}
\createlinenumber{2531}{35a1}
\createlinenumber{2532}{b87e}
\createlinenumber{2533}{95cf}
\createlinenumber{2534}{4efc}
\createlinenumber{2535}{4506}
\createlinenumber{2536}{7728}
\createlinenumber{2537}{96ed}
\createlinenumber{2538}{4b8a}
\createlinenumber{2539}{d268}
\createlinenumber{2540}{4506}
\createlinenumber{2541}{703f}
\createlinenumber{2542}{9628}
\createlinenumber{2543}{758e}
\createlinenumber{2544}{95cf}
\createlinenumber{2545}{95cf}
\createlinenumber{2546}{427e}
\createlinenumber{2547}{427e}
\createlinenumber{2548}{6bd3}
\createlinenumber{2549}{4506}
\createlinenumber{2550}{3cd1}
\createlinenumber{2551}{8d36}
\createlinenumber{2552}{427e}
\createlinenumber{2553}{17d7}
\createlinenumber{2554}{4be3}
\createlinenumber{2555}{4506}
\createlinenumber{2556}{c447}
\createlinenumber{2557}{4506}
\createlinenumber{2558}{530f}
\createlinenumber{2559}{77f9}
\createlinenumber{2560}{646e}
\createlinenumber{2561}{d16b}
\createlinenumber{2562}{469b}
\createlinenumber{2563}{1105}
\createlinenumber{2564}{d657}
\createlinenumber{2565}{3f99}
\createlinenumber{2566}{4f2d}
\createlinenumber{2567}{95cf}
\createlinenumber{2568}{35a1}
\createlinenumber{2569}{b87e}
\createlinenumber{2570}{95cf}
\createlinenumber{2571}{4f2d}
\createlinenumber{2572}{95cf}
\createlinenumber{2573}{427e}
\createlinenumber{2574}{427e}
\createlinenumber{2575}{0909}
\createlinenumber{2576}{4506}
\createlinenumber{2577}{d827}
\createlinenumber{2578}{79ab}
\createlinenumber{2579}{56b2}
\createlinenumber{2580}{646e}
\createlinenumber{2581}{d16b}
\createlinenumber{2582}{469b}
\createlinenumber{2583}{1105}
\createlinenumber{2584}{d657}
\createlinenumber{2585}{95cf}
\createlinenumber{2586}{427e}
\createlinenumber{2587}{d16f}
\createlinenumber{2588}{4506}
\createlinenumber{2589}{d827}
\createlinenumber{2590}{1ff2}
\createlinenumber{2591}{95cf}
\createlinenumber{2592}{427e}
\createlinenumber{2593}{8c3f}
\createlinenumber{2594}{4506}
\createlinenumber{2595}{56b2}
\createlinenumber{2596}{8d36}
\createlinenumber{2597}{427e}
\createlinenumber{2598}{4be3}
\createlinenumber{2599}{4506}
\createlinenumber{2600}{530f}
\createlinenumber{2601}{7459}
\createlinenumber{2602}{95cf}
\createlinenumber{2603}{35a1}
\createlinenumber{2604}{b87e}
\createlinenumber{2605}{95cf}
\createlinenumber{2606}{7021}
\createlinenumber{2607}{95cf}
\createlinenumber{2608}{427e}
\createlinenumber{2609}{4a3d}
\createlinenumber{2610}{4506}
\createlinenumber{2611}{c635}
\createlinenumber{2612}{95cf}
\createlinenumber{2613}{eb81}
\createlinenumber{2614}{427e}
\createlinenumber{2615}{427e}
\createlinenumber{2616}{59b9}
\createlinenumber{2617}{ef2f}
\createlinenumber{2618}{bffa}
\createlinenumber{2619}{54ff}
\createlinenumber{2620}{acb9}
\createlinenumber{2621}{427e}
\createlinenumber{2622}{421c}
\createlinenumber{2623}{427e}
\createlinenumber{2624}{baf7}
\createlinenumber{2625}{427e}
\createlinenumber{2626}{b47b}
\createlinenumber{2627}{06a1}
\createlinenumber{2628}{5da6}
\createlinenumber{2629}{427e}
\createlinenumber{2630}{427e}
\createlinenumber{2631}{427e}
\createlinenumber{2632}{f7cd}
\createlinenumber{2633}{b275}
\createlinenumber{2634}{427e}
\createlinenumber{2635}{880b}
\createlinenumber{2636}{9673}
\createlinenumber{2637}{427e}
\createlinenumber{2638}{329b}
\createlinenumber{2639}{427e}
\createlinenumber{2640}{e929}
\createlinenumber{2641}{6c85}
\createlinenumber{2642}{437d}
\createlinenumber{2643}{427e}
\createlinenumber{2644}{427e}
\createlinenumber{2645}{11d0}
\createlinenumber{2646}{427e}
\createlinenumber{2647}{4a30}
\createlinenumber{2648}{ea48}
\createlinenumber{2649}{427e}
\createlinenumber{2650}{88f1}
\createlinenumber{2651}{4506}
\createlinenumber{2652}{bd30}
\createlinenumber{2653}{1bb9}
\createlinenumber{2654}{47f6}
\createlinenumber{2655}{ab2e}
\createlinenumber{2656}{6b1f}
\createlinenumber{2657}{0380}
\createlinenumber{2658}{f607}
\createlinenumber{2659}{c969}
\createlinenumber{2660}{e3e8}
\createlinenumber{2661}{8259}
\createlinenumber{2662}{6a6a}
\createlinenumber{2663}{a562}
\createlinenumber{2664}{2753}
\createlinenumber{2665}{d657}
\createlinenumber{2666}{95cf}
\createlinenumber{2667}{427e}
\createlinenumber{2668}{b77a}
\createlinenumber{2669}{dbed}
\createlinenumber{2670}{40e5}
\createlinenumber{2671}{2d59}
\createlinenumber{2672}{577f}
\createlinenumber{2673}{ca6f}
\createlinenumber{2674}{2d6b}
\createlinenumber{2675}{bd5a}
\createlinenumber{2676}{ac50}
\createlinenumber{2677}{b142}
\createlinenumber{2678}{fdcf}
\createlinenumber{2679}{dd0c}
\createlinenumber{2680}{95cf}
\createlinenumber{2681}{427e}
\createlinenumber{2682}{9356}
\createlinenumber{2683}{47f6}
\createlinenumber{2684}{ab2e}
\createlinenumber{2685}{f607}
\createlinenumber{2686}{c969}
\createlinenumber{2687}{e3e8}
\createlinenumber{2688}{8259}
\createlinenumber{2689}{6a6a}
\createlinenumber{2690}{2753}
\createlinenumber{2691}{d657}
\createlinenumber{2692}{95cf}
\createlinenumber{2693}{427e}
\createlinenumber{2694}{886d}
\createlinenumber{2695}{fa89}
\createlinenumber{2696}{7619}
\createlinenumber{2697}{9fe9}
\createlinenumber{2698}{fb82}
\createlinenumber{2699}{95cf}
\createlinenumber{2700}{427e}
\createlinenumber{2701}{965e}
\createlinenumber{2702}{487c}
\createlinenumber{2703}{427e}
\createlinenumber{2704}{427e}
\createlinenumber{2705}{18d3}
\createlinenumber{2706}{390f}
\createlinenumber{2707}{8b3f}
\createlinenumber{2708}{70ea}
\createlinenumber{2709}{561f}
\createlinenumber{2710}{6439}
\createlinenumber{2711}{b627}
\createlinenumber{2712}{f5eb}
\createlinenumber{2713}{0e39}
\createlinenumber{2714}{95cf}
\createlinenumber{2715}{427e}
\createlinenumber{2716}{5237}
\createlinenumber{2717}{56b2}
\createlinenumber{2718}{6eb3}
\createlinenumber{2719}{1d6c}
\createlinenumber{2720}{427e}
\createlinenumber{2721}{188b}
\createlinenumber{2722}{f57e}
\createlinenumber{2723}{f1b2}
\createlinenumber{2724}{fefe}
\createlinenumber{2725}{95cf}
\createlinenumber{2726}{dd0c}
\createlinenumber{2727}{95cf}
\createlinenumber{2728}{427e}
\createlinenumber{2729}{427e}
\createlinenumber{2730}{f257}
\createlinenumber{2731}{4506}
\createlinenumber{2732}{da8a}
\createlinenumber{2733}{7602}
\createlinenumber{2734}{95cf}
\createlinenumber{2735}{427e}
\createlinenumber{2736}{58b9}
\createlinenumber{2737}{961d}
\createlinenumber{2738}{66e8}
\createlinenumber{2739}{427e}
\createlinenumber{2740}{ea33}
\createlinenumber{2741}{b6c4}
\createlinenumber{2742}{2f96}
\createlinenumber{2743}{5c86}
\createlinenumber{2744}{649a}
\createlinenumber{2745}{f931}
\createlinenumber{2746}{1112}
\createlinenumber{2747}{2f96}
\createlinenumber{2748}{3252}
\createlinenumber{2749}{649a}
\createlinenumber{2750}{b8c5}
\createlinenumber{2751}{8e2e}
\createlinenumber{2752}{717f}
\createlinenumber{2753}{eb10}
\createlinenumber{2754}{649a}
\createlinenumber{2755}{142a}
\createlinenumber{2756}{95cf}
\createlinenumber{2757}{95cf}
\createlinenumber{2758}{66e8}
\createlinenumber{2759}{95cf}
\createlinenumber{2760}{427e}
\createlinenumber{2761}{427e}
\createlinenumber{2762}{aae1}
\createlinenumber{2763}{4506}
\createlinenumber{2764}{fc5e}
\createlinenumber{2765}{79ab}
\createlinenumber{2766}{56b2}
\createlinenumber{2767}{646e}
\createlinenumber{2768}{d16b}
\createlinenumber{2769}{469b}
\createlinenumber{2770}{1105}
\createlinenumber{2771}{d657}
\createlinenumber{2772}{95cf}
\createlinenumber{2773}{427e}
\createlinenumber{2774}{0edf}
\createlinenumber{2775}{4506}
\createlinenumber{2776}{d827}
\createlinenumber{2777}{427e}
\createlinenumber{2778}{e7e2}
\createlinenumber{2779}{7235}
\createlinenumber{2780}{3fe8}
\createlinenumber{2781}{d5f0}
\createlinenumber{2782}{f9af}
\createlinenumber{2783}{530f}
\createlinenumber{2784}{95cf}
\createlinenumber{2785}{a228}
\createlinenumber{2786}{4506}
\createlinenumber{2787}{af72}
\createlinenumber{2788}{eb9a}
\createlinenumber{2789}{4506}
\createlinenumber{2790}{17d7}
\createlinenumber{2791}{eec3}
\createlinenumber{2792}{20e3}
\createlinenumber{2793}{3c94}
\createlinenumber{2794}{95cf}
\createlinenumber{2795}{8740}
\createlinenumber{2796}{9bfe}
\createlinenumber{2797}{95cf}
\createlinenumber{2798}{df17}
\createlinenumber{2799}{4506}
\createlinenumber{2800}{9131}
\createlinenumber{2801}{b7b0}
\createlinenumber{2802}{ee3d}
\createlinenumber{2803}{7235}
\createlinenumber{2804}{3fe8}
\createlinenumber{2805}{d5f0}
\createlinenumber{2806}{ebf4}
\createlinenumber{2807}{530f}
\createlinenumber{2808}{95cf}
\createlinenumber{2809}{eb81}
\createlinenumber{2810}{427e}
\createlinenumber{2811}{0edf}
\createlinenumber{2812}{4506}
\createlinenumber{2813}{b69b}
\createlinenumber{2814}{0a72}
\createlinenumber{2815}{95cf}
\createlinenumber{2816}{427e}
\createlinenumber{2817}{427e}
\createlinenumber{2818}{299c}
\createlinenumber{2819}{4506}
\createlinenumber{2820}{1008}
\createlinenumber{2821}{b889}
\createlinenumber{2822}{4506}
\createlinenumber{2823}{db73}
\createlinenumber{2824}{19f9}
\createlinenumber{2825}{6b7c}
\createlinenumber{2826}{524a}
\createlinenumber{2827}{720b}
\createlinenumber{2828}{4506}
\createlinenumber{2829}{860a}
\createlinenumber{2830}{b81b}
\createlinenumber{2831}{4506}
\createlinenumber{2832}{5006}
\createlinenumber{2833}{7309}
\createlinenumber{2834}{c2a0}
\createlinenumber{2835}{a3af}
\createlinenumber{2836}{603e}
\createlinenumber{2837}{4506}
\createlinenumber{2838}{3834}
\createlinenumber{2839}{bf62}
\createlinenumber{2840}{bb40}
\createlinenumber{2841}{b72a}
\createlinenumber{2842}{4506}
\createlinenumber{2843}{0016}
\createlinenumber{2844}{95cf}
\createlinenumber{2845}{95cf}
\createlinenumber{2846}{95cf}
\createlinenumber{2847}{95cf}
\begin{lstlisting}[language={}]
#include<cstdio>
#include<cstring>
#include<cstdlib>

using namespace std;

#define MAXN 40010
#define INF 1ll<<62
#define MAX(a,b) ((a)>(b)?(a):(b))
struct SplayTree{

  struct SplayNode{
    SplayNode *f,*C[2];
    //int s,ml,mr,max,tot,sz;
    long long s,c,sz;
    //bool rev,same;
  } S[MAXN],*root,*null,*tr;
  
  int sz;
  
  void init()
  {
    for (int i=0;i<=sz;i++) S[i].s=S[i].c=S[i].sz=0;
    sz=0;
    null=NewNode(null,-INF);
    null->s=0;
    null->f=null;
    null->sz=0;
    null->C[0]=null->C[1]=null;
    root=NewNode(null,-INF);
    root->C[1]=NewNode(root,INF);
    update(root->C[1]);
    update(root);
  }

  SplayNode * NewNode( SplayNode *f, long long s){
    SplayNode *ts;
    ts=S+ ++sz;
    ts->f=f;
    ts->c=0;
    ts->C[0]=ts->C[1]=null;
    ts->s=s;
    //ts->tot=ts->max=ts->ml=ts->mr=ts->s;
    ts->sz=1;
    //ts->rev=ts->same=0;
    return ts;
  }
  
  SplayTree(){
    null=NewNode(null,-INF);
    null->s=0;
    null->f=null;
    null->sz=0;
    null->C[0]=null->C[1]=null;
    root=NewNode(null,-INF);
    root->C[1]=NewNode(root,INF);
    update(root->C[1]);
    update(root);
  }

  void update( SplayNode * x){
    x->sz=x->C[0]->sz+x->C[1]->sz+1+x->c;
    /*x->tot=x->C[0]->tot+x->C[1]->tot+x->s;
    x->max=MAX(x->s,x->C[0]->max);
    x->max=MAX(x->max,x->C[1]->max);
    x->max=MAX(x->max,x->C[0]->mr+x->s);
    x->max=MAX(x->max,x->C[1]->ml+x->s);
    x->max=MAX(x->max,x->C[0]->mr+x->s+x->C[1]->ml);
    x->ml=MAX(x->C[0]->ml,x->C[0]->tot+x->s);
    x->ml=MAX(x->ml,x->C[0]->tot+x->s+x->C[1]->ml);
    x->mr=MAX(x->C[1]->mr,x->C[1]->tot+x->s);
    x->mr=MAX(x->mr,x->C[1]->tot+x->s+x->C[0]->mr);*/
  }
  
  /*void labledown( SplayNode *x){
    SplayNode *ts;
    int tmp;
    if (x==null||!(x->same||x->rev)) return ;
    if (x->same){
      x->C[1]->same=x->C[0]->same=1;
      x->C[1]->s=x->C[0]->s=x->s;
      x->tot=x->s*x->sz;
      x->max=x->ml=x->mr=x->tot;
      if (x->s<0)
        x->max=x->ml=x->mr=x->s;
    }
    if (x->rev){
      tmp=x->ml;x->ml=x->mr;x->mr=tmp;
      ts=x->C[1];x->C[1]=x->C[0];x->C[0]=ts;
      x->C[1]->rev=!x->C[1]->rev;x->C[0]->rev=!x->C[0]->rev;
    }
    x->same=x->rev=0;
  }*/
  
  void route( SplayNode *k1, int c){
    SplayNode *k2=k1->f;
    //labledown(k2->C[!c]);labledown(k1->C[0]);labledown(k1->C[1]);

    k2->C[c]=k1->C[!c];
    k2->C[c]->f=k2;
    k1->f=k2->f;
    if (k2->f->C[0]==k2) k2->f->C[0]=k1;
    else k2->f->C[1]=k1;
    k2->f=k1;
    k1->C[!c]=k2;
    update(k2);//update(k1);
    if (root==k2) root=k1;
  }
  
  SplayNode * rank( int k){
    SplayNode *ts=root;
    int tmp;
    while (k){
      //labledown(ts);
      tmp=ts->C[0]->sz;
      if (k<=tmp) ts=ts->C[0];
      else if (k<=tmp+ts->c+1) break;
      else k-=tmp+ts->c+1,ts=ts->C[1];
    }
    return ts;
  }
  
  /*void select( int s, int r){
    rank(s,null);rank(r,root);
  }*/
  
  void splay( SplayNode *x, SplayNode *s){
    if (x==null) return ;
    update(x);
    //labledown(x);
    while (x->f!=s){
      if (x->f->f==s){
        if (x->f->C[0]==x)
          route(x,0);
        else 
          route(x,1);
      } else if (x->f->f->C[0]==x->f){
        if (x->f->C[0]==x)
          route(x->f,0),route(x,0);
        else
          route(x,1),route(x,0);
      } else {
        if (x->f->C[1]==x)
          route(x->f,1),route(x,1);
        else
          route(x,0),route(x,1);
      }
    }
        update(x);
  }

  void ins( long long k)
  {
    SplayNode *ts=root,*ls=null;
    while (ts!=null){
      //labledown(ts);
      ls=ts;
      if (k==ts->s)
      {
        ts->c++;
        update(ts);
        splay(ts,null);
        return ;
      }
      else if (k<ts->s) ts=ts->C[0];
      else ts=ts->C[1];
    }
    if (k<ls->s)
    {
      ls->C[0]=NewNode(ls,k);
      update(ls->C[0]);update(ls);
      splay(ls->C[0],null);
    } else
    {
      ls->C[1]=NewNode(ls,k);
      update(ls->C[1]);update(ls);
      splay(ls->C[1],null);
    }
  }

  //value k
  void remove( long long k)
  {
    SplayNode *ts=root,*ls=null;
    while (ts!=null){
      //labledown(ts);
      ls=ts;
      if (k==ts->s)
      {
        if (ts->c==0)
        {
          splay(ts,null);
          splay(rank(ts->C[0]->sz),root);
          root=ts->C[0];
          root->f=null;
          root->C[1]=ts->C[1];
          ts->C[1]->f=root;
          update(root);
        } else ts->c--,update(ts),splay(ts,null);
        return ;
      }
      else if (k<ts->s) ts=ts->C[0];
      else ts=ts->C[1];
    }
    return ;//not find
  }

  //rank k
  void del( int k)
  {
    splay(rank(k+1),null);
    splay(rank(root->C[0]->sz),root);
    SplayNode *ts=root;
    root=ts->C[0];
    root->f=null;
    root->C[1]=ts->C[1];
    ts->C[1]->f=root;
    update(root);
  }

  int find( int k)
  {
    splay(rank(k+1),null);
    return root->s;
  }
  
  int find_v( int k)
  {
    SplayNode *ts=root;
    while (ts!=null){
      //labledown(ts);
      if (k==ts->s)
      {
        splay(ts,null);
        return 1;
      }
      else if (k<ts->s) ts=ts->C[0];
      else ts=ts->C[1];
    }
    return 0;
  }

  bool empty()
  {
    return !(root->sz-2>0);
  }
} T;


#include<cstdio>
#include<cstring>
#include<cstdlib>
#include<algorithm>
#include<queue>

using namespace std;

priority_queue<int> MinNumber;

#define MAXN 300010
#define INF 1ll<<62
#define MAX(a,b) ((a)>(b)?(a):(b))



struct SplayNode{
  SplayNode *f,*C[2];
  //int s,ml,mr,max,tot,sz;
  long long s,c,sz,tot;
  int neg,pos,sta;
  //bool rev,same;
};
  
int N,st,it;
char s[100];
SplayNode *A[MAXN],*B[MAXN];


struct SplayTree{

  int sz;
  SplayNode S[MAXN],*root,*null,*tr;
  
  void init()
  {
    for (int i=0;i<=sz;i++) S[i].s=S[i].c=S[i].sz=0;
    sz=0;
    null=NewNode(null,-INF);
    null->s=0;
    null->tot=0;
    null->neg=null->pos=0;
    null->f=null;
    null->sz=0;
    null->C[0]=null->C[1]=null;
    root=NewNode(null,0);
    root->C[1]=NewNode(root,0);
    root->neg=root->pos=root->C[1]->neg=root->C[0]->pos=root->sta=root->C[1]->sta=0;
    update(root->C[1]);
    update(root);
  }

  SplayNode * NewNode( SplayNode *f, long long s){
    SplayNode *ts;
    ts=S+ ++sz;
    ts->f=f;
    ts->C[0]=ts->C[1]=null;
    ts->s=s;
    ts->tot=s;
    ts->neg=s<0?1:0;
    ts->pos=s>0?1:0;
    ts->sta=s>0?1:-1;
    ts->sz=1;
    return ts;
  }
  
  SplayTree(){
    null=NewNode(null,-INF);
    null->s=0;
    null->f=null;
    null->sz=0;
    null->C[0]=null->C[1]=null;
    root=NewNode(null,0);
    root->C[1]=NewNode(root,0);
    update(root->C[1]);
    update(root);
  }

  void update( SplayNode * x){
    x->sz=x->C[0]->sz+x->C[1]->sz+1+x->c;
    x->tot=x->C[0]->tot+x->C[1]->tot+x->s;
    x->neg=x->C[0]->neg+x->C[1]->neg+(x->sta==-1?1:0);
    x->pos=x->C[0]->pos+x->C[1]->pos+(x->sta==1?1:0);
  }
  
  void route( SplayNode *k1, int c){
    SplayNode *k2=k1->f;
    //labledown(k2->C[!c]);labledown(k1->C[0]);labledown(k1->C[1]);

    k2->C[c]=k1->C[!c];
    k2->C[c]->f=k2;
    k1->f=k2->f;
    if (k2->f->C[0]==k2) k2->f->C[0]=k1;
    else k2->f->C[1]=k1;
    k2->f=k1;
    k1->C[!c]=k2;
    update(k2);update(k1);
    if (root==k2) root=k1;
  }
  
  SplayNode * rank( int k){
    SplayNode *ts=root;
    int tmp;
    while (k){
//        labledown(ts);
      tmp=ts->C[0]->sz;
      if (k<=tmp) ts=ts->C[0];
      else if (k<=tmp+1) break;
      else k-=tmp+1,ts=ts->C[1];
    }
    return ts;
  }
  

  long long query( SplayNode *l, SplayNode *r)
  {
    splay(l,null);splay(r,root);
    return root->C[1]->C[0]->tot+root->s+root->C[1]->s;
  }
  
  void splay( SplayNode *x, SplayNode *s){
    if (x==null) return ;
    update(x);
    //labledown(x);
    while (x->f!=s){
      if (x->f->f==s){
        if (x->f->C[0]==x)
          route(x,0);
        else 
          route(x,1);
      } else if (x->f->f->C[0]==x->f){
        if (x->f->C[0]==x)
          route(x->f,0),route(x,0);
        else
          route(x,1),route(x,0);
      } else {
        if (x->f->C[1]==x)
          route(x->f,1),route(x,1);
        else
          route(x,0),route(x,1);
      }
    }
        update(x);
  }

  //rank k
  void del( SplayNode *ss)
  {
    splay(ss,null);
    splay(rank(root->C[0]->sz),root);
    SplayNode *ts=root;
    root=ts->C[0];
    root->f=null;
    root->C[1]=ts->C[1];
    ts->C[1]->f=root;
    update(root);
  }

  void ins( int k, int s)
  {
    splay(rank(k+1),null);
    //splay(rank(k),root);
    SplayNode *ts=NewNode(root,s);
    root->C[0]->f=ts;
    ts->C[0]=root->C[0];
    root->C[0]=ts;
    A[s]=ts;
    splay(ts,null);
  }
  void find( int t)
  {
    SplayNode *ts=root,*ls;
    while (ts!=null)
    {
      ls=ts;
      if (ts->C[1]->neg>=t) ts=ts->C[1];
      else if (ts->C[1]->neg+(ts->sta<0?1:0)==t) break;
      else t-=ts->C[1]->neg+(ts->sta<0?1:0),ts=ts->C[0];
    }
    if (ts==null)splay(ls,null);
    else splay(ts,null);
  }
  void insins( int k, int s)
  {
    int t=root->C[1]->pos;
    find(t);
    SplayNode *ts=NewNode(root,-s);
    root->C[0]->f=ts;
    ts->C[0]=root->C[0];
    root->C[0]=ts;
    B[s]=ts;
    splay(ts,null);
  }
} T;

void ins( int k, int s)
{
  T.ins(k,s);
  T.insins(k,s);
}


int main()
{
  int cases=0;
  while (scanf("%d\n",&N)!=EOF)
  {
    T.init();
    while (MinNumber.size()) MinNumber.pop();
    int nown=0,t;
    printf("Case #%d:\n",++cases);
    while (N--)
    {
      scanf("%s %d\n",s,&t);
      if (s[0]=='i')
      {
        t++;
        if (MinNumber.empty()) it=++nown;
        else it=-MinNumber.top(),MinNumber.pop();
        ins(t,it);
      } else if (s[0]=='r') 
      {
        MinNumber.push(-t);
        T.del(A[t]);
        T.del(B[t]);
      } else if (s[0]=='q')
      {
        printf("%I64d\n",T.query(A[t],B[t]));
      }
    }
  }
}
\end{lstlisting}
\subsection{SplayTree~}
\createlinenumber{2848}{59b9}
\createlinenumber{2849}{ef2f}
\createlinenumber{2850}{bffa}
\createlinenumber{2851}{427e}
\createlinenumber{2852}{421c}
\createlinenumber{2853}{427e}
\createlinenumber{2854}{1c79}
\createlinenumber{2855}{06a1}
\createlinenumber{2856}{5da6}
\createlinenumber{2857}{11d0}
\createlinenumber{2858}{427e}
\createlinenumber{2859}{f7cd}
\createlinenumber{2860}{b275}
\createlinenumber{2861}{427e}
\createlinenumber{2862}{440f}
\createlinenumber{2863}{427e}
\createlinenumber{2864}{b01b}
\createlinenumber{2865}{427e}
\createlinenumber{2866}{4a30}
\createlinenumber{2867}{427e}
\createlinenumber{2868}{88f1}
\createlinenumber{2869}{4506}
\createlinenumber{2870}{bd30}
\createlinenumber{2871}{1bb9}
\createlinenumber{2872}{47f6}
\createlinenumber{2873}{ab2e}
\createlinenumber{2874}{f607}
\createlinenumber{2875}{c969}
\createlinenumber{2876}{e3e8}
\createlinenumber{2877}{b6b3}
\createlinenumber{2878}{0e03}
\createlinenumber{2879}{2753}
\createlinenumber{2880}{d657}
\createlinenumber{2881}{95cf}
\createlinenumber{2882}{427e}
\createlinenumber{2883}{b77a}
\createlinenumber{2884}{dbed}
\createlinenumber{2885}{40e5}
\createlinenumber{2886}{2d59}
\createlinenumber{2887}{bc22}
\createlinenumber{2888}{577f}
\createlinenumber{2889}{ca6f}
\createlinenumber{2890}{427e}
\createlinenumber{2891}{fdcf}
\createlinenumber{2892}{427e}
\createlinenumber{2893}{dd0c}
\createlinenumber{2894}{95cf}
\createlinenumber{2895}{427e}
\createlinenumber{2896}{9356}
\createlinenumber{2897}{47f6}
\createlinenumber{2898}{ab2e}
\createlinenumber{2899}{f607}
\createlinenumber{2900}{c969}
\createlinenumber{2901}{e3e8}
\createlinenumber{2902}{b6b3}
\createlinenumber{2903}{0e03}
\createlinenumber{2904}{2753}
\createlinenumber{2905}{d657}
\createlinenumber{2906}{95cf}
\createlinenumber{2907}{427e}
\createlinenumber{2908}{886d}
\createlinenumber{2909}{fa89}
\createlinenumber{2910}{180a}
\createlinenumber{2911}{b048}
\createlinenumber{2912}{935a}
\createlinenumber{2913}{3392}
\createlinenumber{2914}{9a2e}
\createlinenumber{2915}{8176}
\createlinenumber{2916}{0181}
\createlinenumber{2917}{7a57}
\createlinenumber{2918}{77d1}
\createlinenumber{2919}{a71b}
\createlinenumber{2920}{95cf}
\createlinenumber{2921}{427e}
\createlinenumber{2922}{1455}
\createlinenumber{2923}{dbed}
\createlinenumber{2924}{6eb3}
\createlinenumber{2925}{45c9}
\createlinenumber{2926}{d66a}
\createlinenumber{2927}{d26a}
\createlinenumber{2928}{e573}
\createlinenumber{2929}{3058}
\createlinenumber{2930}{37f3}
\createlinenumber{2931}{89b1}
\createlinenumber{2932}{be32}
\createlinenumber{2933}{95cf}
\createlinenumber{2934}{e2e3}
\createlinenumber{2935}{f24b}
\createlinenumber{2936}{ef88}
\createlinenumber{2937}{001e}
\createlinenumber{2938}{95cf}
\createlinenumber{2939}{925b}
\createlinenumber{2940}{fe38}
\createlinenumber{2941}{427e}
\createlinenumber{2942}{965e}
\createlinenumber{2943}{487c}
\createlinenumber{2944}{427e}
\createlinenumber{2945}{427e}
\createlinenumber{2946}{18d3}
\createlinenumber{2947}{390f}
\createlinenumber{2948}{8b3f}
\createlinenumber{2949}{70ea}
\createlinenumber{2950}{561f}
\createlinenumber{2951}{6439}
\createlinenumber{2952}{b627}
\createlinenumber{2953}{c05b}
\createlinenumber{2954}{0e39}
\createlinenumber{2955}{95cf}
\createlinenumber{2956}{427e}
\createlinenumber{2957}{5237}
\createlinenumber{2958}{56b2}
\createlinenumber{2959}{6eb3}
\createlinenumber{2960}{1d6c}
\createlinenumber{2961}{427e}
\createlinenumber{2962}{188b}
\createlinenumber{2963}{f57e}
\createlinenumber{2964}{17be}
\createlinenumber{2965}{f19e}
\createlinenumber{2966}{95cf}
\createlinenumber{2967}{dd0c}
\createlinenumber{2968}{95cf}
\createlinenumber{2969}{427e}
\createlinenumber{2970}{ce71}
\createlinenumber{2971}{46d4}
\createlinenumber{2972}{fe38}
\createlinenumber{2973}{427e}
\createlinenumber{2974}{58b9}
\createlinenumber{2975}{961d}
\createlinenumber{2976}{66e8}
\createlinenumber{2977}{427e}
\createlinenumber{2978}{ea33}
\createlinenumber{2979}{b6c4}
\createlinenumber{2980}{2f96}
\createlinenumber{2981}{5c86}
\createlinenumber{2982}{649a}
\createlinenumber{2983}{f931}
\createlinenumber{2984}{1112}
\createlinenumber{2985}{2f96}
\createlinenumber{2986}{3252}
\createlinenumber{2987}{649a}
\createlinenumber{2988}{b8c5}
\createlinenumber{2989}{8e2e}
\createlinenumber{2990}{717f}
\createlinenumber{2991}{eb10}
\createlinenumber{2992}{649a}
\createlinenumber{2993}{142a}
\createlinenumber{2994}{95cf}
\createlinenumber{2995}{95cf}
\createlinenumber{2996}{66e8}
\createlinenumber{2997}{95cf}
\createlinenumber{2998}{427e}
\createlinenumber{2999}{519b}
\createlinenumber{3000}{4506}
\createlinenumber{3001}{3cd1}
\createlinenumber{3002}{8d36}
\createlinenumber{3003}{427e}
\createlinenumber{3004}{17d7}
\createlinenumber{3005}{4be3}
\createlinenumber{3006}{4506}
\createlinenumber{3007}{ebae}
\createlinenumber{3008}{841d}
\createlinenumber{3009}{530f}
\createlinenumber{3010}{4f2d}
\createlinenumber{3011}{95cf}
\createlinenumber{3012}{35a1}
\createlinenumber{3013}{b87e}
\createlinenumber{3014}{95cf}
\createlinenumber{3015}{4efc}
\createlinenumber{3016}{4506}
\createlinenumber{3017}{7728}
\createlinenumber{3018}{96ed}
\createlinenumber{3019}{4b8a}
\createlinenumber{3020}{d268}
\createlinenumber{3021}{4506}
\createlinenumber{3022}{703f}
\createlinenumber{3023}{9628}
\createlinenumber{3024}{758e}
\createlinenumber{3025}{95cf}
\createlinenumber{3026}{95cf}
\createlinenumber{3027}{427e}
\createlinenumber{3028}{427e}
\createlinenumber{3029}{6bd3}
\createlinenumber{3030}{4506}
\createlinenumber{3031}{3cd1}
\createlinenumber{3032}{8d36}
\createlinenumber{3033}{427e}
\createlinenumber{3034}{17d7}
\createlinenumber{3035}{4be3}
\createlinenumber{3036}{4506}
\createlinenumber{3037}{c447}
\createlinenumber{3038}{4506}
\createlinenumber{3039}{530f}
\createlinenumber{3040}{77f9}
\createlinenumber{3041}{646e}
\createlinenumber{3042}{d16b}
\createlinenumber{3043}{469b}
\createlinenumber{3044}{1105}
\createlinenumber{3045}{d657}
\createlinenumber{3046}{3f99}
\createlinenumber{3047}{4f2d}
\createlinenumber{3048}{95cf}
\createlinenumber{3049}{35a1}
\createlinenumber{3050}{b87e}
\createlinenumber{3051}{95cf}
\createlinenumber{3052}{4f2d}
\createlinenumber{3053}{95cf}
\createlinenumber{3054}{427e}
\createlinenumber{3055}{427e}
\createlinenumber{3056}{0909}
\createlinenumber{3057}{4506}
\createlinenumber{3058}{d827}
\createlinenumber{3059}{79ab}
\createlinenumber{3060}{56b2}
\createlinenumber{3061}{646e}
\createlinenumber{3062}{d16b}
\createlinenumber{3063}{469b}
\createlinenumber{3064}{1105}
\createlinenumber{3065}{d657}
\createlinenumber{3066}{95cf}
\createlinenumber{3067}{427e}
\createlinenumber{3068}{d16f}
\createlinenumber{3069}{4506}
\createlinenumber{3070}{d827}
\createlinenumber{3071}{1ff2}
\createlinenumber{3072}{95cf}
\createlinenumber{3073}{427e}
\createlinenumber{3074}{8c3f}
\createlinenumber{3075}{4506}
\createlinenumber{3076}{56b2}
\createlinenumber{3077}{8d36}
\createlinenumber{3078}{427e}
\createlinenumber{3079}{4be3}
\createlinenumber{3080}{4506}
\createlinenumber{3081}{530f}
\createlinenumber{3082}{7459}
\createlinenumber{3083}{95cf}
\createlinenumber{3084}{35a1}
\createlinenumber{3085}{b87e}
\createlinenumber{3086}{95cf}
\createlinenumber{3087}{7021}
\createlinenumber{3088}{95cf}
\createlinenumber{3089}{427e}
\createlinenumber{3090}{4a3d}
\createlinenumber{3091}{4506}
\createlinenumber{3092}{c635}
\createlinenumber{3093}{95cf}
\createlinenumber{3094}{eb81}
\begin{lstlisting}[language={}]
#include<cstdio>
#include<cstring>
#include<cstdlib>

using namespace std;

#define MAXN 40010
#define INF 1ll<<62
#define MAX(a,b) ((a)>(b)?(a):(b))
struct SplayTree{

  struct SplayNode{
    SplayNode *f,*C[2];
    //int s,ml,mr,max,tot,sz;
    long long s,c,sz;
    //bool rev,same;
  } S[MAXN],*root,*null,*tr;
  
  int sz;
  
  void init()
  {
    for (int i=0;i<=sz;i++) S[i].s=S[i].c=S[i].sz=0;
    sz=0;
    null=NewNode(null,-INF);
    null->s=0;
    null->f=null;
    null->sz=0;
    null->C[0]=null->C[1]=null;
    root=NewNode(null,-INF);
    root->C[1]=NewNode(root,INF);
    update(root->C[1]);
    update(root);
  }

  SplayNode * NewNode( SplayNode *f, long long s){
    SplayNode *ts;
    ts=S+ ++sz;
    ts->f=f;
    ts->c=0;
    ts->C[0]=ts->C[1]=null;
    ts->s=s;
    //ts->tot=ts->max=ts->ml=ts->mr=ts->s;
    ts->sz=1;
    //ts->rev=ts->same=0;
    return ts;
  }
  
  SplayTree(){
    null=NewNode(null,-INF);
    null->s=0;
    null->f=null;
    null->sz=0;
    null->C[0]=null->C[1]=null;
    root=NewNode(null,-INF);
    root->C[1]=NewNode(root,INF);
    update(root->C[1]);
    update(root);
  }

  void update( SplayNode * x){
    x->sz=x->C[0]->sz+x->C[1]->sz+1+x->c;
    /*x->tot=x->C[0]->tot+x->C[1]->tot+x->s;
    x->max=MAX(x->s,x->C[0]->max);
    x->max=MAX(x->max,x->C[1]->max);
    x->max=MAX(x->max,x->C[0]->mr+x->s);
    x->max=MAX(x->max,x->C[1]->ml+x->s);
    x->max=MAX(x->max,x->C[0]->mr+x->s+x->C[1]->ml);
    x->ml=MAX(x->C[0]->ml,x->C[0]->tot+x->s);
    x->ml=MAX(x->ml,x->C[0]->tot+x->s+x->C[1]->ml);
    x->mr=MAX(x->C[1]->mr,x->C[1]->tot+x->s);
    x->mr=MAX(x->mr,x->C[1]->tot+x->s+x->C[0]->mr);*/
  }
  
  /*void labledown( SplayNode *x){
    SplayNode *ts;
    int tmp;
    if (x==null||!(x->same||x->rev)) return ;
    if (x->same){
      x->C[1]->same=x->C[0]->same=1;
      x->C[1]->s=x->C[0]->s=x->s;
      x->tot=x->s*x->sz;
      x->max=x->ml=x->mr=x->tot;
      if (x->s<0)
        x->max=x->ml=x->mr=x->s;
    }
    if (x->rev){
      tmp=x->ml;x->ml=x->mr;x->mr=tmp;
      ts=x->C[1];x->C[1]=x->C[0];x->C[0]=ts;
      x->C[1]->rev=!x->C[1]->rev;x->C[0]->rev=!x->C[0]->rev;
    }
    x->same=x->rev=0;
  }*/
  
  void route( SplayNode *k1, int c){
    SplayNode *k2=k1->f;
    //labledown(k2->C[!c]);labledown(k1->C[0]);labledown(k1->C[1]);

    k2->C[c]=k1->C[!c];
    k2->C[c]->f=k2;
    k1->f=k2->f;
    if (k2->f->C[0]==k2) k2->f->C[0]=k1;
    else k2->f->C[1]=k1;
    k2->f=k1;
    k1->C[!c]=k2;
    update(k2);//update(k1);
    if (root==k2) root=k1;
  }
  
  SplayNode * rank( int k){
    SplayNode *ts=root;
    int tmp;
    while (k){
      //labledown(ts);
      tmp=ts->C[0]->sz;
      if (k<=tmp) ts=ts->C[0];
      else if (k<=tmp+ts->c+1) break;
      else k-=tmp+ts->c+1,ts=ts->C[1];
    }
    return ts;
  }
  
  /*void select( int s, int r){
    rank(s,null);rank(r,root);
  }*/
  
  void splay( SplayNode *x, SplayNode *s){
    if (x==null) return ;
    update(x);
    //labledown(x);
    while (x->f!=s){
      if (x->f->f==s){
        if (x->f->C[0]==x)
          route(x,0);
        else 
          route(x,1);
      } else if (x->f->f->C[0]==x->f){
        if (x->f->C[0]==x)
          route(x->f,0),route(x,0);
        else
          route(x,1),route(x,0);
      } else {
        if (x->f->C[1]==x)
          route(x->f,1),route(x,1);
        else
          route(x,0),route(x,1);
      }
    }
        update(x);
  }

  void ins( long long k)
  {
    SplayNode *ts=root,*ls=null;
    while (ts!=null){
      //labledown(ts);
      ls=ts;
      if (k==ts->s)
      {
        ts->c++;
        update(ts);
        splay(ts,null);
        return ;
      }
      else if (k<ts->s) ts=ts->C[0];
      else ts=ts->C[1];
    }
    if (k<ls->s)
    {
      ls->C[0]=NewNode(ls,k);
      update(ls->C[0]);update(ls);
      splay(ls->C[0],null);
    } else
    {
      ls->C[1]=NewNode(ls,k);
      update(ls->C[1]);update(ls);
      splay(ls->C[1],null);
    }
  }

  //value k
  void remove( long long k)
  {
    SplayNode *ts=root,*ls=null;
    while (ts!=null){
      //labledown(ts);
      ls=ts;
      if (k==ts->s)
      {
        if (ts->c==0)
        {
          splay(ts,null);
          splay(rank(ts->C[0]->sz),root);
          root=ts->C[0];
          root->f=null;
          root->C[1]=ts->C[1];
          ts->C[1]->f=root;
          update(root);
        } else ts->c--,update(ts),splay(ts,null);
        return ;
      }
      else if (k<ts->s) ts=ts->C[0];
      else ts=ts->C[1];
    }
    return ;//not find
  }

  //rank k
  void del( int k)
  {
    splay(rank(k+1),null);
    splay(rank(root->C[0]->sz),root);
    SplayNode *ts=root;
    root=ts->C[0];
    root->f=null;
    root->C[1]=ts->C[1];
    ts->C[1]->f=root;
    update(root);
  }

  int find( int k)
  {
    splay(rank(k+1),null);
    return root->s;
  }
  
  int find_v( int k)
  {
    SplayNode *ts=root;
    while (ts!=null){
      //labledown(ts);
      if (k==ts->s)
      {
        splay(ts,null);
        return 1;
      }
      else if (k<ts->s) ts=ts->C[0];
      else ts=ts->C[1];
    }
    return 0;
  }

  bool empty()
  {
    return !(root->sz-2>0);
  }
} T;
\end{lstlisting}
\subsection{kdtree}
\createlinenumber{3095}{0193}
\createlinenumber{3096}{f877}
\createlinenumber{3097}{7829}
\createlinenumber{3098}{427e}
\createlinenumber{3099}{d975}
\createlinenumber{3100}{427e}
\createlinenumber{3101}{5f09}
\createlinenumber{3102}{a5e8}
\createlinenumber{3103}{082e}
\createlinenumber{3104}{7864}
\createlinenumber{3105}{aa08}
\createlinenumber{3106}{3b30}
\createlinenumber{3107}{8339}
\createlinenumber{3108}{58a4}
\createlinenumber{3109}{95cf}
\createlinenumber{3110}{329b}
\createlinenumber{3111}{9bba}
\createlinenumber{3112}{889f}
\createlinenumber{3113}{b02e}
\createlinenumber{3114}{d902}
\createlinenumber{3115}{4206}
\createlinenumber{3116}{95cf}
\createlinenumber{3117}{c188}
\createlinenumber{3118}{427e}
\createlinenumber{3119}{6343}
\createlinenumber{3120}{f78e}
\createlinenumber{3121}{ceb8}
\createlinenumber{3122}{6055}
\createlinenumber{3123}{2abf}
\createlinenumber{3124}{d66a}
\createlinenumber{3125}{95cf}
\createlinenumber{3126}{438e}
\createlinenumber{3127}{95cf}
\createlinenumber{3128}{427e}
\createlinenumber{3129}{f8d9}
\createlinenumber{3130}{38a5}
\createlinenumber{3131}{6f63}
\createlinenumber{3132}{a55b}
\createlinenumber{3133}{c024}
\createlinenumber{3134}{0c52}
\createlinenumber{3135}{009e}
\createlinenumber{3136}{5e06}
\createlinenumber{3137}{fae0}
\createlinenumber{3138}{b556}
\createlinenumber{3139}{3a4a}
\createlinenumber{3140}{95cf}
\createlinenumber{3141}{96c3}
\createlinenumber{3142}{6ee4}
\createlinenumber{3143}{427e}
\createlinenumber{3144}{eea1}
\createlinenumber{3145}{38a5}
\createlinenumber{3146}{eae0}
\createlinenumber{3147}{2db0}
\createlinenumber{3148}{c9e2}
\createlinenumber{3149}{95cf}
\createlinenumber{3150}{329b}
\createlinenumber{3151}{427e}
\createlinenumber{3152}{4e6c}
\createlinenumber{3153}{d043}
\createlinenumber{3154}{0109}
\createlinenumber{3155}{add6}
\createlinenumber{3156}{ffe7}
\createlinenumber{3157}{b544}
\createlinenumber{3158}{e49b}
\createlinenumber{3159}{5ceb}
\createlinenumber{3160}{6d98}
\createlinenumber{3161}{95cf}
\createlinenumber{3162}{427e}
\createlinenumber{3163}{48d3}
\createlinenumber{3164}{1cc2}
\createlinenumber{3165}{d02f}
\createlinenumber{3166}{ff78}
\createlinenumber{3167}{e7b8}
\createlinenumber{3168}{006e}
\createlinenumber{3169}{8e2e}
\createlinenumber{3170}{5fcc}
\createlinenumber{3171}{527c}
\createlinenumber{3172}{95cf}
\createlinenumber{3173}{aa78}
\createlinenumber{3174}{95cf}
\createlinenumber{3175}{427e}
\createlinenumber{3176}{3ef1}
\createlinenumber{3177}{d3df}
\createlinenumber{3178}{ad9e}
\createlinenumber{3179}{af4d}
\createlinenumber{3180}{2451}
\createlinenumber{3181}{91b7}
\createlinenumber{3182}{b333}
\createlinenumber{3183}{95cf}
\createlinenumber{3184}{b3f8}
\createlinenumber{3185}{0817}
\createlinenumber{3186}{95cf}
\createlinenumber{3187}{0f33}
\createlinenumber{3188}{438e}
\createlinenumber{3189}{95cf}
\createlinenumber{3190}{427e}
\createlinenumber{3191}{0fb3}
\createlinenumber{3192}{5dd1}
\createlinenumber{3193}{e213}
\createlinenumber{3194}{4f2d}
\createlinenumber{3195}{95cf}
\createlinenumber{3196}{af9c}
\createlinenumber{3197}{0b50}
\createlinenumber{3198}{0109}
\createlinenumber{3199}{add6}
\createlinenumber{3200}{895b}
\createlinenumber{3201}{b544}
\createlinenumber{3202}{4e19}
\createlinenumber{3203}{95cf}
\createlinenumber{3204}{f7cb}
\createlinenumber{3205}{2836}
\createlinenumber{3206}{f1f4}
\createlinenumber{3207}{5846}
\createlinenumber{3208}{95cf}
\createlinenumber{3209}{427e}
\createlinenumber{3210}{427e}
\createlinenumber{3211}{4d4d}
\createlinenumber{3212}{b335}
\createlinenumber{3213}{3c91}
\createlinenumber{3214}{427e}
\createlinenumber{3215}{13c5}
\createlinenumber{3216}{c275}
\createlinenumber{3217}{aa47}
\createlinenumber{3218}{4e19}
\createlinenumber{3219}{95cf}
\createlinenumber{3220}{8766}
\createlinenumber{3221}{07c2}
\createlinenumber{3222}{e213}
\createlinenumber{3223}{9bd2}
\createlinenumber{3224}{130b}
\createlinenumber{3225}{bcd6}
\createlinenumber{3226}{4e19}
\createlinenumber{3227}{95cf}
\createlinenumber{3228}{2741}
\createlinenumber{3229}{95cf}
\createlinenumber{3230}{427e}
\createlinenumber{3231}{007d}
\createlinenumber{3232}{d043}
\createlinenumber{3233}{1c34}
\createlinenumber{3234}{788a}
\createlinenumber{3235}{4cd0}
\createlinenumber{3236}{01cc}
\createlinenumber{3237}{95cf}
\createlinenumber{3238}{1cf1}
\createlinenumber{3239}{2de3}
\createlinenumber{3240}{9123}
\createlinenumber{3241}{95cf}
\createlinenumber{3242}{3d5d}
\createlinenumber{3243}{788a}
\createlinenumber{3244}{9cb6}
\createlinenumber{3245}{1388}
\createlinenumber{3246}{95cf}
\createlinenumber{3247}{51dc}
\createlinenumber{3248}{910e}
\createlinenumber{3249}{33ad}
\createlinenumber{3250}{95cf}
\createlinenumber{3251}{95cf}
\createlinenumber{3252}{427e}
\createlinenumber{3253}{427e}
\createlinenumber{3254}{427e}
\createlinenumber{3255}{427e}
\createlinenumber{3256}{d02f}
\createlinenumber{3257}{fb76}
\createlinenumber{3258}{636f}
\createlinenumber{3259}{34f1}
\createlinenumber{3260}{e0a6}
\createlinenumber{3261}{11a5}
\createlinenumber{3262}{95cf}
\createlinenumber{3263}{910c}
\createlinenumber{3264}{4aed}
\createlinenumber{3265}{a7b0}
\createlinenumber{3266}{7b7e}
\createlinenumber{3267}{8ce7}
\createlinenumber{3268}{ac44}
\createlinenumber{3269}{b4f2}
\createlinenumber{3270}{6a2a}
\createlinenumber{3271}{e8ae}
\createlinenumber{3272}{74a5}
\createlinenumber{3273}{0176}
\createlinenumber{3274}{95cf}
\createlinenumber{3275}{aa78}
\createlinenumber{3276}{95cf}
\begin{lstlisting}[language={}]
const int inf = 1000000000;
#define sqr(x) (((long long)(x))*(x))
const int MAXN = 500000;
//MAXM 维度数
const int MAXM = 2;
// 必须手动设置点的度数 degree
struct POINT{
  int x[MAXM], lx[MAXM], rx[MAXM];
  int index;
  int degree;
  POINT(){
    for (int i = 0; i < MAXM; ++i){
      lx[i] = 0;
      rx[i] = inf;
    }
  };
  long long dis(const POINT &a){
    long long ans = 0;
    for (int i = 0; i < degree; ++i)
      ans += sqr(x[i] - a.x[i]);
    return ans;
  }
}p[MAXN];
//comindex 是首先比较的维度必须在比较之前赋值
int cmpindex;
bool cmp(const POINT &a, const POINT &b){
  for (int i = 0; i < a.degree; ++i){
    int j = (i + cmpindex) % a.degree;
    if (a.x[j] != b.x[j])
      return a.x[j] < b.x[j];
  }
  return false;
}
//degree 首先被比较的维度
struct NODE{
  POINT p;
  int left, right, father;
  int number, degree, flag;
  void init(const POINT &a, int d){
    p = a;
    left = -1;
    right = -1;
    degree = d;
    number = 1;
    flag = false;
  }
}node[MAXN];
int nodesize;
// 储存结果
struct CYL{
  POINT p;
  long long r;
  bool operator < (const CYL &a)const{
    return r < a.r;
  }
};
// 求出v 节点下的所有点到顶点p 的距离
void searchr(int v, const POINT &p, priority_queue<CYL> &pq, int k){
  if (v == -1) return;
  CYL c;
  c.p = node[v].p;
  c.r = c.p.dis(p);
  pq.push(c);
  while (pq.size() > k) pq.pop();
  searchr(node[v].left, p, pq, k);
  searchr(node[v].right, p, pq, k);
}
// 贪心地返回点数接近k 的节点 
int searchknode(int v, const POINT &p, int k){
  if ((v == -1)||(node[v].number < k)) return -1;
  cmpindex = node[v].degree;
  if (cmp(p, node[v].p)){
    if ((node[v].left != -1)&&(node[node[v].left].number >= k))
      return searchknode(node[v].left, p, k);
  }else{
    if ((node[v].right != -1)&&(node[node[v].right].number >= k))
      return searchknode(node[v].right, p, k);
  }
  return v;
}
// 检查某区域是否可能有k 小的点
bool check(POINT &root, const POINT &p, priority_queue<CYL> &pq){
  POINT c;
  c.degree = p.degree;
  for (int i = 0; i < p.degree; ++i){
    if ((root.lx[i] <= p.x[i])&&(p.x[i] <= root.rx[i])){
      c.x[i] = p.x[i];
      continue;
    }
    if (p.x[i] < root.lx[i]) c.x[i] = root.lx[i];
    else c.x[i] = root.rx[i];
  }
  if (c.dis(p) < pq.top().r) return true;
  return false;
}
// 寻找距离最近的k 个点
void findk(int v, const POINT &p, int k, priority_queue<CYL> &pq){
  if (node[v].flag){
    node[v].flag = false;
    return;
  }
  long long d = node[v].p.dis(p);
  if (d < pq.top().r){
    CYL c;
    c.p = node[v].p;
    c.r = d;
    pq.push(c);
    pq.pop();
  }
  if ((node[v].left != -1)&&check(node[node[v].left].p, p, pq))
    findk(node[v].left, p, k, pq);
  if ((node[v].right != -1)&&check(node[node[v].right].p, p, pq))
    findk(node[v].right, p, k, pq);
}
//KNN 算法，输入KD-tree 的根， 返回与p 最相邻的k 个点
//ans 中保证点到p的距离依次递增
void KNN(const POINT &p, int k, POINT ans[]){
  priority_queue<CYL> pq;
  int v = searchknode(0, p, k);
  //cout<<v<<endl;
  node[v].flag = true;
  searchr(v, p, pq, k);
  while(pq.size() > k){
    pq.pop();
  }
  cnt = 0;
  findk(0, p, k, pq);
  node[v].flag = false;
  int n = pq.size();
  for (int i = 0; i < k; ++i){
    ans[i] = pq.top().p;
    pq.pop();
  }
  reverse(ans, ans + k);
}
// 设置每个区域的界
void boundset(int v){
  if (v == -1) return;
  if (node[v].left != -1){
    for (int i = 0; i < node[v].p.degree; ++i){
      node[node[v].left].p.rx[i] = node[v].p.rx[i];
      node[node[v].left].p.lx[i] = node[v].p.lx[i];
    }
    node[node[v].left].father = v;
    node[node[v].left].p.rx[node[v].degree] = node[v].p.x[node[v].degree];
    boundset(node[v].left);
  }
  if (node[v].right != -1){
    for (int i = 0; i < node[v].p.degree; ++i){
      node[node[v].right].p.rx[i] = node[v].p.rx[i];
      node[node[v].right].p.lx[i] = node[v].p.lx[i];
    }
    node[node[v].right].father = v;
    node[node[v].right].p.lx[node[v].degree] = node[v].p.x[node[v].degree];
    boundset(node[v].right);
  }
}

// 根据p 中的[s, t) 点建立Kd-TREE ,
//p 中的顺序会被破坏
//degree 是首先比较的维度 
int buildtree(int s, int t, int degree, POINT p[], begin = 1){
  if (begin) nodesize = 0;
  if (s == t) return -1;
  else if(t - s == 1){
    node[nodesize].init(p[s], degree);
    return nodesize++;
  }
  cmpindex = degree;
  sort(p + s, p + t, cmp);
  int mid = (s + t - 1) >> 1;
  int v = nodesize;
  node[nodesize++].init(p[mid], degree);
  node[v].left = buildtree(s, mid, (degree + 1) % p[mid].degree, p, 0);
  node[v].right = buildtree(mid + 1, t, (degree + 1) % p[mid].degree, p, 0);
  node[v].number = t - s;
  if (!v){
    node[0].father = -1;
    boundset(0);
  }
  return v;
}
\end{lstlisting}
\subsection{后缀数组}
\createlinenumber{3277}{e0a5}
\createlinenumber{3278}{59b9}
\createlinenumber{3279}{09f7}
\createlinenumber{3280}{ef2f}
\createlinenumber{3281}{2349}
\createlinenumber{3282}{421c}
\createlinenumber{3283}{f7d6}
\createlinenumber{3284}{1779}
\createlinenumber{3285}{2358}
\createlinenumber{3286}{427e}
\createlinenumber{3287}{427e}
\createlinenumber{3288}{427e}
\createlinenumber{3289}{427e}
\createlinenumber{3290}{427e}
\createlinenumber{3291}{427e}
\createlinenumber{3292}{2278}
\createlinenumber{3293}{3aa5}
\createlinenumber{3294}{4506}
\createlinenumber{3295}{e543}
\createlinenumber{3296}{95cf}
\createlinenumber{3297}{427e}
\createlinenumber{3298}{cdcb}
\createlinenumber{3299}{4506}
\createlinenumber{3300}{8fa8}
\createlinenumber{3301}{c934}
\createlinenumber{3302}{e6d3}
\createlinenumber{3303}{2d9a}
\createlinenumber{3304}{5b0a}
\createlinenumber{3305}{427e}
\createlinenumber{3306}{efbc}
\createlinenumber{3307}{4506}
\createlinenumber{3308}{5b7b}
\createlinenumber{3309}{dc1c}
\createlinenumber{3310}{792f}
\createlinenumber{3311}{c934}
\createlinenumber{3312}{f297}
\createlinenumber{3313}{2d9a}
\createlinenumber{3314}{e91d}
\createlinenumber{3315}{0b94}
\createlinenumber{3316}{fef3}
\createlinenumber{3317}{95cf}
\createlinenumber{3318}{95cf}
\createlinenumber{3319}{8a3e}
\createlinenumber{3320}{3aa5}
\createlinenumber{3321}{9692}
\createlinenumber{3322}{cdcb}
\createlinenumber{3323}{4506}
\createlinenumber{3324}{8fa8}
\createlinenumber{3325}{4f37}
\createlinenumber{3326}{960c}
\createlinenumber{3327}{be11}
\createlinenumber{3328}{5f6d}
\createlinenumber{3329}{efbc}
\createlinenumber{3330}{4506}
\createlinenumber{3331}{5b7b}
\createlinenumber{3332}{dc1c}
\createlinenumber{3333}{792f}
\createlinenumber{3334}{4f37}
\createlinenumber{3335}{7f78}
\createlinenumber{3336}{be11}
\createlinenumber{3337}{f3a2}
\createlinenumber{3338}{0b94}
\createlinenumber{3339}{fef3}
\createlinenumber{3340}{95cf}
\createlinenumber{3341}{fe38}
\createlinenumber{3342}{427e}
\createlinenumber{3343}{427e}
\createlinenumber{3344}{427e}
\createlinenumber{3345}{427e}
\createlinenumber{3346}{427e}
\createlinenumber{3347}{427e}
\createlinenumber{3348}{9750}
\createlinenumber{3349}{4506}
\createlinenumber{3350}{d7f5}
\createlinenumber{3351}{95cf}
\createlinenumber{3352}{6829}
\createlinenumber{3353}{1258}
\createlinenumber{3354}{8b9e}
\createlinenumber{3355}{95cf}
\createlinenumber{3356}{8df6}
\createlinenumber{3357}{4506}
\createlinenumber{3358}{a0f7}
\createlinenumber{3359}{0fed}
\createlinenumber{3360}{c934}
\createlinenumber{3361}{f297}
\createlinenumber{3362}{2d9a}
\createlinenumber{3363}{1285}
\createlinenumber{3364}{4f2d}
\createlinenumber{3365}{95cf}
\createlinenumber{3366}{81ce}
\createlinenumber{3367}{4506}
\createlinenumber{3368}{455d}
\createlinenumber{3369}{825e}
\createlinenumber{3370}{b6f1}
\createlinenumber{3371}{427e}
\createlinenumber{3372}{7371}
\createlinenumber{3373}{06a6}
\createlinenumber{3374}{79ea}
\createlinenumber{3375}{427e}
\createlinenumber{3376}{64aa}
\createlinenumber{3377}{16b5}
\createlinenumber{3378}{427e}
\createlinenumber{3379}{778a}
\createlinenumber{3380}{6879}
\createlinenumber{3381}{427e}
\createlinenumber{3382}{37b9}
\createlinenumber{3383}{427e}
\createlinenumber{3384}{6cbc}
\createlinenumber{3385}{427e}
\createlinenumber{3386}{0fde}
\createlinenumber{3387}{427e}
\createlinenumber{3388}{e658}
\createlinenumber{3389}{79d3}
\createlinenumber{3390}{427e}
\createlinenumber{3391}{1a17}
\createlinenumber{3392}{427e}
\createlinenumber{3393}{d05f}
\createlinenumber{3394}{b151}
\createlinenumber{3395}{427e}
\createlinenumber{3396}{95cf}
\createlinenumber{3397}{427e}
\createlinenumber{3398}{427e}
\createlinenumber{3399}{427e}
\createlinenumber{3400}{427e}
\createlinenumber{3401}{427e}
\createlinenumber{3402}{427e}
\createlinenumber{3403}{427e}
\createlinenumber{3404}{427e}
\createlinenumber{3405}{427e}
\createlinenumber{3406}{8039}
\createlinenumber{3407}{4772}
\createlinenumber{3408}{4506}
\createlinenumber{3409}{ff68}
\createlinenumber{3410}{3748}
\createlinenumber{3411}{d007}
\createlinenumber{3412}{3e0a}
\createlinenumber{3413}{4f2d}
\createlinenumber{3414}{95cf}
\createlinenumber{3415}{427e}
\createlinenumber{3416}{4fe3}
\createlinenumber{3417}{5731}
\createlinenumber{3418}{01f2}
\createlinenumber{3419}{299c}
\createlinenumber{3420}{4506}
\createlinenumber{3421}{582c}
\createlinenumber{3422}{8d4d}
\createlinenumber{3423}{e2ff}
\createlinenumber{3424}{f411}
\createlinenumber{3425}{8426}
\createlinenumber{3426}{f76f}
\createlinenumber{3427}{7bae}
\createlinenumber{3428}{790a}
\createlinenumber{3429}{0c37}
\createlinenumber{3430}{5271}
\createlinenumber{3431}{790a}
\createlinenumber{3432}{8560}
\createlinenumber{3433}{95cf}
\createlinenumber{3434}{95cf}
\begin{lstlisting}[language={}]
#include<iostream>
#include<cstdio>
#include<vector>
#include<cstring>
#include<string>
using namespace std;
const int maxn=10000;
#define F(x) ((x)/3+((x)%3==1?0:tb))
#define G(x) ((x)<tb?(x)*3+1:((x)-tb)*3+2)

//值得注意的是，rank数组 与 sa数组互逆 ，所以可以根据sa  在O（n）时间内求出rank 
//以下为倍增算法实现  O（nlogn） 
//r 为字符串数组  ,sa 为结果S 的n 个后缀从小到大进行排序之后把排好序的后缀的开头位置顺序，也就是字典序 
//次放入sa 中 

int wa[maxn],wb[maxn],wv[maxn],ws_[maxn];
int cmp(int *r,int a,int b,int l)
{
  return r[a]==r[b]&&r[a+l]==r[b+l];
}
//n是r数组的长度，即strlen（r）,m 为语言集的最大编号 
void da(int *r,int *sa,int n,int m)
{
   int i,j,p,*x=wa,*y=wb,*t;
   for(i=0;i<m;i++) ws_[i]=0;
   for(i=0;i<n;i++) ws_[x[i]=r[i]]++;
   for(i=1;i<m;i++) ws_[i]+=ws_[i-1];
   for(i=n-1;i>=0;i--) sa[--ws_[x[i]]]=i;

   for(j=1,p=1;p<n;j*=2,m=p)
   {
    for(p=0,i=n-j;i<n;i++) y[p++]=i;
    for(i=0;i<n;i++) if(sa[i]>=j) y[p++]=sa[i]-j;
    for(i=0;i<n;i++) wv[i]=x[y[i]];
    for(i=0;i<m;i++) ws_[i]=0;
    for(i=0;i<n;i++) ws_[wv[i]]++;
    for(i=1;i<m;i++) ws_[i]+=ws_[i-1];
    for(i=n-1;i>=0;i--) sa[--ws_[wv[i]]]=y[i];
    for(t=x,x=y,y=t,p=1,x[sa[0]]=0,i=1;i<n;i++)
     x[sa[i]]=cmp(y,sa[i-1],sa[i],j)?p-1:p++;
   }
}
/*int wa[maxn],wb[maxn],wv[maxn],ws[maxn];
int cmp(int *r,int a,int b,int l)
{return r[a]==r[b]&&r[a+l]==r[b+l];}
void da(int *r,int *sa,int n,int m)
{
  int i,j,p,*x=wa,*y=wb,*t;
  for(i=0;i<m;i++) ws[i]=0;
  for(i=0;i<n;i++) ws[x[i]=r[i]]++;
  for(i=1;i<m;i++) ws[i]+=ws[i-1];
  for(i=n-1;i>=0;i--) sa[--ws[x[i]]]=i;
  for(j=1,p=1;p<n;j*=2,m=p)
  {
    for(p=0,i=n-j;i<n;i++) y[p++]=i;
    for(i=0;i<n;i++) if(sa[i]>=j) y[p++]=sa[i]-j;
    for(i=0;i<n;i++) wv[i]=x[y[i]];
    for(i=0;i<m;i++) ws[i]=0;
    for(i=0;i<n;i++) ws[wv[i]]++;
    for(i=1;i<m;i++) ws[i]+=ws[i-1];
    for(i=n-1;i>=0;i--) sa[--ws[wv[i]]]=y[i];
    for(t=x,x=y,y=t,p=1,x[sa[0]]=0,i=1;i<n;i++)
    x[sa[i]]=cmp(y,sa[i-1],sa[i],j)?p-1:p++;
  }
}*/
//以下是DC3算法  O(n)
//r 数组和sa 数组的大小都要是3*n
//下面的三行都是必须的。。为了避免名冲突 
//#define F(x) ((x)/3+((x)%3==1?0:tb))
//#define G(x) ((x)<tb?(x)*3+1:((x)-tb)*3+2)
//int wa[maxn],wb[maxn],wv[maxn],ws_[maxn];
int c0(int *r,int a,int b)
{
  return r[a]==r[b]&&r[a+1]==r[b+1]&&r[a+2]==r[b+2];
}
int c12(int k,int *r,int a,int b)
{  if(k==2) return r[a]<r[b]||r[a]==r[b]&&c12(1,r,a+1,b+1);
   else return r[a]<r[b]||r[a]==r[b]&&wv[a+1]<wv[b+1];
}
void sort_sa(int *r,int *a,int *b,int n,int m)
{
   int i;
   for(i=0;i<n;i++) wv[i]=r[a[i]];
   for(i=0;i<m;i++) ws_[i]=0;
   for(i=0;i<n;i++) ws_[wv[i]]++;
   for(i=1;i<m;i++) ws_[i]+=ws_[i-1];
   for(i=n-1;i>=0;i--) b[--ws_[wv[i]]]=a[i];
   return;
}
void dc3(int *r,int *sa,int n,int m)
{
   int i,j,*rn=r+n,*san=sa+n,ta=0,tb=(n+1)/3,tbc=0,p;
   r[n]=r[n+1]=0;
   for(i=0;i<n;i++) if(i%3!=0) wa[tbc++]=i;
   
   sort_sa(r+2,wa,wb,tbc,m);
   sort_sa(r+1,wb,wa,tbc,m);
   sort_sa(r,wa,wb,tbc,m);
   
   for(p=1,rn[F(wb[0])]=0,i=1;i<tbc;i++)
   rn[F(wb[i])]=c0(r,wb[i-1],wb[i])?p-1:p++;
   
   if(p<tbc) dc3(rn,san,tbc,p);
   else for(i=0;i<tbc;i++) san[rn[i]]=i;
   
   for(i=0;i<tbc;i++) if(san[i]<tb) wb[ta++]=san[i]*3;
   
   if(n%3==1) wb[ta++]=n-1;
   
   sort_sa(r,wb,wa,ta,m);
   
   for(i=0;i<tbc;i++) wv[wb[i]=G(san[i])]=i;
   for(i=0,j=0,p=0;i<ta && j<tbc;p++)
   
   sa[p]=c12(wb[j]%3,r,wa[i],wb[j])?wa[i++]:wb[j++];
   
   for(;i<ta;p++) sa[p]=wa[i++];
   for(;j<tbc;p++) sa[p]=wb[j++];
   
} 

//height 数组：定义height[i]=suffix(sa[i-1])和suffix(sa[i])的最长公共前缀
//算法如下，复杂度O（n）
//一个重要的结论：suffix(j) 和suffix(k) 的最长公共前缀为height[rank[j]+1],
//height[rank[j]+2], height[rank[j]+3], … ,height[rank[k]]中的最小值。 

//待排序的字符串放在r 数组中，从r[0]到r[n-1]，长度为n，且最大值小
//于m。为了函数操作的方便，约定除r[n-1]外所有的r[i]都大于0, r[n-1]=0。
//函数结束后，结果放在sa 数组中，从sa[0]到sa[n-1]。
int rank[maxn],height[maxn];
void calheight(int *r,int *sa,int n)
{
   int i,j,k=0;
   for(i=1;i<=n;i++) rank[sa[i]]=i;
   for(i=0;i<n;height[rank[i++]]=k)
   for(k?k--:0,j=sa[rank[i]-1];r[i+k]==r[j+k];k++);
   return;
} 

char str[100];
int  r[100];
int  sa[100];
int main()
{
  while(cin>>str){
    int L=strlen(str);
    for(int i=0;i<L;i++)r[i]=str[i]-'0';
    for(int i=0;i<L;i++)sa[i]=i;
    r[L]=0;
    da(r,sa,L+1,200); 
    cout<<"haha\n";
    for(int i=0;i<L;i++)
      cout<<sa[i]<<' ';cout<<endl;
    calheight(r,sa,L);
    for(int i=0;i<L;i++)
      cout<<height[i]<<' ';cout<<endl;
  }
}
\end{lstlisting}
\subsection{线段树区间修改}
\createlinenumber{3435}{59b9}
\createlinenumber{3436}{427e}
\createlinenumber{3437}{5963}
\createlinenumber{3438}{4506}
\createlinenumber{3439}{ff6f}
\createlinenumber{3440}{d788}
\createlinenumber{3441}{d7af}
\createlinenumber{3442}{651e}
\createlinenumber{3443}{ecbf}
\createlinenumber{3444}{f365}
\createlinenumber{3445}{4506}
\createlinenumber{3446}{2d0d}
\createlinenumber{3447}{4506}
\createlinenumber{3448}{1111}
\createlinenumber{3449}{1f3f}
\createlinenumber{3450}{eef5}
\createlinenumber{3451}{95cf}
\createlinenumber{3452}{95cf}
\createlinenumber{3453}{69ea}
\createlinenumber{3454}{4506}
\createlinenumber{3455}{eed2}
\createlinenumber{3456}{30f7}
\createlinenumber{3457}{456c}
\createlinenumber{3458}{4506}
\createlinenumber{3459}{a619}
\createlinenumber{3460}{4f2d}
\createlinenumber{3461}{95cf}
\createlinenumber{3462}{8f58}
\createlinenumber{3463}{b2c9}
\createlinenumber{3464}{95cf}
\createlinenumber{3465}{25be}
\createlinenumber{3466}{4506}
\createlinenumber{3467}{eed2}
\createlinenumber{3468}{30f7}
\createlinenumber{3469}{456c}
\createlinenumber{3470}{4506}
\createlinenumber{3471}{f1c1}
\createlinenumber{3472}{eed2}
\createlinenumber{3473}{4f2d}
\createlinenumber{3474}{95cf}
\createlinenumber{3475}{817a}
\createlinenumber{3476}{3afb}
\createlinenumber{3477}{7514}
\createlinenumber{3478}{95cf}
\createlinenumber{3479}{4d16}
\createlinenumber{3480}{4506}
\createlinenumber{3481}{2944}
\createlinenumber{3482}{b3f6}
\createlinenumber{3483}{7991}
\createlinenumber{3484}{95cf}
\createlinenumber{3485}{a363}
\createlinenumber{3486}{4506}
\createlinenumber{3487}{a0c0}
\createlinenumber{3488}{ea34}
\createlinenumber{3489}{cc62}
\createlinenumber{3490}{ba71}
\createlinenumber{3491}{95cf}
\createlinenumber{3492}{893e}
\createlinenumber{3493}{4506}
\createlinenumber{3494}{62cd}
\createlinenumber{3495}{31fd}
\createlinenumber{3496}{95cf}
\createlinenumber{3497}{eb81}
\createlinenumber{3498}{427e}
\createlinenumber{3499}{12d2}
\createlinenumber{3500}{427e}
\createlinenumber{3501}{299c}
\createlinenumber{3502}{4506}
\createlinenumber{3503}{a82c}
\createlinenumber{3504}{d49b}
\createlinenumber{3505}{a874}
\createlinenumber{3506}{4506}
\createlinenumber{3507}{677b}
\createlinenumber{3508}{3069}
\createlinenumber{3509}{c396}
\createlinenumber{3510}{95cf}
\createlinenumber{3511}{95cf}
\begin{lstlisting}[language={}]
#include <cstdio>

struct IT
{
  #define MN 1048577*2
  long long F[MN],D[MN];
  int N;
  long long C,Ans;
  int ll,rr;
  void upd( int k, int l, int r)
  {
    if (D[k])
    {
      F[k]+=D[k]*((long long)r-l+1);
      if (k<N) D[k<<1]+=D[k],D[(k<<1)+1]+=D[k];
      D[k]=0;
    }
  }
  void find( int k, int l, int r)
  {
    upd(k,l,r);
    if (r<ll||l>rr) return ;
    if (ll<=l&&rr>=r)
    {
      Ans+=F[k];
      return ;
    }
    find(k<<1,l,(l+r)>>1);
    find((k<<1)+1,((l+r)>>1)+1,r);
  }
  void Add( int k, int l, int r)
  {
    upd(k,l,r);
    if (r<ll||l>rr) return ;
    if (ll<=l&&rr>=r)
    {
      D[k]+=C;
      upd(k,l,r);
      return ;
    }
    Add(k<<1,l,(l+r)>>1);
    Add((k<<1)+1,((l+r)>>1)+1,r);
    F[k]=F[k<<1]+F[(k<<1)+1];
  }
  void init( int NN)
  {
    for (N=1;N<NN;N<<=1);
    for (int i=1;i<=NN;i++) scanf("%I64d",&F[i+N-1]);
    for (int i=N-1;i;i--) F[i]=F[i<<1]+F[(i<<1)+1];
  }
  long long search( int _l, int _r)
  {
    ll=_l;rr=_r;
    Ans=0;
    find(1,1,N);
    return Ans;
  }
  void add( int _l, int _r, long long c)
  {
    ll=_l;rr=_r;C=c;
    Add(1,1,N);
  }
} T;

int N,M,a,b,c;

int main()
{
  scanf("%d%d",&N,&M);
  T.init(N);
  for (int i=1;i<=M;i++)
  {
    scanf("%d%d%d",&a,&b,&c);
    T.Add(a,b,c);
    printf("%lld\n",T.search(i,N));
  }
}
\end{lstlisting}
\subsection{AhoCorasick}
\createlinenumber{3512}{e0a5}
\createlinenumber{3513}{ef2f}
\createlinenumber{3514}{59b9}
\createlinenumber{3515}{c928}
\createlinenumber{3516}{09f7}
\createlinenumber{3517}{acb9}
\createlinenumber{3518}{54ff}
\createlinenumber{3519}{421c}
\createlinenumber{3520}{427e}
\createlinenumber{3521}{427e}
\createlinenumber{3522}{427e}
\createlinenumber{3523}{c115}
\createlinenumber{3524}{5841}
\createlinenumber{3525}{b43a}
\createlinenumber{3526}{94ec}
\createlinenumber{3527}{35b8}
\createlinenumber{3528}{586b}
\createlinenumber{3529}{cbdf}
\createlinenumber{3530}{5520}
\createlinenumber{3531}{df17}
\createlinenumber{3532}{8c42}
\createlinenumber{3533}{4022}
\createlinenumber{3534}{2e34}
\createlinenumber{3535}{5d53}
\createlinenumber{3536}{59e7}
\createlinenumber{3537}{196d}
\createlinenumber{3538}{feb8}
\createlinenumber{3539}{95cf}
\createlinenumber{3540}{f53c}
\createlinenumber{3541}{ff1e}
\createlinenumber{3542}{356f}
\createlinenumber{3543}{c273}
\createlinenumber{3544}{9c09}
\createlinenumber{3545}{5e5e}
\createlinenumber{3546}{f543}
\createlinenumber{3547}{bc80}
\createlinenumber{3548}{95cf}
\createlinenumber{3549}{79dc}
\createlinenumber{3550}{95cf}
\createlinenumber{3551}{7b5e}
\createlinenumber{3552}{95cf}
\createlinenumber{3553}{2114}
\createlinenumber{3554}{dfc8}
\createlinenumber{3555}{a7a6}
\createlinenumber{3556}{6830}
\createlinenumber{3557}{131c}
\createlinenumber{3558}{9b4d}
\createlinenumber{3559}{79f5}
\createlinenumber{3560}{95cf}
\createlinenumber{3561}{649a}
\createlinenumber{3562}{6c43}
\createlinenumber{3563}{95cf}
\createlinenumber{3564}{88bb}
\createlinenumber{3565}{e42e}
\createlinenumber{3566}{38ff}
\createlinenumber{3567}{1a76}
\createlinenumber{3568}{6830}
\createlinenumber{3569}{9f81}
\createlinenumber{3570}{076e}
\createlinenumber{3571}{659d}
\createlinenumber{3572}{95cf}
\createlinenumber{3573}{649a}
\createlinenumber{3574}{7720}
\createlinenumber{3575}{95cf}
\createlinenumber{3576}{95cf}
\createlinenumber{3577}{95cf}
\createlinenumber{3578}{0244}
\createlinenumber{3579}{7af7}
\createlinenumber{3580}{1abe}
\createlinenumber{3581}{dfbc}
\createlinenumber{3582}{3117}
\createlinenumber{3583}{8b27}
\createlinenumber{3584}{178e}
\createlinenumber{3585}{c5bc}
\createlinenumber{3586}{ee09}
\createlinenumber{3587}{137a}
\createlinenumber{3588}{aa86}
\createlinenumber{3589}{95cf}
\createlinenumber{3590}{b345}
\createlinenumber{3591}{7a1a}
\createlinenumber{3592}{bbfc}
\createlinenumber{3593}{9e25}
\createlinenumber{3594}{5f0a}
\createlinenumber{3595}{c3c1}
\createlinenumber{3596}{95cf}
\createlinenumber{3597}{3663}
\createlinenumber{3598}{4b53}
\createlinenumber{3599}{8fc2}
\createlinenumber{3600}{494a}
\createlinenumber{3601}{f70a}
\createlinenumber{3602}{f281}
\createlinenumber{3603}{3ddf}
\createlinenumber{3604}{24ec}
\createlinenumber{3605}{9e0a}
\createlinenumber{3606}{f4b4}
\createlinenumber{3607}{f9e8}
\createlinenumber{3608}{95cf}
\createlinenumber{3609}{95cf}
\createlinenumber{3610}{1aea}
\createlinenumber{3611}{4d5d}
\createlinenumber{3612}{5ad9}
\createlinenumber{3613}{1daa}
\createlinenumber{3614}{7968}
\createlinenumber{3615}{95cf}
\createlinenumber{3616}{95cf}
\createlinenumber{3617}{3214}
\createlinenumber{3618}{e0fa}
\createlinenumber{3619}{95cf}
\createlinenumber{3620}{95cf}
\begin{lstlisting}[language={}]
#include<iostream>
#include<cstring>
#include<cstdio>
#include<cmath>
#include<vector>
#include<queue>
#include<algorithm>
using namespace std;
//const int inf=INT_MAX;
//int maxInt   =   0x7FFFFFFF;//   32   bit
//long  maxLong  =   0x7FFFFFFFFFFFFFFF;   // 64   bit
#define ll long long
const int inf= 0x7FFFFFFF;
const char atcg[]="ATCG";
const int kind=4;
int n,m;
char in[105];
struct ahocorasick{
  static const int undef=0;//tag初始化
  static const int maxn=1<<10;
  static const int charset=4;//子节点个数
  int end;
  int tag[maxn],fail[maxn],trie[maxn][charset];
  void init(){
    tag[0]=undef;
    fill(trie[0],trie[0]+charset,-1);
    end=1;
  }
  void add(int m,const char *s,int t){//插入状态为t
    int p=0,index;
    for(int i=0;i<m;i++){
      index=strchr(atcg,s[i])-atcg;
      if(trie[p][index]==-1){
        tag[end]=undef;
        fill(trie[end],trie[end]+charset,-1);
        trie[p][index]=end++;
      }
      p=trie[p][index];
    }
    tag[p]|=t;
  }
  void build(){
    queue<int>bfs;
    fail[0]=0;
    for(int i=0;i<charset;i++){
      if(trie[0][i]!=-1){
        fail[trie[0][i]]=0;
        bfs.push(trie[0][i]);
      }
      else
        trie[0][i]=0;
    }
    while(!bfs.empty()){
      int p=bfs.front();
      tag[p]|=tag[fail[p]];
      bfs.pop();
      for(int i=0;i<charset;i++){
        if(trie[p][i]!=-1){
          fail[trie[p][i]]=trie[fail[p]][i];
          bfs.push(trie[p][i]);
        }
        else
          trie[p][i]=trie[fail[p]][i];
      }
    }
  }
}ac;
bool dp[2][1<<11][1<<11];
int sum[1<<11];
int w[101];
int main(){
  int i,j,k,t,cur,pre;
  while(scanf("%d%d",&n,&m)+1){
    ac.init();
    for(i=0;i<n;i++){
      scanf("%s %d",in,&w[i]);
      ac.add(strlen(in),in,1<<i);
    }
    ac.build();
    memset(sum,0,sizeof(sum));
    for(i=0;i<(1<<10);i++)
    for(j=0;j<n;j++){
      if(i&(1<<j))
      sum[i]+=w[j];
    }
    memset(dp,false,sizeof(dp));
    cur=0,pre=1;
    dp[cur][0][0]=true;
    for(i=0;i<m;i++){
      swap(cur,pre);
      memset(dp[cur],false,sizeof(dp[cur]));
      for(int j=0;j<ac.end;j++)
        for(k=0;k<4;k++){
          int nxt=ac.trie[j][k];
          for(t=0;t<(1<<n);t++)
          dp[cur][nxt][t|ac.tag[nxt]] |=dp[pre][j][t];
        }
    }
    int ans=-1;
    for(i=0;i<(1<<n);i++)
      for(j=0;j<ac.end;j++){
        if(dp[cur][j][i]){
          ans=max(ans,sum[i]);
        }
      }
    if(ans<0)puts("No Rabbit after 2012!");
    else cout<<ans<<endl;
  }
}
\end{lstlisting}
\subsection{kmp}
\createlinenumber{3621}{e0a5}
\createlinenumber{3622}{59b9}
\createlinenumber{3623}{8c52}
\createlinenumber{3624}{6326}
\createlinenumber{3625}{ef2f}
\createlinenumber{3626}{2349}
\createlinenumber{3627}{421c}
\createlinenumber{3628}{427e}
\createlinenumber{3629}{427e}
\createlinenumber{3630}{427e}
\createlinenumber{3631}{99b8}
\createlinenumber{3632}{4506}
\createlinenumber{3633}{c8ed}
\createlinenumber{3634}{3f1e}
\createlinenumber{3635}{427e}
\createlinenumber{3636}{27ef}
\createlinenumber{3637}{8a9f}
\createlinenumber{3638}{6a3e}
\createlinenumber{3639}{427e}
\createlinenumber{3640}{7588}
\createlinenumber{3641}{c163}
\createlinenumber{3642}{0c66}
\createlinenumber{3643}{037f}
\createlinenumber{3644}{00d5}
\createlinenumber{3645}{e0db}
\createlinenumber{3646}{a782}
\createlinenumber{3647}{95cf}
\createlinenumber{3648}{95cf}
\createlinenumber{3649}{27ef}
\createlinenumber{3650}{70fe}
\createlinenumber{3651}{bd73}
\createlinenumber{3652}{427e}
\createlinenumber{3653}{bf8b}
\createlinenumber{3654}{8241}
\createlinenumber{3655}{93ba}
\createlinenumber{3656}{037f}
\createlinenumber{3657}{00d5}
\createlinenumber{3658}{d6e6}
\createlinenumber{3659}{8df1}
\createlinenumber{3660}{95cf}
\createlinenumber{3661}{95cf}
\createlinenumber{3662}{95cf}
\createlinenumber{3663}{427e}
\createlinenumber{3664}{427e}
\createlinenumber{3665}{427e}
\createlinenumber{3666}{2ab8}
\createlinenumber{3667}{4506}
\createlinenumber{3668}{6b27}
\createlinenumber{3669}{9d06}
\createlinenumber{3670}{26de}
\createlinenumber{3671}{f044}
\createlinenumber{3672}{4506}
\createlinenumber{3673}{84ee}
\createlinenumber{3674}{4506}
\createlinenumber{3675}{b209}
\createlinenumber{3676}{f023}
\createlinenumber{3677}{95cf}
\createlinenumber{3678}{649a}
\createlinenumber{3679}{8051}
\createlinenumber{3680}{427e}
\createlinenumber{3681}{95cf}
\createlinenumber{3682}{95cf}
\begin{lstlisting}[language={}]
#include<iostream>
#include<cstdio>
#include<map>
#include<set>
#include<cstring>
#include<string>
using namespace std;

//extended kmp
//nxt[] & ext[] should be clarify out of the function
void ExtendKmp(char s[],int ls,char t[],int lt)
{
  int i,j,k;
  int Len,L;

  j=0;
  while(t[j+1]==t[j]&&j+1<lt) j++;
  nxt[1]=j,k=1;

  for(i=2;i<lt;i++){
    Len=k+nxt[k],L=nxt[i-k];
    if(Len>L+i) nxt[i]=L;
    else{
      j=Len-i>0?Len-i:0;
      while(t[i+j]==t[j]&&i+j<lt) j++;
      nxt[i]=j,k=i;
    }
  }
  j=0;
  while(s[j]==t[j]&&j<lt&&j<ls) j++;
  ext[0]=j,k=0;

  for(i=1;i<ls;i++){
    Len=k+ext[k],L=nxt[i-k];
    if(Len>L+i) ext[i]=L;
    else{
       j=Len-i>0?Len-i:0;
       while(s[i+j]==t[j]&&i+j<ls&&j<lt) j++;
       ext[i]=j,k=i;
    }
  }
}

//kmp

void get_ne(char* p,int *nex)
{
     int i=0;int j=-1;
     nex[0]=-1;
     int L=strlen(p);
     while(i<L)
     {
         if(j==-1||p[i]==p[j])
         {
           i++;j++;
           nex[i]=j;
         }
         else
           j=nex[j];
         
     }
}
\end{lstlisting}
\subsection{Palindromic}
\createlinenumber{3683}{cce1}
\createlinenumber{3684}{4506}
\createlinenumber{3685}{cc69}
\createlinenumber{3686}{ab12}
\createlinenumber{3687}{4506}
\createlinenumber{3688}{27c2}
\createlinenumber{3689}{3fb4}
\createlinenumber{3690}{649a}
\createlinenumber{3691}{0d63}
\createlinenumber{3692}{357d}
\createlinenumber{3693}{3a1f}
\createlinenumber{3694}{0eac}
\createlinenumber{3695}{5bba}
\createlinenumber{3696}{4506}
\createlinenumber{3697}{d237}
\createlinenumber{3698}{d14a}
\createlinenumber{3699}{95cf}
\createlinenumber{3700}{95cf}
\createlinenumber{3701}{95cf}
\begin{lstlisting}[language={}]
void manacher( int* r, int len, int* p )
{
  int i, id, right = 0;
  for( i = 0; i < len; ++i )
  {
    if( i < right )
      p[i] = min(p[2*id-i], right-i);
    else
      p[i] = 1;
    while( i+p[i] < len && i-p[i] >= 0 
      && r[i+p[i]] == r[i-p[i]] )
      p[i]++;
    if( p[i] + i > right )
    {
      right = p[i]+i;
      id = i;
    }
  }
}
\end{lstlisting}

\section{图论}
\subsection{Hamilton}
\createlinenumber{3702}{427e}
\createlinenumber{3703}{427e}
\createlinenumber{3704}{427e}
\createlinenumber{3705}{427e}
\createlinenumber{3706}{59b9}
\createlinenumber{3707}{ef2f}
\createlinenumber{3708}{427e}
\createlinenumber{3709}{4c18}
\createlinenumber{3710}{427e}
\createlinenumber{3711}{b7b3}
\createlinenumber{3712}{aa15}
\createlinenumber{3713}{53a5}
\createlinenumber{3714}{427e}
\createlinenumber{3715}{90a3}
\createlinenumber{3716}{4506}
\createlinenumber{3717}{e87d}
\createlinenumber{3718}{d7ae}
\createlinenumber{3719}{4506}
\createlinenumber{3720}{cb13}
\createlinenumber{3721}{9ace}
\createlinenumber{3722}{8ba6}
\createlinenumber{3723}{3c90}
\createlinenumber{3724}{95cf}
\createlinenumber{3725}{95cf}
\createlinenumber{3726}{427e}
\createlinenumber{3727}{4871}
\createlinenumber{3728}{4506}
\createlinenumber{3729}{f392}
\createlinenumber{3730}{6d29}
\createlinenumber{3731}{3fe0}
\createlinenumber{3732}{87fb}
\createlinenumber{3733}{7790}
\createlinenumber{3734}{0ba4}
\createlinenumber{3735}{5093}
\createlinenumber{3736}{6299}
\createlinenumber{3737}{ea3a}
\createlinenumber{3738}{1f75}
\createlinenumber{3739}{4506}
\createlinenumber{3740}{1f75}
\createlinenumber{3741}{4506}
\createlinenumber{3742}{7790}
\createlinenumber{3743}{44dc}
\createlinenumber{3744}{4506}
\createlinenumber{3745}{4d1d}
\createlinenumber{3746}{1080}
\createlinenumber{3747}{5093}
\createlinenumber{3748}{6173}
\createlinenumber{3749}{95cf}
\createlinenumber{3750}{882c}
\createlinenumber{3751}{95cf}
\createlinenumber{3752}{4fa4}
\createlinenumber{3753}{14dc}
\createlinenumber{3754}{8ed9}
\createlinenumber{3755}{02b3}
\createlinenumber{3756}{f770}
\createlinenumber{3757}{1f75}
\createlinenumber{3758}{4506}
\createlinenumber{3759}{7790}
\createlinenumber{3760}{44dc}
\createlinenumber{3761}{4506}
\createlinenumber{3762}{5260}
\createlinenumber{3763}{5093}
\createlinenumber{3764}{6173}
\createlinenumber{3765}{95cf}
\createlinenumber{3766}{882c}
\createlinenumber{3767}{95cf}
\createlinenumber{3768}{fd5b}
\createlinenumber{3769}{4506}
\createlinenumber{3770}{110b}
\createlinenumber{3771}{2fc4}
\createlinenumber{3772}{4fa4}
\createlinenumber{3773}{a42b}
\createlinenumber{3774}{642b}
\createlinenumber{3775}{8ed9}
\createlinenumber{3776}{95cf}
\createlinenumber{3777}{34fc}
\createlinenumber{3778}{5cf5}
\createlinenumber{3779}{4506}
\createlinenumber{3780}{ccf8}
\createlinenumber{3781}{110b}
\createlinenumber{3782}{2d6a}
\createlinenumber{3783}{2d6a}
\createlinenumber{3784}{95cf}
\createlinenumber{3785}{7dd0}
\createlinenumber{3786}{9f0e}
\createlinenumber{3787}{905e}
\createlinenumber{3788}{b398}
\createlinenumber{3789}{be20}
\createlinenumber{3790}{59bb}
\createlinenumber{3791}{95cf}
\createlinenumber{3792}{95cf}
\createlinenumber{3793}{427e}
\createlinenumber{3794}{299c}
\createlinenumber{3795}{4506}
\createlinenumber{3796}{60b7}
\createlinenumber{3797}{4506}
\createlinenumber{3798}{acaf}
\createlinenumber{3799}{e635}
\createlinenumber{3800}{3e4a}
\createlinenumber{3801}{4506}
\createlinenumber{3802}{a6b8}
\createlinenumber{3803}{69bc}
\createlinenumber{3804}{95cf}
\createlinenumber{3805}{427e}
\createlinenumber{3806}{16db}
\createlinenumber{3807}{ea0f}
\createlinenumber{3808}{8c45}
\createlinenumber{3809}{07ea}
\createlinenumber{3810}{6a10}
\createlinenumber{3811}{95cf}
\createlinenumber{3812}{7021}
\createlinenumber{3813}{95cf}
\begin{lstlisting}[language={}]
//Hamilton 回路存在条件：
// 每个点的度数超过一半点数
// 复杂度 N^3 左右
//@
#include <cstdio>
#include <cstring>

#define MN 201

int map[MN][MN];
int N,M;
int ans[MN];

void reverse( int ans[MN], int s, int t)
{
  int temp;
  while (s<t)
  {
    temp=ans[s];
    ans[s]=ans[t];
    ans[t]=temp;
    s++;t--;
  }
}

void Hamilton()
{
  int s=1,t;
  int ansi=2,i,j,w,temp;
  bool vis[MN]={false};
  memset(vis,0,sizeof vis);
  for (i=1;i<=N;i++)
    if (map[s][i]) break;
  t=i;
  vis[s]=vis[t]=1;
  ans[0]=s;ans[1]=t;
  while (1)
  {
    while (1)
    {
      for (i=1;i<=N;i++)
        if (map[t][i]&&!vis[i])
        {
          ans[ansi++]=i;
          vis[i]=1;
          t=i;
          break;
        }
      if (i>N) break;
    }
    w=ansi-1;
    i=0;
    reverse(ans,i,w);
    temp=s;
    s=t;t=temp;
    while (1)
    {
      for (i=1;i<=N;i++)
        if (map[t][i]&&!vis[i])
        {
          ans[ansi++]=i;vis[i]=1;
          t=i;
          break;
        }
      if (i>N) break;
    }
    if (!map[s][t])
    {
      for (i=1;i<ansi-2;i++)
        if (map[ans[i]][t]&&map[s][ans[i+1]]) break;
      w=ansi-1;
      i++;
      t=ans[i];
      reverse(ans,i,w);
    }
    if (ansi==N) return;
    for (j=1;j<=N;j++)
    {
      if (vis[j]) continue;
      for (i=1;i<ansi-2;i++)
        if (map[ans[i]][j]) break;
      if (map[ans[i]][j]) break;
    }
    s=ans[i-1];
    t=j;
    reverse(ans,0,i-1);
    reverse(ans,i,ansi-1);
    ans[ansi++]=j;
    vis[j]=1;
  }
}

int main()
{
  while (scanf("%d%d",&N,&M)!=EOF)
  {
    memset(map,0,sizeof map);
    int a,b;
    while (M--)
    {
      scanf("%d%d",&a,&b);
      map[a][b]=map[b][a]=1;
    }

    Hamilton();
    for (int i=0;i<N-1;i++) printf("%d ",ans[i]);
    printf("%d\n",ans[N-1]);
    for (int i=0;i<N-1;i++)
      if (!map[ans[i]][ans[(i+1)%N]]) while (1);
  }
  return 0;
}
\end{lstlisting}
\subsection{HopcraftKarp}
\createlinenumber{3814}{427e}
\createlinenumber{3815}{427e}
\createlinenumber{3816}{427e}
\createlinenumber{3817}{59b9}
\createlinenumber{3818}{ef2f}
\createlinenumber{3819}{427e}
\createlinenumber{3820}{4cbf}
\createlinenumber{3821}{0889}
\createlinenumber{3822}{427e}
\createlinenumber{3823}{427e}
\createlinenumber{3824}{673f}
\createlinenumber{3825}{4506}
\createlinenumber{3826}{28a5}
\createlinenumber{3827}{f9e1}
\createlinenumber{3828}{427e}
\createlinenumber{3829}{7c0e}
\createlinenumber{3830}{aa15}
\createlinenumber{3831}{427e}
\createlinenumber{3832}{d699}
\createlinenumber{3833}{4506}
\createlinenumber{3834}{ddad}
\createlinenumber{3835}{95cf}
\createlinenumber{3836}{427e}
\createlinenumber{3837}{88f1}
\createlinenumber{3838}{4506}
\createlinenumber{3839}{1282}
\createlinenumber{3840}{ab17}
\createlinenumber{3841}{95cf}
\createlinenumber{3842}{427e}
\createlinenumber{3843}{427e}
\createlinenumber{3844}{8a67}
\createlinenumber{3845}{427e}
\createlinenumber{3846}{8ec5}
\createlinenumber{3847}{427e}
\createlinenumber{3848}{e459}
\createlinenumber{3849}{4506}
\createlinenumber{3850}{c93c}
\createlinenumber{3851}{f25a}
\createlinenumber{3852}{1034}
\createlinenumber{3853}{c802}
\createlinenumber{3854}{a0d0}
\createlinenumber{3855}{3fd6}
\createlinenumber{3856}{aa16}
\createlinenumber{3857}{4506}
\createlinenumber{3858}{1a30}
\createlinenumber{3859}{f05c}
\createlinenumber{3860}{4506}
\createlinenumber{3861}{43a3}
\createlinenumber{3862}{dc20}
\createlinenumber{3863}{4506}
\createlinenumber{3864}{a04e}
\createlinenumber{3865}{0d23}
\createlinenumber{3866}{649a}
\createlinenumber{3867}{4506}
\createlinenumber{3868}{19cf}
\createlinenumber{3869}{a158}
\createlinenumber{3870}{95cf}
\createlinenumber{3871}{95cf}
\createlinenumber{3872}{95cf}
\createlinenumber{3873}{95cf}
\createlinenumber{3874}{01d8}
\createlinenumber{3875}{95cf}
\createlinenumber{3876}{427e}
\createlinenumber{3877}{ec04}
\createlinenumber{3878}{4506}
\createlinenumber{3879}{0470}
\createlinenumber{3880}{68e3}
\createlinenumber{3881}{4506}
\createlinenumber{3882}{1ef9}
\createlinenumber{3883}{7c7e}
\createlinenumber{3884}{4506}
\createlinenumber{3885}{f491}
\createlinenumber{3886}{e929}
\createlinenumber{3887}{7459}
\createlinenumber{3888}{95cf}
\createlinenumber{3889}{95cf}
\createlinenumber{3890}{7021}
\createlinenumber{3891}{95cf}
\createlinenumber{3892}{427e}
\createlinenumber{3893}{427e}
\createlinenumber{3894}{7b71}
\createlinenumber{3895}{427e}
\createlinenumber{3896}{7360}
\createlinenumber{3897}{f3ef}
\createlinenumber{3898}{4390}
\createlinenumber{3899}{6ab9}
\createlinenumber{3900}{4506}
\createlinenumber{3901}{3c73}
\createlinenumber{3902}{3ed3}
\createlinenumber{3903}{95cf}
\createlinenumber{3904}{53b1}
\createlinenumber{3905}{95cf}
\begin{lstlisting}[language={}]
// HK 解二分图匹配
// 复杂度 O(sqrt(N)*M)
//*@
#include <cstdio>
#include <cstring>

#define MN 50001
#define MM 150001


struct E_Node
{
  int v,ne;
} E[MM];

int R[MN],e_sz;
int N,M;

void Add( int a, int b)
{
  E[++e_sz].v=b;E[e_sz].ne=R[a];R[a]=e_sz;
}

void init()
{
  e_sz=0;
  memset(R,0,sizeof R);
}


int ans,qsz;

int Qu[MN*2],Lx[MN],Ly[MN],Cx[MN],Cy[MN];

bool BFS()
{
  int p,u,v;
  bool flag=0;
  qsz=0;
  for (int i=1;i<=N;i++)
    if (Cx[i]==-1) Qu[++qsz]=i,Lx[i]=1;
  memset(Ly,0xff,sizeof(Ly[0])*(M+1));
  for (int i=1;i<=qsz;i++)
  {
    u=Qu[i];
    for (p=R[u];p;p=E[p].ne)
    {
      v=E[p].v;
      if (Ly[v]==-1)
      {
        Ly[v]=Lx[u]+1;
        if (Cy[v]==-1) flag=1;
        else 
        {
          Qu[++qsz]=Cy[v];
          Lx[Cy[v]]=Ly[v]+1;
        }
      }
      }
  }
  return flag;
}

bool Dfs( int k)
{
  for (int p=R[k];p;p=E[p].ne)
    if (Ly[E[p].v]==Lx[k]+1)
    {
      Ly[E[p].v]=-1;
      if (Cy[E[p].v]==-1||Dfs(Cy[E[p].v]))
      {
        Cy[E[p].v]=k;
        Cx[k]=E[p].v;
        return 1;
      }
    }
  return 0;
}


      Add(a,b);
  
    ans=0;
    memset(Cx,0xff,(N+1)*sizeof(Cx[0]));
    memset(Cy,0xff,(M+1)*(sizeof(Cy[0])));
    while (BFS())
    {
      for (int i=N;i;i--)
        if (Cx[i]==-1&&Dfs(i)) ans++;
    }
    printf("%d\n",ans);
}
\end{lstlisting}
\subsection{HopcraftKarp~}
\createlinenumber{3906}{427e}
\createlinenumber{3907}{427e}
\createlinenumber{3908}{427e}
\createlinenumber{3909}{59b9}
\createlinenumber{3910}{ef2f}
\createlinenumber{3911}{427e}
\createlinenumber{3912}{4cbf}
\createlinenumber{3913}{0889}
\createlinenumber{3914}{427e}
\createlinenumber{3915}{427e}
\createlinenumber{3916}{673f}
\createlinenumber{3917}{4506}
\createlinenumber{3918}{28a5}
\createlinenumber{3919}{f9e1}
\createlinenumber{3920}{427e}
\createlinenumber{3921}{7c0e}
\createlinenumber{3922}{aa15}
\createlinenumber{3923}{427e}
\createlinenumber{3924}{d699}
\createlinenumber{3925}{4506}
\createlinenumber{3926}{ddad}
\createlinenumber{3927}{95cf}
\createlinenumber{3928}{427e}
\createlinenumber{3929}{88f1}
\createlinenumber{3930}{4506}
\createlinenumber{3931}{1282}
\createlinenumber{3932}{ab17}
\createlinenumber{3933}{95cf}
\createlinenumber{3934}{427e}
\createlinenumber{3935}{427e}
\createlinenumber{3936}{8a67}
\createlinenumber{3937}{427e}
\createlinenumber{3938}{8ec5}
\createlinenumber{3939}{427e}
\createlinenumber{3940}{e459}
\createlinenumber{3941}{4506}
\createlinenumber{3942}{c93c}
\createlinenumber{3943}{f25a}
\createlinenumber{3944}{1034}
\createlinenumber{3945}{c802}
\createlinenumber{3946}{a0d0}
\createlinenumber{3947}{3fd6}
\createlinenumber{3948}{aa16}
\createlinenumber{3949}{4506}
\createlinenumber{3950}{1a30}
\createlinenumber{3951}{f05c}
\createlinenumber{3952}{4506}
\createlinenumber{3953}{43a3}
\createlinenumber{3954}{dc20}
\createlinenumber{3955}{4506}
\createlinenumber{3956}{a04e}
\createlinenumber{3957}{0d23}
\createlinenumber{3958}{649a}
\createlinenumber{3959}{4506}
\createlinenumber{3960}{19cf}
\createlinenumber{3961}{a158}
\createlinenumber{3962}{95cf}
\createlinenumber{3963}{95cf}
\createlinenumber{3964}{95cf}
\createlinenumber{3965}{95cf}
\createlinenumber{3966}{01d8}
\createlinenumber{3967}{95cf}
\createlinenumber{3968}{427e}
\createlinenumber{3969}{ec04}
\createlinenumber{3970}{4506}
\createlinenumber{3971}{0470}
\createlinenumber{3972}{68e3}
\createlinenumber{3973}{4506}
\createlinenumber{3974}{1ef9}
\createlinenumber{3975}{7c7e}
\createlinenumber{3976}{4506}
\createlinenumber{3977}{f491}
\createlinenumber{3978}{e929}
\createlinenumber{3979}{7459}
\createlinenumber{3980}{95cf}
\createlinenumber{3981}{95cf}
\createlinenumber{3982}{7021}
\createlinenumber{3983}{95cf}
\createlinenumber{3984}{427e}
\createlinenumber{3985}{427e}
\createlinenumber{3986}{7b71}
\createlinenumber{3987}{427e}
\createlinenumber{3988}{7360}
\createlinenumber{3989}{f3ef}
\createlinenumber{3990}{4390}
\createlinenumber{3991}{6ab9}
\createlinenumber{3992}{4506}
\createlinenumber{3993}{3c73}
\createlinenumber{3994}{3ed3}
\createlinenumber{3995}{95cf}
\createlinenumber{3996}{53b1}
\createlinenumber{3997}{95cf}
\begin{lstlisting}[language={}]
// HK 解二分图匹配
//复杂度 O(sqrt(N)*M)
//*@
#include <cstdio>
#include <cstring>

#define MN 50001
#define MM 150001


struct E_Node
{
  int v,ne;
} E[MM];

int R[MN],e_sz;
int N,M;

void Add( int a, int b)
{
  E[++e_sz].v=b;E[e_sz].ne=R[a];R[a]=e_sz;
}

void init()
{
  e_sz=0;
  memset(R,0,sizeof R);
}


int ans,qsz;

int Qu[MN*2],Lx[MN],Ly[MN],Cx[MN],Cy[MN];

bool BFS()
{
  int p,u,v;
  bool flag=0;
  qsz=0;
  for (int i=1;i<=N;i++)
    if (Cx[i]==-1) Qu[++qsz]=i,Lx[i]=1;
  memset(Ly,0xff,sizeof(Ly[0])*(M+1));
  for (int i=1;i<=qsz;i++)
  {
    u=Qu[i];
    for (p=R[u];p;p=E[p].ne)
    {
      v=E[p].v;
      if (Ly[v]==-1)
      {
        Ly[v]=Lx[u]+1;
        if (Cy[v]==-1) flag=1;
        else 
        {
          Qu[++qsz]=Cy[v];
          Lx[Cy[v]]=Ly[v]+1;
        }
      }
      }
  }
  return flag;
}

bool Dfs( int k)
{
  for (int p=R[k];p;p=E[p].ne)
    if (Ly[E[p].v]==Lx[k]+1)
    {
      Ly[E[p].v]=-1;
      if (Cy[E[p].v]==-1||Dfs(Cy[E[p].v]))
      {
        Cy[E[p].v]=k;
        Cx[k]=E[p].v;
        return 1;
      }
    }
  return 0;
}


      Add(a,b);
  
    ans=0;
    memset(Cx,0xff,(N+1)*sizeof(Cx[0]));
    memset(Cy,0xff,(M+1)*(sizeof(Cy[0])));
    while (BFS())
    {
      for (int i=N;i;i--)
        if (Cx[i]==-1&&Dfs(i)) ans++;
    }
    printf("%d\n",ans);
}
\end{lstlisting}
\subsection{Hungary}
\createlinenumber{3998}{427e}
\createlinenumber{3999}{427e}
\createlinenumber{4000}{427e}
\createlinenumber{4001}{e219}
\createlinenumber{4002}{bf70}
\createlinenumber{4003}{2a22}
\createlinenumber{4004}{2fd8}
\createlinenumber{4005}{427e}
\createlinenumber{4006}{b96a}
\createlinenumber{4007}{4506}
\createlinenumber{4008}{0470}
\createlinenumber{4009}{4d33}
\createlinenumber{4010}{4506}
\createlinenumber{4011}{39cb}
\createlinenumber{4012}{6bbc}
\createlinenumber{4013}{f267}
\createlinenumber{4014}{4506}
\createlinenumber{4015}{17ae}
\createlinenumber{4016}{3361}
\createlinenumber{4017}{95cf}
\createlinenumber{4018}{fc61}
\createlinenumber{4019}{4506}
\createlinenumber{4020}{17ae}
\createlinenumber{4021}{3361}
\createlinenumber{4022}{95cf}
\createlinenumber{4023}{95cf}
\createlinenumber{4024}{438e}
\createlinenumber{4025}{95cf}
\createlinenumber{4026}{427e}
\createlinenumber{4027}{f531}
\createlinenumber{4028}{c802}
\createlinenumber{4029}{4506}
\createlinenumber{4030}{73c9}
\createlinenumber{4031}{c926}
\createlinenumber{4032}{19e8}
\createlinenumber{4033}{8f54}
\createlinenumber{4034}{95cf}
\begin{lstlisting}[language={}]
// 匈牙利算法解二分图匹配
// 一般小于 NM
//*@
bool Vis[MN];
int Link[MN];
int Cache[MN];
int Csz;

bool find( int k)
{
  for (int p=R[k];p;p=E[p].ne)
    if (!Vis[E[p].v])
    {
      Vis[E[p].v]=1;
      Cache[++Csz]=E[p].v;
      if (!Link[E[p].v])
      {
        Link[E[p].v]=k;
        return true;  
      }
      if (find(Link[E[p].v]))
      {
        Link[E[p].v]=k;
        return true;
      }
    }
  return false;
}

    memset(Link,0,sizeof Link);
    for (int i=1;i<=N;i++)
    {
      for (int k=1;k<=Csz;k++)
        Vis[Cache[k]]=0;
        Csz=0;
        if (find(cc(i,j))) ans++;
    }
\end{lstlisting}
\subsection{KM}
\createlinenumber{4035}{427e}
\createlinenumber{4036}{427e}
\createlinenumber{4037}{427e}
\createlinenumber{4038}{427e}
\createlinenumber{4039}{427e}
\createlinenumber{4040}{427e}
\createlinenumber{4041}{59b9}
\createlinenumber{4042}{ef2f}
\createlinenumber{4043}{427e}
\createlinenumber{4044}{1d4b}
\createlinenumber{4045}{1cc6}
\createlinenumber{4046}{427e}
\createlinenumber{4047}{d7e9}
\createlinenumber{4048}{5897}
\createlinenumber{4049}{d96c}
\createlinenumber{4050}{9859}
\createlinenumber{4051}{9012}
\createlinenumber{4052}{d7af}
\createlinenumber{4053}{6097}
\createlinenumber{4054}{4506}
\createlinenumber{4055}{28d0}
\createlinenumber{4056}{5647}
\createlinenumber{4057}{4506}
\createlinenumber{4058}{aab6}
\createlinenumber{4059}{b333}
\createlinenumber{4060}{44b7}
\createlinenumber{4061}{d790}
\createlinenumber{4062}{4506}
\createlinenumber{4063}{d2aa}
\createlinenumber{4064}{6def}
\createlinenumber{4065}{4506}
\createlinenumber{4066}{b930}
\createlinenumber{4067}{3361}
\createlinenumber{4068}{95cf}
\createlinenumber{4069}{95cf}
\createlinenumber{4070}{cf8b}
\createlinenumber{4071}{52e5}
\createlinenumber{4072}{95cf}
\createlinenumber{4073}{438e}
\createlinenumber{4074}{95cf}
\createlinenumber{4075}{427e}
\createlinenumber{4076}{45ef}
\createlinenumber{4077}{4506}
\createlinenumber{4078}{576f}
\createlinenumber{4079}{427e}
\createlinenumber{4080}{76e3}
\createlinenumber{4081}{b7b2}
\createlinenumber{4082}{7790}
\createlinenumber{4083}{4506}
\createlinenumber{4084}{7b3c}
\createlinenumber{4085}{5cf5}
\createlinenumber{4086}{7f0c}
\createlinenumber{4087}{c66c}
\createlinenumber{4088}{95cf}
\createlinenumber{4089}{427e}
\createlinenumber{4090}{67de}
\createlinenumber{4091}{4506}
\createlinenumber{4092}{7790}
\createlinenumber{4093}{a6e7}
\createlinenumber{4094}{66e0}
\createlinenumber{4095}{4506}
\createlinenumber{4096}{e77f}
\createlinenumber{4097}{688c}
\createlinenumber{4098}{3333}
\createlinenumber{4099}{6173}
\createlinenumber{4100}{065a}
\createlinenumber{4101}{7790}
\createlinenumber{4102}{4506}
\createlinenumber{4103}{df80}
\createlinenumber{4104}{bae8}
\createlinenumber{4105}{95cf}
\createlinenumber{4106}{7790}
\createlinenumber{4107}{4506}
\createlinenumber{4108}{f248}
\createlinenumber{4109}{529c}
\createlinenumber{4110}{95cf}
\createlinenumber{4111}{7790}
\createlinenumber{4112}{4506}
\createlinenumber{4113}{4427}
\createlinenumber{4114}{ab77}
\createlinenumber{4115}{649a}
\createlinenumber{4116}{a397}
\createlinenumber{4117}{95cf}
\createlinenumber{4118}{95cf}
\createlinenumber{4119}{95cf}
\createlinenumber{4120}{bf72}
\createlinenumber{4121}{7790}
\createlinenumber{4122}{f7d9}
\createlinenumber{4123}{a453}
\createlinenumber{4124}{56b0}
\createlinenumber{4125}{95cf}
\createlinenumber{4126}{427e}
\createlinenumber{4127}{299c}
\createlinenumber{4128}{4506}
\createlinenumber{4129}{3dda}
\createlinenumber{4130}{4506}
\createlinenumber{4131}{39be}
\createlinenumber{4132}{c802}
\createlinenumber{4133}{f595}
\createlinenumber{4134}{05c2}
\createlinenumber{4135}{95cf}
\createlinenumber{4136}{95cf}
\begin{lstlisting}[language={}]
//KM
// 二分图最佳匹配
// 点数不等时添加虚拟点，与所有点的边权为 0
// 点数不等时不能将边权变负，要用 INF 去减
//N^3

#include <cstdio>
#include <cstring>

#define MN 301
#define INF 0x7fffffff

int w[MN][MN];
int lx[MN],ly[MN]; 
int linky[MN];
int visx[MN],visy[MN];
int slack[MN];
int N;
bool find(int x)
{
  visx[x] = true;
  for(int y = 1; y <=N; y++)
  {
    if(visy[y])
      continue;
    int t = lx[x] + ly[y] - w[x][y];
    if(t==0)
    {
      visy[y] = true;
      if(linky[y]==-1 || find(linky[y]))
      {
        linky[y] = x;
        return true;    
      }
    }
    else if(slack[y] > t)
      slack[y] = t;
  }
  return false;        
}

int KM()        
{
  int i,j;

  memset(linky,-1,sizeof(linky));
  memset(ly,0,sizeof(ly));
  for(i = 1; i <=N; i++)
  {
    lx[i] = -INF;
     for(j = 1; j <=N; j++)
      if(w[i][j] > lx[i])
        lx[i] = w[i][j];
  }

  for(int x = 1; x <=N; x++)
  {
    for(i = 1; i <=N; i++)
      slack[i] = INF;
    while(true)
    {
      memset(visx,0,sizeof(visx));
      memset(visy,0,sizeof(visy));
      if(find(x))
        break;
      int d = INF;
      for(i = 1; i <=N; i++)   
      {
        if(!visy[i] && d > slack[i])
          d = slack[i];
      }
      for(i = 1; i <=N; i++)
      {
        if(visx[i])
          lx[i] -= d;
      }
      for(i = 1; i <=N; i++)
      {
        if(visy[i])
           ly[i] += d;
        else
          slack[i] -= d;
      }
    }
  }
  int result = 0;
  for(i = 1; i <=N; i++)
  if(linky[i]>-1)
    result += w[linky[i]][i];
  return result;
}

int main()
{
  while (scanf("%d",&N)!=EOF)
  {
    memset(w,0,sizeof w);
    for (int i=1;i<=N;i++)
      for (int j=1;j<=N;j++) scanf("%d",&w[i][j]);
    printf("%d\n",KM());
  }
}
\end{lstlisting}
\subsection{lca}
\createlinenumber{4137}{427e}
\createlinenumber{4138}{427e}
\createlinenumber{4139}{427e}
\createlinenumber{4140}{427e}
\createlinenumber{4141}{727b}
\createlinenumber{4142}{0ae7}
\createlinenumber{4143}{79ea}
\createlinenumber{4144}{4506}
\createlinenumber{4145}{0b49}
\createlinenumber{4146}{0470}
\createlinenumber{4147}{4506}
\createlinenumber{4148}{f90d}
\createlinenumber{4149}{b082}
\createlinenumber{4150}{95cf}
\createlinenumber{4151}{95cf}
\createlinenumber{4152}{427e}
\createlinenumber{4153}{427e}
\createlinenumber{4154}{1b95}
\createlinenumber{4155}{4506}
\createlinenumber{4156}{5750}
\createlinenumber{4157}{91c5}
\createlinenumber{4158}{c802}
\createlinenumber{4159}{014c}
\createlinenumber{4160}{427e}
\createlinenumber{4161}{4a2e}
\createlinenumber{4162}{c802}
\createlinenumber{4163}{98fc}
\createlinenumber{4164}{95cf}
\createlinenumber{4165}{427e}
\createlinenumber{4166}{427e}
\createlinenumber{4167}{427e}
\createlinenumber{4168}{82b0}
\createlinenumber{4169}{4506}
\createlinenumber{4170}{bb4f}
\createlinenumber{4171}{5801}
\createlinenumber{4172}{686e}
\createlinenumber{4173}{6371}
\createlinenumber{4174}{798a}
\createlinenumber{4175}{686e}
\createlinenumber{4176}{7b0a}
\createlinenumber{4177}{b01a}
\createlinenumber{4178}{95cf}
\begin{lstlisting}[language={}]
// 建树和倍增求 lca

  //buildtree

  int dep[MN],root[MN];
  int ancestor[MN][logMN];
  void buildtree( int k)
  {
    vis[k]=1;
    for (int p=R[k];p;p=E[p].ne)
    {
      if (vis[E[p].v]) continue;
      ancestor[E[p].v][0]=k,dep[E[p].v]=dep[k]+1,root[E[p].v]=root[k],buildtree(E[p].v);
    }
  }
  //lca_init
  // 可以处理森林
  void lca_init( int N)
  {
    memset(ancestor,0,sizeof ancestor);
    for (int i=1;i<=N;i++) vis[i]=0;
    for (int i=1;i<=N;i++)
      if (ancestor[i][0]==0) dep[i]=1,root[i]=i,buildtree(i);

    for (int k=1;k<=log2(N);k++)
      for (int i=1;i<=N;i++)
        ancestor[i][k]=ancestor[ancestor[i][k-1]][k-1];
  }

  //return lca(a,b)
  //return -1 if a,b in diffirent tree
  int lca_query( int a, int b, int N)
  {
    int ans=dep[a]+dep[b];
    if (root[a]!=root[b]) return -1;
    if (a==b) return a;
    if (dep[a]>dep[b]) swap(a,b);
    for (int k=0;k<=log2(N);k++) if ((1<<k)&delta) b=ancestor[b][k];
    if (a==b) return a;
    for (int k=log2(N);k>=0;k--) if (ancestor[a][k]!=ancestor[b][k]) a=ancestor[a][k],b=ancestor[b][k];
    return ancestor[a][0];
  }
\end{lstlisting}
\subsection{MaxcostMaxflow}
\createlinenumber{4179}{427e}
\createlinenumber{4180}{427e}
\createlinenumber{4181}{59b9}
\createlinenumber{4182}{ef2f}
\createlinenumber{4183}{acb9}
\createlinenumber{4184}{427e}
\createlinenumber{4185}{421c}
\createlinenumber{4186}{427e}
\createlinenumber{4187}{e8b6}
\createlinenumber{4188}{8c3b}
\createlinenumber{4189}{1cc6}
\createlinenumber{4190}{427e}
\createlinenumber{4191}{aa81}
\createlinenumber{4192}{cb35}
\createlinenumber{4193}{427e}
\createlinenumber{4194}{0c77}
\createlinenumber{4195}{4506}
\createlinenumber{4196}{673f}
\createlinenumber{4197}{4506}
\createlinenumber{4198}{8253}
\createlinenumber{4199}{f9e1}
\createlinenumber{4200}{5586}
\createlinenumber{4201}{9bfc}
\createlinenumber{4202}{cb15}
\createlinenumber{4203}{4506}
\createlinenumber{4204}{233c}
\createlinenumber{4205}{95cf}
\createlinenumber{4206}{d3c6}
\createlinenumber{4207}{4506}
\createlinenumber{4208}{4238}
\createlinenumber{4209}{18b4}
\createlinenumber{4210}{11e8}
\createlinenumber{4211}{95cf}
\createlinenumber{4212}{7d24}
\createlinenumber{4213}{0e46}
\createlinenumber{4214}{3d1d}
\createlinenumber{4215}{88f1}
\createlinenumber{4216}{4506}
\createlinenumber{4217}{1bb9}
\createlinenumber{4218}{ab17}
\createlinenumber{4219}{1fd4}
\createlinenumber{4220}{95cf}
\createlinenumber{4221}{aafa}
\createlinenumber{4222}{64de}
\createlinenumber{4223}{4506}
\createlinenumber{4224}{3ccf}
\createlinenumber{4225}{a058}
\createlinenumber{4226}{e753}
\createlinenumber{4227}{5480}
\createlinenumber{4228}{eb5f}
\createlinenumber{4229}{1b18}
\createlinenumber{4230}{4506}
\createlinenumber{4231}{50ae}
\createlinenumber{4232}{f2f8}
\createlinenumber{4233}{f05c}
\createlinenumber{4234}{94ec}
\createlinenumber{4235}{4506}
\createlinenumber{4236}{32ff}
\createlinenumber{4237}{6c54}
\createlinenumber{4238}{d185}
\createlinenumber{4239}{4506}
\createlinenumber{4240}{fa94}
\createlinenumber{4241}{bae3}
\createlinenumber{4242}{4506}
\createlinenumber{4243}{8b65}
\createlinenumber{4244}{99c8}
\createlinenumber{4245}{887e}
\createlinenumber{4246}{95cf}
\createlinenumber{4247}{95cf}
\createlinenumber{4248}{fa2d}
\createlinenumber{4249}{95cf}
\createlinenumber{4250}{d2b6}
\createlinenumber{4251}{649a}
\createlinenumber{4252}{4506}
\createlinenumber{4253}{c088}
\createlinenumber{4254}{870d}
\createlinenumber{4255}{4506}
\createlinenumber{4256}{f593}
\createlinenumber{4257}{ace4}
\createlinenumber{4258}{95cf}
\createlinenumber{4259}{d1e9}
\createlinenumber{4260}{8902}
\createlinenumber{4261}{3aaf}
\createlinenumber{4262}{870d}
\createlinenumber{4263}{4506}
\createlinenumber{4264}{4712}
\createlinenumber{4265}{d9c0}
\createlinenumber{4266}{ace4}
\createlinenumber{4267}{95cf}
\createlinenumber{4268}{7459}
\createlinenumber{4269}{95cf}
\createlinenumber{4270}{95cf}
\createlinenumber{4271}{ff9a}
\createlinenumber{4272}{87e7}
\createlinenumber{4273}{664a}
\createlinenumber{4274}{69b7}
\createlinenumber{4275}{20d3}
\createlinenumber{4276}{6bcf}
\createlinenumber{4277}{9418}
\createlinenumber{4278}{f2b5}
\begin{lstlisting}[language={}]
// 最小费用路增广 bySPFA
//*@
#include <cstdio>
#include <cstring>
#include <queue>

using namespace std;

#define MN 30
#define MM 100000
#define INF 0x7fffffff

int T,N,M,K;
int Lim[MN],Like[MN][MN],l,cases;

struct MaxcostMaxflow
{
  struct E_Node
  {
    int v,f,c,op,ne;
  } E[MM];
  int R[MN],sz;
  int S,T;
  void Add( int a, int b, int c, int d)
  {
    E[++sz].v=b;E[sz].ne=R[a];R[a]=sz;E[sz].f=c;E[sz].c=d;
  }
  void Ins( int a, int b, int c, int d)
  {
    if (!c) return ;
    Add(a,b,c,d);E[sz].op=sz+1;
    Add(b,a,0,-d);E[sz].op=sz-1;
  }
  bool B[MN];
  int D[MN],F[MN];
  int maxcost,maxflow;
  void init()
  {
    sz=0;
    memset(R,0,sizeof R);
    maxcost=maxflow=0;
  }
  queue<int> Q;
  bool SPFA()
  {
    int u,m,p;
    while (!Q.empty()) Q.pop();
    Q.push(S);
    for (int i=1;i<=T;i++) D[i]=-INF,B[i]=0;
    D[S]=0;B[S]=1;
    while (!Q.empty())
    {
      u=Q.front();
      Q.pop();
      for (p=R[u];p;p=E[p].ne)
        if (E[p].f&&D[u]+E[p].c>D[E[p].v])
        {
          D[E[p].v]=D[u]+E[p].c;
          F[E[p].v]=p;
          if (!B[E[p].v])
          {
            B[E[p].v]=1;
            if (!Q.empty()&&D[Q.front()]<D[E[p].v])
            {
              Q.push(Q.front());
              Q.front()=E[p].v;
            } else Q.push(E[p].v);
          }
        }
      B[u]=0;
    }
    if (D[T]==-INF) return 0;
    else 
    {
      u=T;m=INF;
      while (u!=S)
      {
        m=min(m,E[F[u]].f);
        u=E[E[F[u]].op].v;
      }
      maxflow+=m;
      maxcost+=m*D[T];
      u=T;
      while (u!=S)
      {
        E[F[u]].f-=m;
        E[E[F[u]].op].f+=m;
        u=E[E[F[u]].op].v;
      }
      return 1;
    }
  }
} G;
/*
    G.S=N+M+1;G.T=G.S+1;
    for (int j=1;j<=M;j++) G.Ins(N+j,G.T,1,0);
    while (G.SPFA());
    if (G.maxcost+M-G.maxflow>=l) puts("YES");
    else puts("NO");
*/
\end{lstlisting}
\subsection{NetworkFlow}
\createlinenumber{4279}{427e}
\createlinenumber{4280}{427e}
\createlinenumber{4281}{427e}
\createlinenumber{4282}{ef2f}
\createlinenumber{4283}{45b5}
\createlinenumber{4284}{8c3b}
\createlinenumber{4285}{427e}
\createlinenumber{4286}{673f}
\createlinenumber{4287}{4506}
\createlinenumber{4288}{6221}
\createlinenumber{4289}{e53b}
\createlinenumber{4290}{f9e1}
\createlinenumber{4291}{427e}
\createlinenumber{4292}{7c0e}
\createlinenumber{4293}{427e}
\createlinenumber{4294}{427e}
\createlinenumber{4295}{427e}
\createlinenumber{4296}{a035}
\createlinenumber{4297}{99ad}
\createlinenumber{4298}{f95b}
\createlinenumber{4299}{427e}
\createlinenumber{4300}{427e}
\createlinenumber{4301}{df6b}
\createlinenumber{4302}{f90e}
\createlinenumber{4303}{4b4a}
\createlinenumber{4304}{427e}
\createlinenumber{4305}{88f1}
\createlinenumber{4306}{4506}
\createlinenumber{4307}{ab17}
\createlinenumber{4308}{1282}
\createlinenumber{4309}{7360}
\createlinenumber{4310}{95cf}
\createlinenumber{4311}{427e}
\createlinenumber{4312}{0a45}
\createlinenumber{4313}{5242}
\createlinenumber{4314}{ae1c}
\createlinenumber{4315}{95cf}
\createlinenumber{4316}{427e}
\createlinenumber{4317}{e9ba}
\createlinenumber{4318}{00d3}
\createlinenumber{4319}{c75f}
\createlinenumber{4320}{131a}
\createlinenumber{4321}{f992}
\createlinenumber{4322}{95cf}
\createlinenumber{4323}{427e}
\createlinenumber{4324}{6193}
\createlinenumber{4325}{ad27}
\createlinenumber{4326}{33f5}
\createlinenumber{4327}{879c}
\createlinenumber{4328}{a7f5}
\createlinenumber{4329}{e2aa}
\createlinenumber{4330}{837d}
\createlinenumber{4331}{ca1d}
\createlinenumber{4332}{713f}
\createlinenumber{4333}{3c1d}
\createlinenumber{4334}{95cf}
\createlinenumber{4335}{9296}
\createlinenumber{4336}{95cf}
\createlinenumber{4337}{e010}
\createlinenumber{4338}{95cf}
\createlinenumber{4339}{427e}
\createlinenumber{4340}{8cef}
\createlinenumber{4341}{5dd6}
\createlinenumber{4342}{eb8e}
\createlinenumber{4343}{fb9d}
\createlinenumber{4344}{9a8b}
\createlinenumber{4345}{6a1b}
\createlinenumber{4346}{7441}
\createlinenumber{4347}{95cf}
\createlinenumber{4348}{c66b}
\createlinenumber{4349}{9eb5}
\createlinenumber{4350}{b362}
\createlinenumber{4351}{95cf}
\createlinenumber{4352}{2294}
\createlinenumber{4353}{9407}
\createlinenumber{4354}{95cf}
\createlinenumber{4355}{427e}
\createlinenumber{4356}{9690}
\createlinenumber{4357}{2f55}
\createlinenumber{4358}{a591}
\createlinenumber{4359}{10a0}
\createlinenumber{4360}{d9aa}
\createlinenumber{4361}{55e4}
\createlinenumber{4362}{0cc3}
\createlinenumber{4363}{ac2c}
\createlinenumber{4364}{3605}
\createlinenumber{4365}{454a}
\createlinenumber{4366}{b333}
\createlinenumber{4367}{95cf}
\createlinenumber{4368}{607d}
\createlinenumber{4369}{c70d}
\createlinenumber{4370}{649a}
\createlinenumber{4371}{27e8}
\createlinenumber{4372}{3b7e}
\createlinenumber{4373}{9933}
\createlinenumber{4374}{4eeb}
\createlinenumber{4375}{b97a}
\createlinenumber{4376}{5fad}
\createlinenumber{4377}{6aed}
\createlinenumber{4378}{69dc}
\createlinenumber{4379}{6173}
\createlinenumber{4380}{95cf}
\createlinenumber{4381}{d954}
\createlinenumber{4382}{cdee}
\createlinenumber{4383}{e9a7}
\createlinenumber{4384}{95cf}
\createlinenumber{4385}{95cf}
\createlinenumber{4386}{427e}
\createlinenumber{4387}{427e}
\createlinenumber{4388}{427e}
\createlinenumber{4389}{427e}
\begin{lstlisting}[language={}]
//Dinic
// 当前弧、多路增广、断层优化
//*@
#include <cstring>
#define MN 1000
#define MM 100000

struct E_Node
{
  int a,b,opp,ne;
  int f;
} E[MM];

int R[MN],e_sz;



struct s_node{
  int v,p;
} s[MN];


int top,N,M,S,T,ans;
int Q[MN],L[MN];
bool hash[MN];

void init()
{
  memset(R,0,sizeof R);
  e_sz=0;
  ans=0;
}

void add( int a, int b, int c){
  E[++e_sz].a=a;E[e_sz].b=b;E[e_sz].f=c;
  E[e_sz].ne=R[a];R[a]=e_sz;
}

void ins( int a, int b, int c){
  add(a,b,c);
  E[e_sz].opp=e_sz+1;
  add(b,a,0);
  E[e_sz].opp=e_sz-1;
}

int BFS(){
  int h,t,p;
  memset(L,0,sizeof(L));
  Q[h=t=1]=S;
  L[S]=1;
  for (;h<=t;h++){
    for (p=R[Q[h]];p;p=E[p].ne)
      if (E[p].f&&(!L[E[p].b])){
        L[E[p].b]=L[Q[h]]+1;
        Q[++t]=E[p].b;
      }
    if (L[T]) return L[T];
  }
  return L[T];
}

int augmented(){
  int min=0x7fffffff;
  int mins;
  for (int i=1;i<top;i++)
    if (E[s[i].p].f<min){
      min=E[s[i].p].f;
      mins=i;
    }
  for (int i=1;i<top;i++){
    E[s[i].p].f-=min;
    E[E[s[i].p].opp].f+=min;
  }
  ans+=min;
  return mins;
}

void Dinic(){
  bool f;
  int *p,*v;
  s[top=1].v=S;s[1].p=0;
  memset(hash,true,sizeof(hash));
  while (top){
    v=&s[top].v;
    p=&s[top].p;
    if (*v==T){
      top=augmented();
      continue;
    }
    if (*p)
      *p=E[*p].ne;
    else
      *p=R[*v];
    f=false;
    for (;*p;*p=E[*p].ne)
      if (hash[E[*p].b]&&E[*p].f&&L[*v]+1==L[E[*p].b]){
        s[++top].v=E[*p].b;
        s[top].p=0;
        top++;
        f=true;
        break;
      }
    if (!f)
      hash[s[top].v]=false;
    top--;
  }
}

//init();
//ins(a,b,c);
//while (BFS()) Dinic();
\end{lstlisting}
\subsection{SCC}
\createlinenumber{4390}{427e}
\createlinenumber{4391}{427e}
\createlinenumber{4392}{427e}
\createlinenumber{4393}{59b9}
\createlinenumber{4394}{ef2f}
\createlinenumber{4395}{8207}
\createlinenumber{4396}{54ff}
\createlinenumber{4397}{427e}
\createlinenumber{4398}{421c}
\createlinenumber{4399}{427e}
\createlinenumber{4400}{ab66}
\createlinenumber{4401}{b120}
\createlinenumber{4402}{427e}
\createlinenumber{4403}{fbb8}
\createlinenumber{4404}{427e}
\createlinenumber{4405}{0c98}
\createlinenumber{4406}{4506}
\createlinenumber{4407}{a981}
\createlinenumber{4408}{28a5}
\createlinenumber{4409}{f9e1}
\createlinenumber{4410}{5586}
\createlinenumber{4411}{0d5d}
\createlinenumber{4412}{1352}
\createlinenumber{4413}{95cf}
\createlinenumber{4414}{870e}
\createlinenumber{4415}{7d24}
\createlinenumber{4416}{b156}
\createlinenumber{4417}{85a3}
\createlinenumber{4418}{9372}
\createlinenumber{4419}{0c3d}
\createlinenumber{4420}{d651}
\createlinenumber{4421}{0470}
\createlinenumber{4422}{2f4c}
\createlinenumber{4423}{8ee9}
\createlinenumber{4424}{35b1}
\createlinenumber{4425}{3b67}
\createlinenumber{4426}{9c48}
\createlinenumber{4427}{a69f}
\createlinenumber{4428}{a4a8}
\createlinenumber{4429}{1894}
\createlinenumber{4430}{c9fd}
\createlinenumber{4431}{1039}
\createlinenumber{4432}{9f0e}
\createlinenumber{4433}{14a1}
\createlinenumber{4434}{95cf}
\createlinenumber{4435}{95cf}
\createlinenumber{4436}{6e8b}
\createlinenumber{4437}{4506}
\createlinenumber{4438}{2776}
\createlinenumber{4439}{c802}
\createlinenumber{4440}{8220}
\createlinenumber{4441}{83af}
\createlinenumber{4442}{95cf}
\createlinenumber{4443}{7a60}
\createlinenumber{4444}{c802}
\createlinenumber{4445}{25b5}
\createlinenumber{4446}{95cf}
\createlinenumber{4447}{88f1}
\createlinenumber{4448}{4506}
\createlinenumber{4449}{80a6}
\createlinenumber{4450}{1bb9}
\createlinenumber{4451}{a31c}
\createlinenumber{4452}{ab17}
\createlinenumber{4453}{d799}
\createlinenumber{4454}{e11b}
\createlinenumber{4455}{95cf}
\createlinenumber{4456}{ff9a}
\createlinenumber{4457}{427e}
\createlinenumber{4458}{427e}
\createlinenumber{4459}{427e}
\createlinenumber{4460}{427e}
\begin{lstlisting}[language={}]
//SCC by Tarjan
// nowc 连通分量个数
//*@
#include<cstdio>
#include<cstring>
#include<stack>
#include<algorithm>
 
using namespace std;

#define MN 20001
#define MM 50001

int N,M,T;

struct Graph
{
  struct E_Node{
    int v,ne;
  } E[MM];
  int R[MN],sz;
  void Add( int a, int b){
    E[++sz].v=b;E[sz].ne=R[a];R[a]=sz;
  }
  stack<int> S;
  bool B[MN];
  int D[MN],L[MN],C[MN],SZ[MN];
  int nowc,nowd;
  void Dfs( int k){
    D[k]=L[k]=++nowd;
    B[k]=1;S.push(k);
    for (int p=R[k];p;p=E[p].ne)
      if (B[E[p].v]) L[k]=min(L[k],D[E[p].v]);
      else if (!D[E[p].v]) Dfs(E[p].v),L[k]=min(L[k],L[E[p].v]);
    if (D[k]==L[k]){
      int v;
      nowc++;
      do{
        v=S.top();
        B[v]=0;
        SZ[nowc]++;
        S.pop();
        C[v]=nowc;
      }while(v!=k);
    }
  }
  void Rebuild( Graph &GG)
  {
    GG.init();
    for (int i=1;i<=N;i++)
      for (int p=R[i];p;p=E[p].ne)
        if (C[E[p].v]!=C[i]) GG.Add(C[i],C[E[p].v]);
  }
  void SCC(){
    for (int i=1;i<=N;i++)
      if (!D[i]) Dfs(i);
  }
  void init()
  {
    nowc=nowd=0;
    sz=0;
    memset(B,0,sizeof B);
    memset(R,0,sizeof R);
    memset(D,0,sizeof D);
    memset(SZ,0,sizeof SZ);
  }
} G;

//G.init();
//G.SCC();
//G.Rebuild(GG);
\end{lstlisting}
\subsection{Vconnect}
\createlinenumber{4461}{59b9}
\createlinenumber{4462}{ef2f}
\createlinenumber{4463}{54ff}
\createlinenumber{4464}{6326}
\createlinenumber{4465}{09f7}
\createlinenumber{4466}{8207}
\createlinenumber{4467}{c928}
\createlinenumber{4468}{427e}
\createlinenumber{4469}{421c}
\createlinenumber{4470}{427e}
\createlinenumber{4471}{6c7d}
\createlinenumber{4472}{3c56}
\createlinenumber{4473}{5eec}
\createlinenumber{4474}{682b}
\createlinenumber{4475}{427e}
\createlinenumber{4476}{aa15}
\createlinenumber{4477}{427e}
\createlinenumber{4478}{0c98}
\createlinenumber{4479}{4506}
\createlinenumber{4480}{673f}
\createlinenumber{4481}{4506}
\createlinenumber{4482}{a15a}
\createlinenumber{4483}{f9e1}
\createlinenumber{4484}{427e}
\createlinenumber{4485}{7c0e}
\createlinenumber{4486}{427e}
\createlinenumber{4487}{427e}
\createlinenumber{4488}{c5de}
\createlinenumber{4489}{4506}
\createlinenumber{4490}{e53f}
\createlinenumber{4491}{98b5}
\createlinenumber{4492}{95cf}
\createlinenumber{4493}{427e}
\createlinenumber{4494}{4c87}
\createlinenumber{4495}{80ca}
\createlinenumber{4496}{427e}
\createlinenumber{4497}{88f1}
\createlinenumber{4498}{4506}
\createlinenumber{4499}{1282}
\createlinenumber{4500}{ab17}
\createlinenumber{4501}{427e}
\createlinenumber{4502}{427e}
\createlinenumber{4503}{95cf}
\createlinenumber{4504}{427e}
\createlinenumber{4505}{427e}
\createlinenumber{4506}{427e}
\createlinenumber{4507}{427e}
\createlinenumber{4508}{427e}
\createlinenumber{4509}{427e}
\createlinenumber{4510}{060e}
\createlinenumber{4511}{427e}
\createlinenumber{4512}{6e8b}
\createlinenumber{4513}{4506}
\createlinenumber{4514}{2776}
\createlinenumber{4515}{f4f9}
\createlinenumber{4516}{c802}
\createlinenumber{4517}{4506}
\createlinenumber{4518}{9f92}
\createlinenumber{4519}{4506}
\createlinenumber{4520}{79b7}
\createlinenumber{4521}{8220}
\createlinenumber{4522}{2975}
\createlinenumber{4523}{95cf}
\createlinenumber{4524}{95cf}
\createlinenumber{4525}{c5da}
\createlinenumber{4526}{5f3a}
\createlinenumber{4527}{95cf}
\createlinenumber{4528}{427e}
\createlinenumber{4529}{427e}
\createlinenumber{4530}{427e}
\createlinenumber{4531}{427e}
\createlinenumber{4532}{427e}
\createlinenumber{4533}{427e}
\createlinenumber{4534}{024e}
\createlinenumber{4535}{6e90}
\createlinenumber{4536}{79ea}
\createlinenumber{4537}{9ba1}
\createlinenumber{4538}{57b2}
\createlinenumber{4539}{50d0}
\createlinenumber{4540}{ae27}
\createlinenumber{4541}{541b}
\createlinenumber{4542}{427e}
\createlinenumber{4543}{9276}
\createlinenumber{4544}{4506}
\createlinenumber{4545}{29da}
\createlinenumber{4546}{ddf2}
\createlinenumber{4547}{95cf}
\createlinenumber{4548}{427e}
\createlinenumber{4549}{b988}
\createlinenumber{4550}{f0e2}
\createlinenumber{4551}{4506}
\createlinenumber{4552}{a725}
\createlinenumber{4553}{4133}
\createlinenumber{4554}{8245}
\createlinenumber{4555}{c7ad}
\createlinenumber{4556}{95cf}
\createlinenumber{4557}{427e}
\createlinenumber{4558}{f311}
\createlinenumber{4559}{325b}
\createlinenumber{4560}{d821}
\createlinenumber{4561}{4506}
\createlinenumber{4562}{0b49}
\createlinenumber{4563}{4755}
\createlinenumber{4564}{139f}
\createlinenumber{4565}{c399}
\createlinenumber{4566}{bf51}
\createlinenumber{4567}{3cb5}
\createlinenumber{4568}{4506}
\createlinenumber{4569}{044c}
\createlinenumber{4570}{4506}
\createlinenumber{4571}{427e}
\createlinenumber{4572}{b333}
\createlinenumber{4573}{95cf}
\createlinenumber{4574}{2847}
\createlinenumber{4575}{5b6b}
\createlinenumber{4576}{649a}
\createlinenumber{4577}{4506}
\createlinenumber{4578}{a333}
\createlinenumber{4579}{b333}
\createlinenumber{4580}{95cf}
\createlinenumber{4581}{1d99}
\createlinenumber{4582}{4db3}
\createlinenumber{4583}{2020}
\createlinenumber{4584}{4506}
\createlinenumber{4585}{427e}
\createlinenumber{4586}{b786}
\createlinenumber{4587}{410f}
\createlinenumber{4588}{ad56}
\createlinenumber{4589}{0e36}
\createlinenumber{4590}{f40f}
\createlinenumber{4591}{9533}
\createlinenumber{4592}{4506}
\createlinenumber{4593}{3d2d}
\createlinenumber{4594}{ffe2}
\createlinenumber{4595}{75b6}
\createlinenumber{4596}{95cf}
\createlinenumber{4597}{75b6}
\createlinenumber{4598}{25dc}
\createlinenumber{4599}{427e}
\createlinenumber{4600}{427e}
\createlinenumber{4601}{95cf}
\createlinenumber{4602}{95cf}
\createlinenumber{4603}{95cf}
\createlinenumber{4604}{52c1}
\createlinenumber{4605}{427e}
\createlinenumber{4606}{885f}
\createlinenumber{4607}{4506}
\createlinenumber{4608}{d235}
\createlinenumber{4609}{77f1}
\createlinenumber{4610}{2707}
\createlinenumber{4611}{427e}
\createlinenumber{4612}{1120}
\createlinenumber{4613}{c802}
\createlinenumber{4614}{e88f}
\createlinenumber{4615}{c802}
\createlinenumber{4616}{4506}
\createlinenumber{4617}{395c}
\createlinenumber{4618}{07c3}
\createlinenumber{4619}{56eb}
\createlinenumber{4620}{4506}
\createlinenumber{4621}{b704}
\createlinenumber{4622}{7099}
\createlinenumber{4623}{4506}
\createlinenumber{4624}{3d2d}
\createlinenumber{4625}{75b6}
\createlinenumber{4626}{95cf}
\createlinenumber{4627}{fe38}
\createlinenumber{4628}{95cf}
\createlinenumber{4629}{95cf}
\createlinenumber{4630}{427e}
\createlinenumber{4631}{427e}
\createlinenumber{4632}{427e}
\createlinenumber{4633}{727b}
\createlinenumber{4634}{0ae7}
\createlinenumber{4635}{2a08}
\createlinenumber{4636}{320d}
\createlinenumber{4637}{f7d7}
\createlinenumber{4638}{bf51}
\createlinenumber{4639}{79ea}
\createlinenumber{4640}{4506}
\createlinenumber{4641}{0b49}
\createlinenumber{4642}{3cb5}
\createlinenumber{4643}{4506}
\createlinenumber{4644}{f90d}
\createlinenumber{4645}{4522}
\createlinenumber{4646}{4506}
\createlinenumber{4647}{885d}
\createlinenumber{4648}{fe38}
\createlinenumber{4649}{427e}
\createlinenumber{4650}{3c65}
\createlinenumber{4651}{18f1}
\createlinenumber{4652}{0854}
\createlinenumber{4653}{95cf}
\createlinenumber{4654}{95cf}
\createlinenumber{4655}{52c1}
\createlinenumber{4656}{427e}
\createlinenumber{4657}{427e}
\createlinenumber{4658}{427e}
\createlinenumber{4659}{1b95}
\createlinenumber{4660}{4506}
\createlinenumber{4661}{5750}
\createlinenumber{4662}{935d}
\createlinenumber{4663}{c802}
\createlinenumber{4664}{be65}
\createlinenumber{4665}{427e}
\createlinenumber{4666}{c802}
\createlinenumber{4667}{4506}
\createlinenumber{4668}{d611}
\createlinenumber{4669}{95cf}
\createlinenumber{4670}{4a2e}
\createlinenumber{4671}{c802}
\createlinenumber{4672}{4506}
\createlinenumber{4673}{98fc}
\createlinenumber{4674}{0630}
\createlinenumber{4675}{95cf}
\createlinenumber{4676}{95cf}
\createlinenumber{4677}{427e}
\createlinenumber{4678}{427e}
\createlinenumber{4679}{427e}
\createlinenumber{4680}{82b0}
\createlinenumber{4681}{4506}
\createlinenumber{4682}{e66e}
\createlinenumber{4683}{53e6}
\createlinenumber{4684}{a9ad}
\createlinenumber{4685}{6371}
\createlinenumber{4686}{d0b6}
\createlinenumber{4687}{8c70}
\createlinenumber{4688}{0abf}
\createlinenumber{4689}{fdd8}
\createlinenumber{4690}{8028}
\createlinenumber{4691}{0c1e}
\createlinenumber{4692}{95cf}
\createlinenumber{4693}{427e}
\createlinenumber{4694}{bef6}
\createlinenumber{4695}{427e}
\createlinenumber{4696}{427e}
\createlinenumber{4697}{ea31}
\createlinenumber{4698}{427e}
\createlinenumber{4699}{299c}
\createlinenumber{4700}{4506}
\createlinenumber{4701}{e635}
\createlinenumber{4702}{60b7}
\createlinenumber{4703}{4506}
\createlinenumber{4704}{1945}
\createlinenumber{4705}{427e}
\createlinenumber{4706}{a874}
\createlinenumber{4707}{4506}
\createlinenumber{4708}{a6b8}
\createlinenumber{4709}{4bbc}
\createlinenumber{4710}{427e}
\createlinenumber{4711}{03ff}
\createlinenumber{4712}{427e}
\createlinenumber{4713}{427e}
\createlinenumber{4714}{95cf}
\createlinenumber{4715}{c01f}
\createlinenumber{4716}{b6c8}
\createlinenumber{4717}{e9b6}
\createlinenumber{4718}{427e}
\createlinenumber{4719}{9523}
\createlinenumber{4720}{1fd9}
\createlinenumber{4721}{524a}
\createlinenumber{4722}{7d0e}
\createlinenumber{4723}{4506}
\createlinenumber{4724}{a6b8}
\createlinenumber{4725}{4bbc}
\createlinenumber{4726}{442b}
\createlinenumber{4727}{eba2}
\createlinenumber{4728}{95cf}
\createlinenumber{4729}{885d}
\createlinenumber{4730}{95cf}
\createlinenumber{4731}{95cf}
\begin{lstlisting}[language={}]
#include <cstdio>
#include <cstring>
#include <algorithm>
#include <set>
#include <vector>
#include <stack>
#include <cmath>

using namespace std; 

#define MN 410000
#define MM 2000000
#define logMN 19
#define pb(x) push_back(x)

int N,M;

struct Graph
{
  struct E_Node
  {
    int a,v,ne;
  } E[MM];
  
  int R[MN],e_sz;
  
  
  void Add( int a, int b, int c=0)
  {
    if (a==b) return;
    E[++e_sz].v=b;;E[e_sz].ne=R[a];R[a]=e_sz;E[e_sz].a=a;
  }
  
  int SZ[MN];
  int O[MM];
  
  void init()
  {
    e_sz=0;
    memset(R,0,sizeof R);

    //Edge_Connect
  }
  
  
  //Rebuild
  //重构图
  //E[],R[],N,col[],color
  //G
  int _col[MN];
  
  void Rebuild( Graph &GG)
  {
    GG.init();
    for (int i=1;i<=color;i++) GG.cut[i]=0;
    for (int i=1;i<=N;i++)
    {
      if (cut[i]) 
      {
        GG.cut[col[i]=++color]=1;
        for (int p=R[i];p;p=E[p].ne)
          GG.Add(col[i],O[p]),GG.Add(O[p],col[i]);
      }
    }
    for (int i=1;i<=color;i++) GG.SZ[i]=0;
    for (int i=1;i<=N;i++) GG.SZ[col[i]]++;
  }
  
  //Edge_Connect 
  //边双连通分量
  //E[],R[],N
  //先去除重边
  
  bool vis[MN];
  int dfs[MN],low[MN];
  int col[MN];
  bool vise[MM];
  int color,cc;
  bool cut[MN];
  stack<int> stk;
  vector<int> cedge;

  int op( int p)
  {
    if (p&1) return p+1;
    else return p-1;
  }
  
int ci,cp;
  void Cedge()
  {
    for (ci=0;ci<cedge.size();ci++)
      for (cp=R[cedge[ci]];cp;cp=E[cp].ne)
        if (col[cedge[ci]]==col[E[cp].v])
          O[cp]=O[op(cp)]=col[cedge[ci]];
  }
  
  int CO[MN];
int pp[MN];
  void Dfs( int k)
  {
    vis[k]=1;
    stk.push(k);
    low[k]=dfs[k]=++cc;
    CO[k]=0;
#define p pp[k]
    for (p=R[k];p;p=E[p].ne)
    {
      if (vise[p]) 
      {
//        low[k]=min(low[k],dfs[E[p].v]);
        continue;
      }
      vise[p]=vise[op(p)]=1;
      if (!vis[E[p].v]) Dfs(E[p].v),CO[k]++,low[k]=min(low[k],low[E[p].v]);
      else 
      {
        low[k]=min(low[k],dfs[E[p].v]);
        continue;//
      }
      if (dfs[k]==1&&CO[k]>1) cut[k]=1;
      else if (dfs[k]!=1&&dfs[k]<=low[E[p].v]) cut[k]=1;
      if (dfs[k]<=low[E[p].v])
      {
  
        cedge.clear();
        col[k]=++color;
        col[E[p].v]=color;
        cedge.pb(k);
        cedge.pb(E[p].v);
        while (stk.top()!=E[p].v)
        {
          col[stk.top()]=color;
          cedge.pb(stk.top());
          stk.pop();
        }
        stk.pop();
        Cedge();

      //stk.pop();
      }
    }
  }
#undef p
  
  void Edge_Connect()
  {
    memset(cut,0,sizeof cut);
    while (stk.size()) stk.pop();
    for (int i=0;i<=e_sz;i++) vise[i]=0;

    color=cc=0;
    for (int i=1;i<=N;i++)
      vis[i]=0,col[i]=0;
    for (int i=1;i<=N;i++)
    {
      cc=0;
      if (!vis[i]) Dfs(i);
/*      if (stk.size())
      {
        ++color;
        while (stk.size())
        {
          col[stk.top()]=color;
          stk.pop();
        }
      }*/
    }
  }

  //buildtree
  //建树
  int dep[MN],root[MN];
  int ancestor[MN][logMN];
  int F[MN][logMN];
  int W[MN][logMN];
  int P[MN];
#define p pp[k]
  void buildtree( int k)
  {
    vis[k]=1;
    for (p=R[k];p;p=E[p].ne)
    {
      if (vis[E[p].v]) continue;
    /*  if (cut[k]&&cut[E[p].v])
      {
        puts("");
      }*/

      if (cut[k]==1) P[E[p].v]++;
      if (cut[E[p].v]==1) P[k]++;
      ancestor[E[p].v][0]=k,F[E[p].v][0]=SZ[E[p].v],dep[E[p].v]=dep[k]+1,root[E[p].v]=root[k],buildtree(E[p].v);
    }
  }
#undef p
  //lca_init
  //lca预处理
  //可以处理森林
  void lca_init( int N)
  {
    memset(ancestor,0,sizeof ancestor);
    for (int i=1;i<=N;i++) vis[i]=0,P[i]=0;
    for (int i=1;i<=N;i++)
      if (ancestor[i][0]==0) F[i][0]=SZ[i],dep[i]=1,root[i]=i,buildtree(i);

    for (int i=1;i<=N;i++)
    {
      if (cut[i]) P[i]=0,F[i][0]=1;F[i][0]+=P[i];
    }
    for (int k=1;k<=log2(N);k++)
      for (int i=1;i<=N;i++)
      {
        ancestor[i][k]=ancestor[ancestor[i][k-1]][k-1];
        F[i][k]=F[i][k-1]+F[ancestor[i][k-1]][k-1];
      }
  }

  //return lca(a,b)
  //return -1 if a,b in diffirent tree
  int lca_query(int a, int b, int N)
  {
    int ans=0,tans=0,tt=0;
    if (root[a]!=root[b]) return 0;
    if (a==b) return F[a][0];
    if (dep[a]>dep[b]) swap(a,b);
    int delta=dep[b]-dep[a];
    ans=-delta;
    for (int k=0;k<=log2(N);k++) if ((1<<k)&delta) ans+=F[b][k],b=ancestor[b][k];
    if (a==b) return ans+F[a][0];
    for (int k=log2(N);k>=0;k--) if (ancestor[a][k]!=ancestor[b][k]) ans+=F[a][k]+F[b][k],ans-=1<<(k+1),a=ancestor[a][k],b=ancestor[b][k];
    return ans+F[a][0]+F[b][0]+F[ancestor[a][0]][0]-2;
  }

} G,GG;
  

int cases;
  
int main()
{
  int a,b;
  while (scanf("%d%d",&N,&M)!=EOF)
  {
    G.init();
    //Edge.clear();
    for (int i=1;i<=M;i++)
    {
      scanf("%d%d",&a,&b);
      a++;b++;
    //  if (Edge.find(make_pair(a,b))!=Edge.end()) continue;
      G.Add(a,b);G.Add(b,a);
    //  Edge.insert(make_pair(a,b));
    //  Edge.insert(make_pair(b,a));
    }
    G.Edge_Connect();
    G.Rebuild(GG);
    GG.lca_init(G.color);

    int T;
    scanf("%d",&T);
    printf("Case #%d:\n",++cases);
    while (T--)
    {
      scanf("%d%d",&a,&b);
      a++;b++;
      if (a==b) printf("%d\n",N-1);
      else printf("%d\n",N-GG.lca_query(G.col[a],G.col[b],G.color));
    }
    puts("");
  }
}
\end{lstlisting}
\subsection{Stoer-Wagne}
\createlinenumber{4732}{427e}
\createlinenumber{4733}{427e}
\createlinenumber{4734}{427e}
\createlinenumber{4735}{e0a5}
\createlinenumber{4736}{59b9}
\createlinenumber{4737}{ef2f}
\createlinenumber{4738}{421c}
\createlinenumber{4739}{47b3}
\createlinenumber{4740}{0541}
\createlinenumber{4741}{5c83}
\createlinenumber{4742}{c827}
\createlinenumber{4743}{4506}
\createlinenumber{4744}{576f}
\createlinenumber{4745}{2dbf}
\createlinenumber{4746}{0180}
\createlinenumber{4747}{ffcb}
\createlinenumber{4748}{4506}
\createlinenumber{4749}{ab88}
\createlinenumber{4750}{c988}
\createlinenumber{4751}{95cf}
\createlinenumber{4752}{61b6}
\createlinenumber{4753}{95cf}
\createlinenumber{4754}{78af}
\createlinenumber{4755}{d7dd}
\createlinenumber{4756}{9acc}
\createlinenumber{4757}{4506}
\createlinenumber{4758}{74c3}
\createlinenumber{4759}{7dd1}
\createlinenumber{4760}{3bab}
\createlinenumber{4761}{457c}
\createlinenumber{4762}{a17f}
\createlinenumber{4763}{4506}
\createlinenumber{4764}{901d}
\createlinenumber{4765}{4d7b}
\createlinenumber{4766}{8647}
\createlinenumber{4767}{d40b}
\createlinenumber{4768}{e5e3}
\createlinenumber{4769}{95cf}
\createlinenumber{4770}{6bff}
\createlinenumber{4771}{95cf}
\createlinenumber{4772}{299c}
\createlinenumber{4773}{4506}
\createlinenumber{4774}{e90f}
\createlinenumber{4775}{6853}
\createlinenumber{4776}{4506}
\createlinenumber{4777}{0ea5}
\createlinenumber{4778}{c864}
\createlinenumber{4779}{4506}
\createlinenumber{4780}{0f52}
\createlinenumber{4781}{685d}
\createlinenumber{4782}{24d1}
\createlinenumber{4783}{95cf}
\createlinenumber{4784}{575e}
\createlinenumber{4785}{65b7}
\createlinenumber{4786}{4506}
\createlinenumber{4787}{2e7a}
\createlinenumber{4788}{4efe}
\createlinenumber{4789}{d185}
\createlinenumber{4790}{95cf}
\createlinenumber{4791}{0f28}
\createlinenumber{4792}{95cf}
\createlinenumber{4793}{7021}
\createlinenumber{4794}{95cf}
\begin{lstlisting}[language={}]
// 全局最小割
//N^3
//@
#include <iostream>
#include <cstdio>
#include <cstring>
using namespace std;
const int maxn=510;
int map[maxn][maxn];
int n;
void contract(int x,int y)
{
  int i,j;
  for (i=0;i<n;i++)
    if (i!=x) map[x][i]+=map[y][i],map[i][x]+=map[i][y];
  for (i=y+1;i<n;i++) for (j=0;j<n;j++)
  {
    map[i-1][j]=map[i][j];
    map[j][i-1]=map[j][i];
  }
  n--;
}
int w[maxn],c[maxn];
int sx,tx;
int mincut()
{
  int i,j,k,t;
  memset(c,0,sizeof(c));
  c[0]=1;
  for (i=0;i<n;i++) w[i]=map[0][i];
  for (i=1;i+1<n;i++)
  {
    t=k=-1;
    for (j=0;j<n;j++) if (c[j]==0&&w[j]>k)
     k=w[t=j];
    c[sx=t]=1;
    for (j=0;j<n;j++) w[j]+=map[t][j];
  }
  for (i=0;i<n;i++) if (c[i]==0) return w[tx=i];
  }
int main()
{
  int i,j,k,m;
  while (scanf("%d%d",&n,&m)!=EOF)
  { 
    memset(map,0,sizeof(map));
    while (m--)
    {
     scanf("%d%d%d",&i,&j,&k);
     map[i][j]+=k;
     map[j][i]+=k;
    }
    int mint=999999999;
    while (n>1)
    {
     k=mincut();
     if (k<mint) mint=k;
     contract(sx,tx);
    }
    printf("%d\n",mint);
  }
  return 0;
}
\end{lstlisting}
\subsection{度限制生成树}
\createlinenumber{4795}{e0a5}
\createlinenumber{4796}{ef0e}
\createlinenumber{4797}{9581}
\createlinenumber{4798}{acb9}
\createlinenumber{4799}{8c52}
\createlinenumber{4800}{ef2f}
\createlinenumber{4801}{2349}
\createlinenumber{4802}{421c}
\createlinenumber{4803}{d8fa}
\createlinenumber{4804}{65a1}
\createlinenumber{4805}{4506}
\createlinenumber{4806}{7a26}
\createlinenumber{4807}{329b}
\createlinenumber{4808}{a433}
\createlinenumber{4809}{4506}
\createlinenumber{4810}{3d46}
\createlinenumber{4811}{4506}
\createlinenumber{4812}{1d47}
\createlinenumber{4813}{95cf}
\createlinenumber{4814}{329b}
\createlinenumber{4815}{53ee}
\createlinenumber{4816}{701e}
\createlinenumber{4817}{4111}
\createlinenumber{4818}{84b0}
\createlinenumber{4819}{e8c8}
\createlinenumber{4820}{4363}
\createlinenumber{4821}{aede}
\createlinenumber{4822}{627b}
\createlinenumber{4823}{7680}
\createlinenumber{4824}{172a}
\createlinenumber{4825}{bf86}
\createlinenumber{4826}{9507}
\createlinenumber{4827}{1e17}
\createlinenumber{4828}{4a0b}
\createlinenumber{4829}{d02f}
\createlinenumber{4830}{8a96}
\createlinenumber{4831}{4506}
\createlinenumber{4832}{576f}
\createlinenumber{4833}{f661}
\createlinenumber{4834}{d900}
\createlinenumber{4835}{769e}
\createlinenumber{4836}{427e}
\createlinenumber{4837}{d8f6}
\createlinenumber{4838}{f041}
\createlinenumber{4839}{deb8}
\createlinenumber{4840}{4506}
\createlinenumber{4841}{f099}
\createlinenumber{4842}{1a39}
\createlinenumber{4843}{5037}
\createlinenumber{4844}{4506}
\createlinenumber{4845}{b4df}
\createlinenumber{4846}{95cf}
\createlinenumber{4847}{95cf}
\createlinenumber{4848}{91c9}
\createlinenumber{4849}{2eb3}
\createlinenumber{4850}{6988}
\createlinenumber{4851}{4506}
\createlinenumber{4852}{fad5}
\createlinenumber{4853}{a3dd}
\createlinenumber{4854}{917d}
\createlinenumber{4855}{4506}
\createlinenumber{4856}{c93c}
\createlinenumber{4857}{8edc}
\createlinenumber{4858}{95cf}
\createlinenumber{4859}{fbab}
\createlinenumber{4860}{a84b}
\createlinenumber{4861}{917d}
\createlinenumber{4862}{4506}
\createlinenumber{4863}{c93c}
\createlinenumber{4864}{e2a7}
\createlinenumber{4865}{95cf}
\createlinenumber{4866}{3878}
\createlinenumber{4867}{a996}
\createlinenumber{4868}{4506}
\createlinenumber{4869}{ff0f}
\createlinenumber{4870}{95cf}
\createlinenumber{4871}{95cf}
\createlinenumber{4872}{ff36}
\createlinenumber{4873}{783a}
\createlinenumber{4874}{1f5c}
\createlinenumber{4875}{4506}
\createlinenumber{4876}{0dfd}
\createlinenumber{4877}{4506}
\createlinenumber{4878}{ed5b}
\createlinenumber{4879}{303a}
\createlinenumber{4880}{427e}
\createlinenumber{4881}{af5a}
\createlinenumber{4882}{95cf}
\createlinenumber{4883}{95cf}
\createlinenumber{4884}{7360}
\createlinenumber{4885}{67a2}
\createlinenumber{4886}{427e}
\createlinenumber{4887}{ceca}
\createlinenumber{4888}{d72b}
\createlinenumber{4889}{7021}
\createlinenumber{4890}{95cf}
\createlinenumber{4891}{103f}
\createlinenumber{4892}{4506}
\createlinenumber{4893}{c8ed}
\createlinenumber{4894}{3495}
\createlinenumber{4895}{a058}
\createlinenumber{4896}{c7c1}
\createlinenumber{4897}{a8ed}
\createlinenumber{4898}{6b09}
\createlinenumber{4899}{e0e5}
\createlinenumber{4900}{4506}
\createlinenumber{4901}{1b18}
\createlinenumber{4902}{4506}
\createlinenumber{4903}{c3cc}
\createlinenumber{4904}{f2f8}
\createlinenumber{4905}{6e31}
\createlinenumber{4906}{6dbf}
\createlinenumber{4907}{4506}
\createlinenumber{4908}{cde5}
\createlinenumber{4909}{37a1}
\createlinenumber{4910}{4506}
\createlinenumber{4911}{0423}
\createlinenumber{4912}{95cf}
\createlinenumber{4913}{1f5c}
\createlinenumber{4914}{4506}
\createlinenumber{4915}{ae84}
\createlinenumber{4916}{4506}
\createlinenumber{4917}{cf01}
\createlinenumber{4918}{671b}
\createlinenumber{4919}{d413}
\createlinenumber{4920}{6b09}
\createlinenumber{4921}{95cf}
\createlinenumber{4922}{95cf}
\createlinenumber{4923}{6173}
\createlinenumber{4924}{95cf}
\createlinenumber{4925}{95cf}
\createlinenumber{4926}{95cf}
\createlinenumber{4927}{95cf}
\createlinenumber{4928}{427e}
\createlinenumber{4929}{4abc}
\createlinenumber{4930}{4506}
\createlinenumber{4931}{c8ed}
\createlinenumber{4932}{bb7c}
\createlinenumber{4933}{22df}
\createlinenumber{4934}{d46a}
\createlinenumber{4935}{437a}
\createlinenumber{4936}{4506}
\createlinenumber{4937}{0d63}
\createlinenumber{4938}{6a17}
\createlinenumber{4939}{59b2}
\createlinenumber{4940}{95cf}
\createlinenumber{4941}{9047}
\createlinenumber{4942}{f6a3}
\createlinenumber{4943}{abf1}
\createlinenumber{4944}{8b10}
\createlinenumber{4945}{427e}
\createlinenumber{4946}{990e}
\createlinenumber{4947}{4506}
\createlinenumber{4948}{5cac}
\createlinenumber{4949}{74d2}
\createlinenumber{4950}{4506}
\createlinenumber{4951}{30b8}
\createlinenumber{4952}{4b3f}
\createlinenumber{4953}{95cf}
\createlinenumber{4954}{649a}
\createlinenumber{4955}{4506}
\createlinenumber{4956}{abf1}
\createlinenumber{4957}{8b10}
\createlinenumber{4958}{95cf}
\createlinenumber{4959}{95cf}
\createlinenumber{4960}{95cf}
\createlinenumber{4961}{a038}
\createlinenumber{4962}{4506}
\createlinenumber{4963}{80a8}
\createlinenumber{4964}{9059}
\createlinenumber{4965}{dc9d}
\createlinenumber{4966}{0e77}
\createlinenumber{4967}{4506}
\createlinenumber{4968}{9bcf}
\createlinenumber{4969}{427e}
\createlinenumber{4970}{8d9b}
\createlinenumber{4971}{c32d}
\createlinenumber{4972}{4506}
\createlinenumber{4973}{ae09}
\createlinenumber{4974}{00ff}
\createlinenumber{4975}{034d}
\createlinenumber{4976}{0ffc}
\createlinenumber{4977}{95cf}
\createlinenumber{4978}{ad40}
\createlinenumber{4979}{95cf}
\createlinenumber{4980}{427e}
\createlinenumber{4981}{ce2a}
\createlinenumber{4982}{1f5c}
\createlinenumber{4983}{4506}
\createlinenumber{4984}{0dfd}
\createlinenumber{4985}{4506}
\createlinenumber{4986}{5213}
\createlinenumber{4987}{95cf}
\createlinenumber{4988}{95cf}
\createlinenumber{4989}{3f24}
\createlinenumber{4990}{4506}
\createlinenumber{4991}{a722}
\createlinenumber{4992}{1f5c}
\createlinenumber{4993}{4506}
\createlinenumber{4994}{33ca}
\createlinenumber{4995}{427e}
\createlinenumber{4996}{9639}
\createlinenumber{4997}{4506}
\createlinenumber{4998}{2a0e}
\createlinenumber{4999}{8b85}
\createlinenumber{5000}{95cf}
\createlinenumber{5001}{95cf}
\createlinenumber{5002}{6bbd}
\createlinenumber{5003}{dc8c}
\createlinenumber{5004}{427e}
\createlinenumber{5005}{adda}
\createlinenumber{5006}{f116}
\createlinenumber{5007}{c32d}
\createlinenumber{5008}{4506}
\createlinenumber{5009}{ae09}
\createlinenumber{5010}{00ff}
\createlinenumber{5011}{034d}
\createlinenumber{5012}{0ffc}
\createlinenumber{5013}{95cf}
\createlinenumber{5014}{3647}
\createlinenumber{5015}{55fa}
\createlinenumber{5016}{95cf}
\createlinenumber{5017}{95cf}
\begin{lstlisting}[language={}]
#include <iostream>
#include <fstream>
#include <climits>
#include <queue>
#include <map>
#include <cstring>
#include <string>
using namespace std;
const int maxn = 25;
struct node
{
  int v, w;
};
struct cmp
{
  bool operator() (const node &a, const node &b)
  {
    return a.w > b.w; // >是从小到大.
  }
};
int n, m, s; // n 个点，m 条边，s 为原点. V0点为有度数限制的点
int num;
int minV0[maxn]; 
int total; // 限制的度数.
int dist[maxn];
int g[maxn][maxn]; // 用二维数组来记录图。
bool p[maxn]; 
int pre[maxn]; 
int max_value[maxn], max_value_v[maxn];
priority_queue <node, vector<node>, cmp> Q;
map <string, int> Map;
int ans;
void Prim(void);
void Solve(void);
void Cal_max_value(int t);
int main(void)
{
  int i, j;
  string name1, name2;
  int a, b, w;
  map <string, int>::iterator iter;
  // 初始化。
  Map.clear();
  Map["Park"] = 0;
  for (i = 0; i <= maxn - 1; i++)
  {
    dist[i] = INT_MAX;
    pre[i] = -1;
    for (j = 0; j <= maxn - 1; j++)
    {
      g[i][j] = INT_MAX;
    }
  }
  n = 0;
  cin >> m;
  for (i = 1; i <= m; i++)
  {
   cin >> name1 >> name2 >> w;
   iter = Map.find(name1);
   if (iter == Map.end())
   { // 说明该结点还不存在.
     n++;
     Map[name1] = n;
   }
   a = Map[name1];
   iter = Map.find(name2);
   if (iter == Map.end())
   { // 说明该结点还不存在.
     n++;
     Map[name2] = n;
   }
   b = Map[name2];
   if (g[a][b] > w)
   {
     g[a][b] = g[b][a] = w;
   }
  }
  cin >> total; // 输入限制的度数.
   memset(p, 0, sizeof(p)); num = 0;
   for (i = 1; i <= n; i++)
   {
    if (!p[i])
    {
      s = i;
      num++; minV0[num] = s;
     // 求除去限制结点的最小生成树.
     Prim();
    }
   }
  ans = 0;
  for (i = 1; i <= n; i++) ans += dist[i];
  // 求最小度限制生成树.
  Solve();
  printf("Total miles driven: %d\n", ans);
  return 0;
}
void Prim(void)
{
  int i, j, k;
  node mini, temp;
  while (!Q.empty()) Q.pop();
  dist[s] = 0;
  temp.v = s; temp.w = 0;
  Q.push(temp);
  for (k = 1; k <= n; k++)
  {
    while (!Q.empty())
    {
      mini = Q.top();
      Q.pop();
      j = mini.v;
      if (!p[j])
      {
        p[j] = 1;
        if (g[0][j] < g[0][minV0[num]])
        { 
          minV0[num] = j;
        }
        for (i = 1; i <= n; i++)
        {
          if (i != j && !p[i] && dist[i] > g[j][i])
          {
            dist[i] = g[j][i];
            pre[i] = j;
            temp.w = dist[i]; temp.v = i;
            Q.push(temp);
          }
        }
        break;
      }
    }
  }
}

void Cal_max_value(int t)
{ 
  int i, j, k;
  int Stack[maxn]; 
  int top(-1);
  i = t;
  while (pre[i] != 0 && pre[i] != -1)
  {
    p[i] = 1;
   Stack[++top] = i;
   i = pre[i];
  }
  if (top < 0) return ;
  j = Stack[top];
  max_value[j] = g[j][pre[j]];
  max_value_v[j] = j;
  
  for (i = top - 1; i >= 0; i--)
  {
    j = Stack[i]; k = Stack[i + 1];
   if (max_value[k] > g[j][pre[j]])
   {
     max_value[j] = max_value[k];
     max_value_v[j] = max_value_v[k];
   }
   else
   {
     max_value[j] = g[j][pre[j]];
     max_value_v[j] = j;
   }
  }
}
void Solve(void)
{
  int i, j, k, l;
  int mini, opti_i, opti_maxV; 
.
  for (k = 1; k <= num; k++)
  {
   ans += g[0][minV0[k]];

  j = minV0[k]; i = pre[j]; 
   while (i != -1)
   {
     l = i;
     i = pre[l];
     pre[l] = j;
     j = l;
   }
   pre[minV0[k]] = 0;
  }
  
  memset(p, 0, sizeof(p));
  for (i = 1; i <= n; i++)
  {
   if (!p[i])
   {
     Cal_max_value(i);
   }
  }
  for (k = 1; k <= total - num; k++)
  {
    mini = 0; 
   for (i = 1; i <= n; i++)
   {
     if (pre[i] == 0) continue;

     if (g[0][i] - max_value[i] < mini)
     {
      mini = g[0][i] - max_value[i];
      opti_i = i; opti_maxV = max_value_v[i];
     }
   }
   if (mini == 0) break; 
   ans += mini;
    
   pre[opti_maxV] = -1;
   j = opti_i; i = pre[j]; 
   while (i != -1)
   {
     l = i;
     i = pre[l];
     pre[l] = j;
     j = l;
   }
   pre[opti_i] = 0;
   Cal_max_value(opti_maxV);
  }
}
\end{lstlisting}
\subsection{最小树形图}
\createlinenumber{5018}{e0a5}
\createlinenumber{5019}{59b9}
\createlinenumber{5020}{ef2f}
\createlinenumber{5021}{c928}
\createlinenumber{5022}{bfb3}
\createlinenumber{5023}{b080}
\createlinenumber{5024}{2f38}
\createlinenumber{5025}{421c}
\createlinenumber{5026}{4674}
\createlinenumber{5027}{6849}
\createlinenumber{5028}{35b8}
\createlinenumber{5029}{935a}
\createlinenumber{5030}{4506}
\createlinenumber{5031}{ef78}
\createlinenumber{5032}{95cf}
\createlinenumber{5033}{2d75}
\createlinenumber{5034}{4506}
\createlinenumber{5035}{5550}
\createlinenumber{5036}{95cf}
\createlinenumber{5037}{18ce}
\createlinenumber{5038}{4506}
\createlinenumber{5039}{2ad4}
\createlinenumber{5040}{4506}
\createlinenumber{5041}{8c5b}
\createlinenumber{5042}{03d4}
\createlinenumber{5043}{00e2}
\createlinenumber{5044}{95cf}
\createlinenumber{5045}{95cf}
\createlinenumber{5046}{28f2}
\createlinenumber{5047}{4506}
\createlinenumber{5048}{f547}
\createlinenumber{5049}{eec6}
\createlinenumber{5050}{e635}
\createlinenumber{5051}{2ad4}
\createlinenumber{5052}{3c14}
\createlinenumber{5053}{2ad4}
\createlinenumber{5054}{8c5b}
\createlinenumber{5055}{f5a0}
\createlinenumber{5056}{2af5}
\createlinenumber{5057}{4506}
\createlinenumber{5058}{a6b8}
\createlinenumber{5059}{3126}
\createlinenumber{5060}{95cf}
\createlinenumber{5061}{427e}
\createlinenumber{5062}{3361}
\createlinenumber{5063}{95cf}
\createlinenumber{5064}{c753}
\createlinenumber{5065}{8aca}
\createlinenumber{5066}{4506}
\createlinenumber{5067}{84ad}
\createlinenumber{5068}{2ad4}
\createlinenumber{5069}{7532}
\createlinenumber{5070}{95cf}
\createlinenumber{5071}{1a66}
\createlinenumber{5072}{4506}
\createlinenumber{5073}{ddf0}
\createlinenumber{5074}{5f3c}
\createlinenumber{5075}{2ad4}
\createlinenumber{5076}{48aa}
\createlinenumber{5077}{3361}
\createlinenumber{5078}{95cf}
\createlinenumber{5079}{fe84}
\createlinenumber{5080}{992d}
\createlinenumber{5081}{2656}
\createlinenumber{5082}{4506}
\createlinenumber{5083}{f29e}
\createlinenumber{5084}{b1b7}
\createlinenumber{5085}{cec3}
\createlinenumber{5086}{1f75}
\createlinenumber{5087}{4506}
\createlinenumber{5088}{a0f7}
\createlinenumber{5089}{427e}
\createlinenumber{5090}{0428}
\createlinenumber{5091}{4506}
\createlinenumber{5092}{50c1}
\createlinenumber{5093}{86f4}
\createlinenumber{5094}{f900}
\createlinenumber{5095}{8c5b}
\createlinenumber{5096}{4506}
\createlinenumber{5097}{fff9}
\createlinenumber{5098}{1f4f}
\createlinenumber{5099}{671b}
\createlinenumber{5100}{95cf}
\createlinenumber{5101}{95cf}
\createlinenumber{5102}{0428}
\createlinenumber{5103}{4506}
\createlinenumber{5104}{427e}
\createlinenumber{5105}{50c1}
\createlinenumber{5106}{8541}
\createlinenumber{5107}{fa64}
\createlinenumber{5108}{ee9d}
\createlinenumber{5109}{4506}
\createlinenumber{5110}{99c6}
\createlinenumber{5111}{b66d}
\createlinenumber{5112}{95cf}
\createlinenumber{5113}{24ac}
\createlinenumber{5114}{934c}
\createlinenumber{5115}{427e}
\createlinenumber{5116}{b0c8}
\createlinenumber{5117}{348f}
\createlinenumber{5118}{4506}
\createlinenumber{5119}{6ac1}
\createlinenumber{5120}{2280}
\createlinenumber{5121}{95cf}
\createlinenumber{5122}{4b26}
\createlinenumber{5123}{4506}
\createlinenumber{5124}{fff9}
\createlinenumber{5125}{a1f5}
\createlinenumber{5126}{48d3}
\createlinenumber{5127}{95cf}
\createlinenumber{5128}{427e}
\createlinenumber{5129}{348f}
\createlinenumber{5130}{4506}
\createlinenumber{5131}{ed11}
\createlinenumber{5132}{4506}
\createlinenumber{5133}{c844}
\createlinenumber{5134}{170a}
\createlinenumber{5135}{fc80}
\createlinenumber{5136}{664f}
\createlinenumber{5137}{95cf}
\createlinenumber{5138}{95cf}
\createlinenumber{5139}{427e}
\createlinenumber{5140}{348f}
\createlinenumber{5141}{4506}
\createlinenumber{5142}{2280}
\createlinenumber{5143}{95cf}
\createlinenumber{5144}{6173}
\createlinenumber{5145}{95cf}
\createlinenumber{5146}{427e}
\createlinenumber{5147}{6bff}
\createlinenumber{5148}{2ad4}
\createlinenumber{5149}{4506}
\createlinenumber{5150}{50c1}
\createlinenumber{5151}{b0c8}
\createlinenumber{5152}{95cf}
\createlinenumber{5153}{6173}
\createlinenumber{5154}{95cf}
\createlinenumber{5155}{95cf}
\createlinenumber{5156}{95cf}
\createlinenumber{5157}{299c}
\createlinenumber{5158}{4506}
\createlinenumber{5159}{1f56}
\createlinenumber{5160}{4506}
\createlinenumber{5161}{a248}
\createlinenumber{5162}{649a}
\createlinenumber{5163}{4506}
\createlinenumber{5164}{1d60}
\createlinenumber{5165}{d6bf}
\createlinenumber{5166}{95cf}
\createlinenumber{5167}{95cf}
\createlinenumber{5168}{7021}
\createlinenumber{5169}{95cf}
\begin{lstlisting}[language={}]
#include <iostream>
#include <cstdio>
#include <cstring>
#include <cmath>
#define MAXN 128
#define MAXM 32768
#define INF 1e15
using namespace std;
double g[MAXN][MAXN];
double res;
int n, m;
double sqr(double x)
{
  return x * x;
}
double dist(double xa, double ya, double xb, double yb)
{
  return sqrt(sqr(xa - xb) + sqr(ya - yb));
}
void print_map()
{
  for (int i = 1; i <= n; ++i)
  {
    for (int j = 1; j <= n; ++j)
      printf("%.2f ", g[i][j]);
    printf("\n");
  }
}
bool init()
{
  if (scanf("%d%d", &n, &m) == EOF) return false;
  double x[MAXN], y[MAXN];
  int a, b;
  for (int i = 1; i <= n; ++i)
    scanf("%lf%lf", &x[i], &y[i]);
  for (int i = 1; i <= n; ++i)
    for (int j = 1; j <= n; ++j)
      g[i][j] = INF;
  for (int i = 1; i <= m; ++i)
  {
    scanf("%d%d", &a, &b);
    g[a][b] = min(g[a][b], dist(x[a], y[a], x[b], y[b]));
  }
  //print_map();
  return true;
}
bool vst[MAXN];
void dfs(int v)
{
  vst[v] = true;
  for (int i = 1; i <= n; ++i)
    if (!vst[i] && g[v][i] != INF) dfs(i);
}
bool possible(int v)
{
  memset(vst, false, sizeof(vst));
  dfs(v);
  for (int i = 1; i <= n; ++i)
    if (i != v && !vst[i]) return false;
  return true;
}
int pre[MAXN];
bool del[MAXN];
void solve(int v)// 根为v
{
  res = 0;
  int num = n;
  memset(del, false, sizeof(del));
  while(1)
  {
    int i;
    // 更新pre数组
    for (i = 1; i <= n; ++i)
    {
      if (del[i] || i == v) continue;
      pre[i] = i;
      g[i][i] = INF;
      for (int j = 1; j <= n; ++j)
      {
        if (del[j]) continue;
        if (g[j][i] < g[pre[i]][i])
          pre[i] = j;
      }
    }
    for (i = 1; i <= n; ++i)
    {
      // 找环
      if (del[i] || i == v) continue;
      int j = i;
      memset(vst, 0, sizeof(vst));
      while (!vst[j] && j != v)
      {
        vst[j] = true;
        j = pre[j];
      }
      if (j == v) continue;
      i = j;
      // 更新res，有向环缩点
      res += g[pre[i]][i];
      for(j = pre[i]; j != i; j = pre[j])
      {
        res += g[pre[j]][j];
        del[j] = true;
      }
      for(j = 1; j <= n; ++j)
      {
        if(del[j]) continue;
        if(g[j][i] != INF)
          g[j][i] -= g[pre[i]][i];
      }
      //更新缩点以后的有向环和其他点的边权
      for(j = pre[i]; j != i; j = pre[j])
      {
        for(int k = 1; k <= n; ++k)
        {
          if(del[k])continue;
          g[i][k] = min(g[i][k], g[j][k]);
          if(g[k][j] != INF)
            g[k][i] = min(g[k][i], g[k][j] - g[pre[j]][j]);
        }
      }
      // 完成缩点
      for(j = pre[i]; j != i; j = pre[j])
      {
        del[j] = true;
      }
      break;
    }
    // 不存在有向环时，停止循环，得出res最终值
    if(i > n){
      for(int i = 1; i <= n; ++i)
      {
        if(del[i] || i == v) continue;
        res += g[pre[i]][i];
      }
      break;
    }
  }
}
int main()
{
  while (init())
  {
    if (!possible(1)) printf("poor snoopy\n");
    else
    {
      solve(1);
      printf("%.2f\n", res);
    }
  }
  return 0;
}
\end{lstlisting}
\subsection{多重匹配}
\createlinenumber{5170}{1915}
\createlinenumber{5171}{0cbb}
\createlinenumber{5172}{a23c}
\createlinenumber{5173}{bac0}
\createlinenumber{5174}{4d9b}
\createlinenumber{5175}{6271}
\createlinenumber{5176}{4506}
\createlinenumber{5177}{a274}
\createlinenumber{5178}{b851}
\createlinenumber{5179}{854a}
\createlinenumber{5180}{4506}
\createlinenumber{5181}{5a4d}
\createlinenumber{5182}{226a}
\createlinenumber{5183}{4506}
\createlinenumber{5184}{aefb}
\createlinenumber{5185}{060a}
\createlinenumber{5186}{3361}
\createlinenumber{5187}{95cf}
\createlinenumber{5188}{2bc2}
\createlinenumber{5189}{1ad5}
\createlinenumber{5190}{4506}
\createlinenumber{5191}{b5be}
\createlinenumber{5192}{4506}
\createlinenumber{5193}{060a}
\createlinenumber{5194}{0bb0}
\createlinenumber{5195}{3361}
\createlinenumber{5196}{95cf}
\createlinenumber{5197}{95cf}
\createlinenumber{5198}{95cf}
\createlinenumber{5199}{438e}
\createlinenumber{5200}{95cf}
\createlinenumber{5201}{653c}
\createlinenumber{5202}{4506}
\createlinenumber{5203}{e4c8}
\createlinenumber{5204}{66c3}
\createlinenumber{5205}{9044}
\createlinenumber{5206}{95cf}
\createlinenumber{5207}{299c}
\createlinenumber{5208}{4506}
\createlinenumber{5209}{e287}
\createlinenumber{5210}{a41b}
\createlinenumber{5211}{4506}
\createlinenumber{5212}{25fe}
\createlinenumber{5213}{e951}
\createlinenumber{5214}{548e}
\createlinenumber{5215}{6bf3}
\createlinenumber{5216}{dc5e}
\createlinenumber{5217}{6e7e}
\createlinenumber{5218}{548e}
\createlinenumber{5219}{4506}
\createlinenumber{5220}{9212}
\createlinenumber{5221}{4fe1}
\createlinenumber{5222}{4506}
\createlinenumber{5223}{539e}
\createlinenumber{5224}{6173}
\createlinenumber{5225}{95cf}
\createlinenumber{5226}{95cf}
\createlinenumber{5227}{f5a9}
\createlinenumber{5228}{e0ad}
\createlinenumber{5229}{548e}
\createlinenumber{5230}{6bf3}
\createlinenumber{5231}{4b54}
\createlinenumber{5232}{4506}
\createlinenumber{5233}{76a8}
\createlinenumber{5234}{bef5}
\createlinenumber{5235}{73cd}
\createlinenumber{5236}{4506}
\createlinenumber{5237}{292e}
\createlinenumber{5238}{cd7b}
\createlinenumber{5239}{95cf}
\createlinenumber{5240}{427e}
\createlinenumber{5241}{95cf}
\createlinenumber{5242}{6c4d}
\createlinenumber{5243}{a27f}
\createlinenumber{5244}{a3dd}
\createlinenumber{5245}{a8ea}
\createlinenumber{5246}{4506}
\createlinenumber{5247}{548e}
\createlinenumber{5248}{4506}
\createlinenumber{5249}{6bf3}
\createlinenumber{5250}{a417}
\createlinenumber{5251}{8f87}
\createlinenumber{5252}{00e2}
\createlinenumber{5253}{95cf}
\createlinenumber{5254}{95cf}
\createlinenumber{5255}{edea}
\createlinenumber{5256}{95cf}
\createlinenumber{5257}{95cf}
\begin{lstlisting}[language={}]
#include <stdio.h>
const int maxn=100;
int a[maxn],b[maxn],nov_a[maxn],nov_b[maxn];
int w[maxn][maxn];
int m,n;
bool find(int i)
{
  nov_a[i]=0;
  for(int p=0;p<n;p++)
  if(w[i][p]==0&&nov_b[p])
  {
    nov_b[p]=0;
    if(b[p]>0)
    {
      b[p]--;
      w[i][p]=1;
      return true;
    }
    for(int q=0;q<m;q++)
    if(w[q][p]==1&&nov_a[q])
    {
      if(find(q))
      {
        w[i][p]=1;
        w[q][p]=0;
        return true;
      }
    }
  }
  return false;
}
bool gao(int i)
{
  for(int j=0;j<m;j++)nov_a[j]=1;
  for(int j=0;j<n;j++)nov_b[j]=1;
  return find(i);
}
int main()
{
  int cas=0;
  while(scanf("%d%d",&m,&n)!=EOF&&(m||n))
  {
    for(int i=0;i<m;i++)scanf("%d",&a[i]);
    for(int i=0;i<n;i++)scanf("%d",&b[i]);
    for(int i=0;i<m;i++)
    for(int j=0;j<n;j++)
    w[i][j]=0;
    bool ans=true;
    for(int i=0;i<m;i++)
    {
      while(a[i]>0&&gao(i))a[i]--;
      if(a[i]!=0)
      {
        ans=false;
        break;
      }
    }
    for(int i=0;i<n;i++)
    if(b[i]>0)ans=false;
    for(int i=0;i<m;i++)
    for(int j=0;j<n;j++)
    if(w[i][j]==1)
    {
      b[j]++;
      w[i][j]=-1;
      if(!gao(i))
      {
        w[i][j]=1;
        b[j]=0;
      }
      
    }
    else w[i][j]=-1;
    cas++;
    if(cas!=1)printf("\n");
    if(ans)
    {
      for(int i=0;i<m;i++)
      {
        for(int j=0;j<n;j++)
        if(w[i][j]==1)printf("Y");
        else printf("N");
        printf("\n");
      }
    }
    else printf("Impossible\n");
  }
}
\end{lstlisting}

\section{java样例}
\subsection{java样例}
\createlinenumber{5258}{84fe}
\createlinenumber{5259}{93c2}
\createlinenumber{5260}{4156}
\createlinenumber{5261}{788a}
\createlinenumber{5262}{e1b6}
\createlinenumber{5263}{f75d}
\createlinenumber{5264}{ac68}
\createlinenumber{5265}{93f1}
\createlinenumber{5266}{4f78}
\createlinenumber{5267}{f3f7}
\createlinenumber{5268}{3c41}
\createlinenumber{5269}{e725}
\createlinenumber{5270}{734a}
\createlinenumber{5271}{6c2f}
\createlinenumber{5272}{427e}
\createlinenumber{5273}{6613}
\createlinenumber{5274}{4677}
\createlinenumber{5275}{b9b5}
\createlinenumber{5276}{0541}
\createlinenumber{5277}{95cf}
\createlinenumber{5278}{95cf}
\createlinenumber{5279}{bf14}
\createlinenumber{5280}{ecee}
\createlinenumber{5281}{95cf}
\createlinenumber{5282}{004f}
\createlinenumber{5283}{427e}
\createlinenumber{5284}{95cf}
\createlinenumber{5285}{95cf}
\createlinenumber{5286}{427e}
\createlinenumber{5287}{95cf}
\begin{lstlisting}[language={}]
import java.io.*;
import java.math.BigInteger;
import java.util.*;
public class Main {
  public static void main(String[] args) {
    Scanner cin = new Scanner(new BufferedInputStream(System.in));
    while (cin.hasNext()){
      int m = cin.nextInt();
      int n = cin.nextInt();
      int best = 0;
      BigInteger b[] = new BigInteger[m];
      for (int i = 0; i < m; ++i)
        b[i] = BigInteger.valueOf(1);
      for (int i = 0; i < n; ++i){
        //BigInteger c = BigInteger.valueOf(1);
        for (int j = 0; j < m; ++j){
          int x = cin.nextInt();
          BigInteger d = BigInteger.valueOf(x);
          b[j] = b[j].multiply(d);
        }
      }
      for (int i = 1; i < m; ++i){
        if (b[best].compareTo(b[i]) <= 0) best = i;
      }
      System.out.println(best + 1);
      
    }
  }

}
\end{lstlisting}

\section{其他}
\subsection{校赛Meeting标程}
\createlinenumber{5288}{1915}
\createlinenumber{5289}{1fa4}
\createlinenumber{5290}{427e}
\createlinenumber{5291}{842a}
\createlinenumber{5292}{8f9d}
\createlinenumber{5293}{427e}
\createlinenumber{5294}{4d45}
\createlinenumber{5295}{4506}
\createlinenumber{5296}{ec32}
\createlinenumber{5297}{e2fe}
\createlinenumber{5298}{3df7}
\createlinenumber{5299}{b00a}
\createlinenumber{5300}{05ee}
\createlinenumber{5301}{4506}
\createlinenumber{5302}{5c82}
\createlinenumber{5303}{c0ce}
\createlinenumber{5304}{583c}
\createlinenumber{5305}{95cf}
\createlinenumber{5306}{547e}
\createlinenumber{5307}{95cf}
\createlinenumber{5308}{427e}
\createlinenumber{5309}{afdd}
\createlinenumber{5310}{4506}
\createlinenumber{5311}{918b}
\createlinenumber{5312}{b4a4}
\createlinenumber{5313}{4506}
\createlinenumber{5314}{3dd0}
\createlinenumber{5315}{8a02}
\createlinenumber{5316}{40c0}
\createlinenumber{5317}{95cf}
\createlinenumber{5318}{39f8}
\createlinenumber{5319}{95cf}
\createlinenumber{5320}{427e}
\createlinenumber{5321}{299c}
\createlinenumber{5322}{4506}
\createlinenumber{5323}{9523}
\createlinenumber{5324}{918b}
\createlinenumber{5325}{427e}
\createlinenumber{5326}{ba03}
\createlinenumber{5327}{4506}
\createlinenumber{5328}{e322}
\createlinenumber{5329}{6f5e}
\createlinenumber{5330}{4506}
\createlinenumber{5331}{3dd0}
\createlinenumber{5332}{8a02}
\createlinenumber{5333}{7091}
\createlinenumber{5334}{95cf}
\createlinenumber{5335}{a0d8}
\createlinenumber{5336}{95cf}
\createlinenumber{5337}{427e}
\createlinenumber{5338}{7021}
\createlinenumber{5339}{95cf}
\begin{lstlisting}[language=C++]
#include <stdio.h>
#include <math.h>

int u1, v1, u2, v2, u3, v3;
double x, y, d;

double f(double u, double v)
{
   double r=0;
   r+=sqrt((u-u1)*(u-u1)+(v-v1)*(v-v1));
   r+=sqrt((u-u2)*(u-u2)+(v-v2)*(v-v2));
   r+=sqrt((u-u3)*(u-u3)+(v-v3)*(v-v3));
   if(r<d)
   {
      d=r;
      x=u;
      y=v;
   }
   return r;
}

double f(double u)
{
   double L, R, M1, M2;
   for(L=-1001, R=1001; R-L>1e-6; )
   {
      M1=(L*2+R)/3;
      M2=(L+R*2)/3;
      f(u, M1)<f(u, M2)?(R=M2):(L=M1);
   }
   return f(u, (L+R)/2);
}

int main()
{
   int T;
   double L, R, M1, M2;
   
   for(scanf("%d", &T); T--; )
   {
      scanf("%d %d %d %d %d %d", &u1, &v1, &u2, &v2, &u3, &v3);
      for(d=1e100, L=-1001, R=1001; R-L>1e-6; )
      {
         M1=(L*2+R)/3;
         M2=(L+R*2)/3;
         f(M1)<f(M2)?(R=M2):(L=M1);
      }
      printf("(%.3lf,%.3lf)\n", x, y);
   }
   
   return 0;
}
\end{lstlisting}
